<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Update Target</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/javascript">
//<![CDATA[
    // Detect if doc is served by eclipse
    if( ( (window.location.hostname == "127.0.0.1") || (window.location.hostname == "localhost") ) &&
        ( (window.location.port != "") && (window.location.port != 80) && (window.location.port != 443) ) )
    {
        // Inhibit init function from navtree
        initNavTree = function(toroot,relpath) {}
        $(document).ready(function(){
            navTree = document.getElementById("side-nav");
            if(navTree)
            {
                navTree.parentElement.removeChild(navTree);
            }
            $("#doc-content").css('margin-left',10);
        });
    }
//]]>
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html" title="Legato">
      <img alt="Logo" src="legatoLogo.png"/>
    </a>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('getStartedUpdate.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Update Target </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Legato Application Framework has included tools to make updating your target as easy as possible.</p>
<p>See <a class="el" href="conceptsUpdates.html">Updates</a> for information on how Legato handles updating targets.</p>
<p>There are several different update methods and tools with Legato. Depending on how the Legato Application Framework has been implemented on your target different updates do different things. We are going to use the Sierra Wireless WP module implementation as the basis for this tutorial, but for the specifics you should check with your module provider or field application engineer for the specifics of how the Framework is implemented on your target and what update methods will work best for you.</p>
<div class="image">
<img src="getStarted-Update.png" alt="getStarted-Update.png"/>
</div>
<p>If you are testing new apps and doing general development work with your target you will want to mainly use the <a class="el" href="toolsHost_update.html">update</a> tool to update the Legato runtime on your target.</p>
<p>Use toolsBuild_mksys to build your <code>update</code> pack for your target.</p>
<pre class="fragment">$ mksys -t wp85 mySystem.default
</pre><p>This creates the <em>build</em>&lt;system&gt; directory which contains all the staging files for your target and the update pack, that will be created in the same directory as your <code></code>.sdef. &lt;systemName&gt;.&lt;targetName&gt;.update</p>
<p>Use <a class="el" href="toolsHost_update.html">update</a> to install your <code>update</code> pack for your target.</p>
<pre class="fragment">$ update mySystem.wp85.update 192.168.2.2
</pre><p>Log on to your target to see the update and look at the status of the system. (You may have to wait for your target to reboot first)</p>
<pre class="fragment">$ ssh 192.168.2.2
# legato status
Systems installed:
  2 [good]
  3 [tried 1] &lt;-- current
Legato framework is running.
</pre><p>Whenever a new system is installed, a probation period starts. If the system stays running for the entire probation period, the system is marked "good". If during the probation period an app faults enough times the <code>Supervisor</code> daemon will mark the system as "bad" and the system is rolled-back to the last known "good" system.</p>
<p>This shows us that system number <b>2</b> is the last known good (systems incriment each time a new system is installed) and system nubmer <b>3</b> is the current system and is currently in a probation period (the default probation period is 30 minutes).</p>
<p>If the system faults 4 times in the probation period it will roll back to the previously "marked
good" system. We can simulate this and mark the system as "bad" to see how the rollback works.</p>
<p>On the target run <code>update</code> <code>-b</code> to mark the system as bad and initiate a rollback.</p>
<pre class="fragment"># update -b
# legato status
Systems installed:
  2 [good]
  3 [bad] &lt;-- current
Legato framework is NOT running.
</pre><p>If you quickly run legato status (you have about 10 seconds before the system reboots) you can see that the system has been marked as bad, and then the target will initiate a "rollback" to system 2.</p>
<p>After the target reboots log back in and check the status again:</p>
<pre class="fragment">$ssh 192.168.2.2
# legato status
Systems installed:
  2 [good] &lt;-- current
Legato framework is running.
</pre><p>Installing a new system again will then increment the system by 1 and start the probation period over again.</p>
<pre class="fragment">$ssh 192.168.2.2
# legato status
Systems installed:
  2 [good]
  3 [tried 1] &lt;-- current
Legato framework is running.
</pre><p>After 30 minutes you will see system number 3 be marked as good and legato status will show that system 3 is the new <b>good</b> system. You can also manually mark your system as good by running <code>update</code> <code>-g</code> on the target.</p>
<pre class="fragment"># update -g
System is now marked 'Good'.
# legato status
Systems installed:
  3 [good] &lt;-- current
Legato framework is running.
</pre><h1><a class="anchor" id="getStartedUpdate_firmware"></a>
Update Firmware</h1>
<p>All targets will have firmware created and maintained by the vendor. The firmware usually contains modem specific firmware and an embedded operating system.</p>
<p>The Legato Application Framework includes a tool to help you easily upgrade your firmware to any new versions for Sierra Wireless Modules.</p>
<dl class="section warning"><dt>Warning</dt><dd>If your OS firmware has been upgraded remember to uninstall your current toolchain and install the version of the toolchain that matches the firmware.</dd></dl>
<p>Download the firmware update from the <a href="https://source.sierrawireless.com/">Sierra Wireless Source</a>. You are looking for a complete image (<code></code>.spk file, or individual images <code></code>.cwe files)</p>
<p>Once you have downloaded it to your dev machine you can install it with the <a class="el" href="toolsHost_fwupdate.html">fwupdate</a> tool.</p>
<dl class="section warning"><dt>Warning</dt><dd>Upgrading the firmware on your target will replace the legato version as well, as any customized apps or systems that you have installed. After a firmware update you must reinstall your system and/or apps.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Ubuntu also provides a tool called fwupdate, make sure that you have sourced the legato environment and are using the tool that is included with the Application Framework.</dd></dl>
<p>Run <a class="el" href="toolsHost_fwupdate.html">fwupdate</a> to download and install the firmware onto your target. <code>fwupdate download &lt;target firmware="" image&gt;=""&gt; &lt;target ip="" address&gt;=""&gt;</code></p>
<pre class="fragment">$ fwupdate download WP76xx_Release8_RC4_GENERIC_SPK.spk 192.168.2.2
Connecting to service ...
Connecting to service ...
Download started ...
Download successful
</pre><p>Your target will now reboot and once it has started up again you should be able to see the new firmware, OS and Legato Version installed.</p>
<pre class="fragment">$ ssh 192.168.2.2
# fwupdate query
Connecting to service ...
Firmware Version: SWI9X07Y_02.14.04.00 000000 jenkins 2018/02/14 20:19:41
Bootloader Version: SWI9X07Y_02.14.04.00 000000 jenkins 2018/02/14 20:19:41
Linux Version: 3.18.44 #2 PREEMPT Wed Feb 14 21:24:42 UTC 2018
</pre><p>You should also check the <code>legato</code> <code>version</code> and <code>legato</code> <code>status</code> (you should be able to see that the system number has incremented by 1 again). Because you have installed new firmware and the target has successfully rebooted the system is automatically marked as good and there is no probation period.</p>
<pre class="fragment"># legato version
18.01.0_607d14ac5f0edd90fada704659a46736

# legato status
Systems installed:
  4 [good] &lt;-- current
Legato framework is running.
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.11
        </div>
    </div>
</body>
</html>
