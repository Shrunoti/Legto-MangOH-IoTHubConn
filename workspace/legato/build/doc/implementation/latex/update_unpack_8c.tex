\hypertarget{update_unpack_8c}{}\section{framework/daemons/linux/update\+Daemon/update\+Unpack.c File Reference}
\label{update_unpack_8c}\index{framework/daemons/linux/update\+Daemon/update\+Unpack.\+c@{framework/daemons/linux/update\+Daemon/update\+Unpack.\+c}}
{\ttfamily \#include \char`\"{}legato.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}interfaces.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}limit.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}update\+Unpack.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}pipeline.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}file\+Descriptor.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}system.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}app.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{update_unpack_8c_aac69c9136e03c0b2c45ce8805907ed0a}{M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES}~33
\begin{DoxyCompactList}\small\item\em An \hyperlink{class_m_d5}{M\+D5} hash string is 32 characters long, plus a null terminator. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \{ \hyperlink{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25aaade5e53e88cf231292cd1142cce2afe}{S\+T\+A\+T\+E\+\_\+\+I\+D\+LE}, 
\hyperlink{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25a1b23406e8e424c86a5b591a42d554392}{S\+T\+A\+T\+E\+\_\+\+P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON}, 
\hyperlink{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25ae8e84efeda74ecadb4b8efceb6637c70}{S\+T\+A\+T\+E\+\_\+\+U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD}, 
\hyperlink{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25ab0ddb806b1210eca2e5550b01d0aa216}{S\+T\+A\+T\+E\+\_\+\+S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_ac30bbccf87ac6407805396cebbb073ad}{Delete\+Fd\+Monitor} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a792cc9978ec207ea1e8dc62663480b35}{Reset} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a53606e254b0b90afbf2d499463906303}{Report\+Progress} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a0f77b31f2db0641fc50dcdff450dc4f9}{Handle\+Format\+Error} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a9dca0898fc9c00c994c5d5d4dddb2e45}{Handle\+Internal\+Error} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_aeb945b0c33c310c61924d6520b9e01b7}{App\+Unpack\+Done} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a5359da444a6f8e6beb226f88989e69a8}{Json\+Error\+Handler} (\hyperlink{le__json_8h_ae16b8d9006b37bd7efb69869d8b8bc21}{le\+\_\+json\+\_\+\+Error\+\_\+t} error, const char $\ast$msg)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_ace0c2b62f36129558ab8639fdba4c014}{Json\+Event\+Handler} (\hyperlink{le__json_8h_afc256534945eddc76d57b21d0938b7a9}{le\+\_\+json\+\_\+\+Event\+\_\+t} event)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a28cee08301915d7891ef20eed13c1381}{Start\+Parsing} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a2f9b5d92c868a6e6274490f84a7211b0}{Untar\+Done} (\hyperlink{pipeline_8h_adfb885380a9b0f550fafe4de0a2d2564}{pipeline\+\_\+\+Ref\+\_\+t} pipeline, int status)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a46e77edc00ef3478a704fdab40087199}{Skip\+Forward\+Done} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_aa263db162496d9e052cc5f827dcaafc5}{Copy\+Bytes\+To\+Pipeline} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a98fd3a53e9feca18bee3040845235737}{Discard\+Payload\+Bytes} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a7d98e2a7e2e36802b4af7092a9e62b7e}{Input\+Fd\+Event\+Handler} (int \hyperlink{app_stop_client_8c_a44f21d5190b5a6df8089f54799628d7e}{fd}, short events)
\item 
static int \hyperlink{update_unpack_8c_a400ff729370cbc9d034a1317beb52665}{Untar} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} $\ast$param)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a01e2c78f4b8ede4f26ad2d7306bf3065}{Start\+Untar} (const char $\ast$dir\+Path)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_aef1a7a8ee915436d0b0d4342ff6bed9e}{Start\+Skip\+Forward} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_ae8034359063106564cbed772ea8afa56}{Start\+Firmware\+Update} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a1836ac9b98efb7230642b41bda3a8969}{Json\+Done} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a4e149a372dac8b1129e29bc6fee498f1}{String\+Member\+Event\+Handler} (\hyperlink{le__json_8h_afc256534945eddc76d57b21d0938b7a9}{le\+\_\+json\+\_\+\+Event\+\_\+t} event, char $\ast$dest, size\+\_\+t size, const char $\ast$member\+Name)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a86756ec55ac466b7060ebf73a4ca84a4}{Command\+Event\+Handler} (\hyperlink{le__json_8h_afc256534945eddc76d57b21d0938b7a9}{le\+\_\+json\+\_\+\+Event\+\_\+t} event)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a11add1a810b1c4b5bd7159352cdb3778}{Name\+Event\+Handler} (\hyperlink{le__json_8h_afc256534945eddc76d57b21d0938b7a9}{le\+\_\+json\+\_\+\+Event\+\_\+t} event)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a8e6c69e09eac27f22ddfb41bf6820b85}{Md5\+Event\+Handler} (\hyperlink{le__json_8h_afc256534945eddc76d57b21d0938b7a9}{le\+\_\+json\+\_\+\+Event\+\_\+t} event)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a179883e12441d593347e670b6da1e38e}{Version\+Event\+Handler} (\hyperlink{le__json_8h_afc256534945eddc76d57b21d0938b7a9}{le\+\_\+json\+\_\+\+Event\+\_\+t} event)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_ab56d7a6f6f7179e1743eb06a4893438c}{Size\+Event\+Handler} (\hyperlink{le__json_8h_afc256534945eddc76d57b21d0938b7a9}{le\+\_\+json\+\_\+\+Event\+\_\+t} event)
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_ab62bf4c310db0b843bfa23b4cb6c14dd}{update\+Unpack\+\_\+\+Start} (int \hyperlink{app_stop_client_8c_a44f21d5190b5a6df8089f54799628d7e}{fd}, \hyperlink{update_unpack_8h_aa86bc2a063363b47f31119e5980fa0be}{update\+Unpack\+\_\+\+Progress\+Handler\+\_\+t} progress\+Func)
\item 
\hyperlink{update_unpack_8h_a0082ad8447d01c9dcb875120e4b0f149}{update\+Unpack\+\_\+\+Type\+\_\+t} \hyperlink{update_unpack_8c_ae07976be62595e8c87e1e215fabf6816}{update\+Unpack\+\_\+\+Get\+Type} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
const char $\ast$ \hyperlink{update_unpack_8c_a619fd5b01999112669a40b84a014d305}{update\+Unpack\+\_\+\+Get\+App\+Name} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
const char $\ast$ \hyperlink{update_unpack_8c_a53ff00ad6d73e786e32ef0cb61a82214}{update\+Unpack\+\_\+\+Get\+App\+Md5} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_unpack_8c_a97de39b13eae20b2c6ac20a563675f46}{update\+Unpack\+\_\+\+Stop} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{update_unpack_8c_acb3225fa2c7b5d4838ff3bcf155a65e2}{Input\+Fd} = -\/1
\begin{DoxyCompactList}\small\item\em File descriptor to read the update pack from. \end{DoxyCompactList}\item 
static bool \hyperlink{update_unpack_8c_ac3a6b03259ebec9f756d3111d625d0c0}{Input\+Fd\+Closed} = false
\item 
static \hyperlink{le__fd_monitor_8h_a85048556f0b95147af81e76907895d42}{le\+\_\+fd\+Monitor\+\_\+\+Ref\+\_\+t} \hyperlink{update_unpack_8c_ae1cc3f3e12f9ea50d4d48c5b715a5f8a}{Input\+Fd\+Monitor} = N\+U\+LL
\begin{DoxyCompactList}\small\item\em Reference to the FD Monitor for the input stream (N\+U\+LL if not unpacking). \end{DoxyCompactList}\item 
static \hyperlink{pipeline_8h_adfb885380a9b0f550fafe4de0a2d2564}{pipeline\+\_\+\+Ref\+\_\+t} \hyperlink{update_unpack_8c_aa1eeacd276c4e4e82e4e73b1ae036136}{Pipeline} = N\+U\+LL
\begin{DoxyCompactList}\small\item\em Reference to an unpack pipeline (N\+U\+LL if not unpacking). \end{DoxyCompactList}\item 
static int \hyperlink{update_unpack_8c_a788202ae36b0e21a447aeccd2b164778}{Pipeline\+Fd} = -\/1
\begin{DoxyCompactList}\small\item\em File descriptor connected to the input of a pipeline (-\/1 if not unpacking) \end{DoxyCompactList}\item 
static \hyperlink{update_unpack_8h_aa86bc2a063363b47f31119e5980fa0be}{update\+Unpack\+\_\+\+Progress\+Handler\+\_\+t} \hyperlink{update_unpack_8c_a05538ca08a8058d84af418cc132979ee}{Progress\+Func} = N\+U\+LL
\begin{DoxyCompactList}\small\item\em Function to be called to report progress. \end{DoxyCompactList}\item 
static char \hyperlink{update_unpack_8c_a868511981ee7cc06621c0279c59eef4f}{Command} \mbox{[}32\mbox{]}
\begin{DoxyCompactList}\small\item\em The command name found in the J\+S\+ON update pack section header. \end{DoxyCompactList}\item 
static \hyperlink{update_unpack_8h_a0082ad8447d01c9dcb875120e4b0f149}{update\+Unpack\+\_\+\+Type\+\_\+t} \hyperlink{update_unpack_8c_a6a0eb280d526ff327d548c4ceb7219cb}{Type} = \hyperlink{update_unpack_8h_a0082ad8447d01c9dcb875120e4b0f149a64599dea7071bc28732936e0bfddff3e}{T\+Y\+P\+E\+\_\+\+U\+N\+K\+N\+O\+WN}
\begin{DoxyCompactList}\small\item\em What type of update pack is it? \end{DoxyCompactList}\item 
static char \hyperlink{update_unpack_8c_a0d9ada1781e9dc7819673a6eef60a45d}{App\+Name} \mbox{[}\hyperlink{limit_8h_a3be1f83793d35365d5f9e765e0ffc619}{L\+I\+M\+I\+T\+\_\+\+M\+A\+X\+\_\+\+A\+P\+P\+\_\+\+N\+A\+M\+E\+\_\+\+B\+Y\+T\+ES}\mbox{]}
\begin{DoxyCompactList}\small\item\em The name of the app being updated/removed. \end{DoxyCompactList}\item 
static char \hyperlink{update_unpack_8c_aa5a99a23f5ea1f4ac499a6efef993202}{Md5} \mbox{[}\hyperlink{update_unpack_8c_aac69c9136e03c0b2c45ce8805907ed0a}{M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES}\mbox{]}
\begin{DoxyCompactList}\small\item\em The \hyperlink{class_m_d5}{M\+D5} hash obtained from a J\+S\+ON header. \end{DoxyCompactList}\item 
static size\+\_\+t \hyperlink{update_unpack_8c_acc7a6fe10546ef3d34d1b428914b0cf1}{Payload\+Size}
\begin{DoxyCompactList}\small\item\em \subsection*{of bytes of payload following the J\+S\+ON.}\end{DoxyCompactList}\item 
static size\+\_\+t \hyperlink{update_unpack_8c_a6246d1ec2be4de7692b85d7c0538e544}{Payload\+Bytes\+Copied}
\begin{DoxyCompactList}\small\item\em \subsection*{of bytes of payload that have been copied to the unpack pipeline.}\end{DoxyCompactList}\item 
static unsigned int \hyperlink{update_unpack_8c_a249b2310a15273d39627794fa818b230}{Percent\+Done}
\begin{DoxyCompactList}\small\item\em Percentage complete on current task. \end{DoxyCompactList}\item 
static enum  \{ ... \}  \hyperlink{update_unpack_8c_abc81307c85544e3ad1076e3f7428dbf7}{State} = \hyperlink{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25aaade5e53e88cf231292cd1142cce2afe}{S\+T\+A\+T\+E\+\_\+\+I\+D\+LE}
\item 
static \hyperlink{le__json_8h_ac245fec94486c2d3a01a270c1188d023}{le\+\_\+json\+\_\+\+Parsing\+Session\+Ref\+\_\+t} \hyperlink{update_unpack_8c_aaef55f516e5c0b11b6d384920a488f21}{Parsing\+Session} = N\+U\+LL
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Implementation of the Update Pack parser. This file parses an update pack, and drives the rest of the update based on the contents of the update pack.

This is single-\/threaded, event-\/driven code that shares the main thread\textquotesingle{}s event loop.

Copyright (C) Sierra Wireless Inc. 

\subsection{Macro Definition Documentation}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES@{M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES}}
\index{M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES@{M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES}{MD5_STRING_BYTES}}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES~33}\hypertarget{update_unpack_8c_aac69c9136e03c0b2c45ce8805907ed0a}{}\label{update_unpack_8c_aac69c9136e03c0b2c45ce8805907ed0a}


An \hyperlink{class_m_d5}{M\+D5} hash string is 32 characters long, plus a null terminator. 



\subsection{Enumeration Type Documentation}
\subsubsection[{\texorpdfstring{anonymous enum}{anonymous enum}}]{\setlength{\rightskip}{0pt plus 5cm}anonymous enum}\hypertarget{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25}{}\label{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25}
The state machine looks like this\+:

\begin{DoxyVerb}  +---------------<--------------+
  |                              |
  +------<------+                |
  |             |                |
  v             |                |
IDLE --> PARSING_JSON --> UNPACKING/SKIPPING_PAYLOAD
                ^                |
                |                |
                +-------<--------+
\end{DoxyVerb}


The transition from P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON to U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD happens when the J\+S\+ON header for a section of the update pack has been successfully parsed and all required fields have been extracted from it.

The transition from U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD to I\+D\+LE happens when the payload has been extracted to the file system.

If there is no payload for a section, then the state machine skips U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD and goes back to I\+D\+LE from P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON.

The transition back from U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD to P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON happens whenever more J\+S\+ON data is found after the end of the section that was being applied.

The state machine starts in the I\+D\+LE state and returns to the I\+D\+LE state whenever an update pack is successfully installed or an error occurs.

If a system update pack contains an app that is already installed on the target, then the payload bytes are read from the input stream and discarded. In this case, the S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD state replaces the U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD state. \begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{S\+T\+A\+T\+E\+\_\+\+I\+D\+LE@{S\+T\+A\+T\+E\+\_\+\+I\+D\+LE}!update\+Unpack.\+c@{update\+Unpack.\+c}}\index{update\+Unpack.\+c@{update\+Unpack.\+c}!S\+T\+A\+T\+E\+\_\+\+I\+D\+LE@{S\+T\+A\+T\+E\+\_\+\+I\+D\+LE}}\item[{\em 
S\+T\+A\+T\+E\+\_\+\+I\+D\+LE\hypertarget{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25aaade5e53e88cf231292cd1142cce2afe}{}\label{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25aaade5e53e88cf231292cd1142cce2afe}
}]\index{S\+T\+A\+T\+E\+\_\+\+P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON@{S\+T\+A\+T\+E\+\_\+\+P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON}!update\+Unpack.\+c@{update\+Unpack.\+c}}\index{update\+Unpack.\+c@{update\+Unpack.\+c}!S\+T\+A\+T\+E\+\_\+\+P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON@{S\+T\+A\+T\+E\+\_\+\+P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON}}\item[{\em 
S\+T\+A\+T\+E\+\_\+\+P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON\hypertarget{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25a1b23406e8e424c86a5b591a42d554392}{}\label{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25a1b23406e8e424c86a5b591a42d554392}
}]\index{S\+T\+A\+T\+E\+\_\+\+U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD@{S\+T\+A\+T\+E\+\_\+\+U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD}!update\+Unpack.\+c@{update\+Unpack.\+c}}\index{update\+Unpack.\+c@{update\+Unpack.\+c}!S\+T\+A\+T\+E\+\_\+\+U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD@{S\+T\+A\+T\+E\+\_\+\+U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD}}\item[{\em 
S\+T\+A\+T\+E\+\_\+\+U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD\hypertarget{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25ae8e84efeda74ecadb4b8efceb6637c70}{}\label{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25ae8e84efeda74ecadb4b8efceb6637c70}
}]\index{S\+T\+A\+T\+E\+\_\+\+S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD@{S\+T\+A\+T\+E\+\_\+\+S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD}!update\+Unpack.\+c@{update\+Unpack.\+c}}\index{update\+Unpack.\+c@{update\+Unpack.\+c}!S\+T\+A\+T\+E\+\_\+\+S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD@{S\+T\+A\+T\+E\+\_\+\+S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD}}\item[{\em 
S\+T\+A\+T\+E\+\_\+\+S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD\hypertarget{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25ab0ddb806b1210eca2e5550b01d0aa216}{}\label{update_unpack_8c_aba01db17f4a2bfbc3db60dc172972a25ab0ddb806b1210eca2e5550b01d0aa216}
}]\end{description}
\end{Desc}


\subsection{Function Documentation}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!App\+Unpack\+Done@{App\+Unpack\+Done}}
\index{App\+Unpack\+Done@{App\+Unpack\+Done}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{App\+Unpack\+Done(void)}{AppUnpackDone(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} App\+Unpack\+Done (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_aeb945b0c33c310c61924d6520b9e01b7}{}\label{update_unpack_8c_aeb945b0c33c310c61924d6520b9e01b7}
Called when app unpack finishes successfully. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Command\+Event\+Handler@{Command\+Event\+Handler}}
\index{Command\+Event\+Handler@{Command\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Command\+Event\+Handler(le\+\_\+json\+\_\+\+Event\+\_\+t event)}{CommandEventHandler(le_json_Event_t event)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Command\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Event\+\_\+t}}]{event}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a86756ec55ac466b7060ebf73a4ca84a4}{}\label{update_unpack_8c_a86756ec55ac466b7060ebf73a4ca84a4}
\char`\"{}command\char`\"{} member parsing event function. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Copy\+Bytes\+To\+Pipeline@{Copy\+Bytes\+To\+Pipeline}}
\index{Copy\+Bytes\+To\+Pipeline@{Copy\+Bytes\+To\+Pipeline}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Copy\+Bytes\+To\+Pipeline(void)}{CopyBytesToPipeline(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Copy\+Bytes\+To\+Pipeline (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_aa263db162496d9e052cc5f827dcaafc5}{}\label{update_unpack_8c_aa263db162496d9e052cc5f827dcaafc5}
Copy bytes from the input fd to the pipeline\textquotesingle{}s input fd until the input fd\textquotesingle{}s read buffer is empty or we have copied all the payload bytes. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Delete\+Fd\+Monitor@{Delete\+Fd\+Monitor}}
\index{Delete\+Fd\+Monitor@{Delete\+Fd\+Monitor}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Delete\+Fd\+Monitor(void)}{DeleteFdMonitor(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Delete\+Fd\+Monitor (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_ac30bbccf87ac6407805396cebbb073ad}{}\label{update_unpack_8c_ac30bbccf87ac6407805396cebbb073ad}
Delete the FD Monitor object. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Discard\+Payload\+Bytes@{Discard\+Payload\+Bytes}}
\index{Discard\+Payload\+Bytes@{Discard\+Payload\+Bytes}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Discard\+Payload\+Bytes(void)}{DiscardPayloadBytes(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Discard\+Payload\+Bytes (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a98fd3a53e9feca18bee3040845235737}{}\label{update_unpack_8c_a98fd3a53e9feca18bee3040845235737}
Read and discard payload bytes from the input stream until we have discarded all the payload bytes or the input stream doesn\textquotesingle{}t have any more bytes for us right now. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Handle\+Format\+Error@{Handle\+Format\+Error}}
\index{Handle\+Format\+Error@{Handle\+Format\+Error}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Handle\+Format\+Error(void)}{HandleFormatError(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Handle\+Format\+Error (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a0f77b31f2db0641fc50dcdff450dc4f9}{}\label{update_unpack_8c_a0f77b31f2db0641fc50dcdff450dc4f9}
Error handler for problems with the update pack format. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Handle\+Internal\+Error@{Handle\+Internal\+Error}}
\index{Handle\+Internal\+Error@{Handle\+Internal\+Error}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Handle\+Internal\+Error(void)}{HandleInternalError(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Handle\+Internal\+Error (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a9dca0898fc9c00c994c5d5d4dddb2e45}{}\label{update_unpack_8c_a9dca0898fc9c00c994c5d5d4dddb2e45}
Error handler for problems with reading or processing the update pack. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Input\+Fd\+Event\+Handler@{Input\+Fd\+Event\+Handler}}
\index{Input\+Fd\+Event\+Handler@{Input\+Fd\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Input\+Fd\+Event\+Handler(int fd, short events)}{InputFdEventHandler(int fd, short events)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Input\+Fd\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{short}]{events}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a7d98e2a7e2e36802b4af7092a9e62b7e}{}\label{update_unpack_8c_a7d98e2a7e2e36802b4af7092a9e62b7e}
Event handler for the input fd when copying bytes to a pipeline. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Json\+Done@{Json\+Done}}
\index{Json\+Done@{Json\+Done}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Json\+Done(void)}{JsonDone(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Json\+Done (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a1836ac9b98efb7230642b41bda3a8969}{}\label{update_unpack_8c_a1836ac9b98efb7230642b41bda3a8969}
Handle the end of a J\+S\+ON header. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Json\+Error\+Handler@{Json\+Error\+Handler}}
\index{Json\+Error\+Handler@{Json\+Error\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Json\+Error\+Handler(le\+\_\+json\+\_\+\+Error\+\_\+t error, const char $\ast$msg)}{JsonErrorHandler(le_json_Error_t error, const char *msg)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Json\+Error\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Error\+\_\+t}}]{error, }
\item[{const char $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a5359da444a6f8e6beb226f88989e69a8}{}\label{update_unpack_8c_a5359da444a6f8e6beb226f88989e69a8}
Error handling function called by the J\+S\+ON parser when an error occurs. 
\begin{DoxyParams}{Parameters}
{\em msg} & Human-\/readable error message. \\
\hline
\end{DoxyParams}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Json\+Event\+Handler@{Json\+Event\+Handler}}
\index{Json\+Event\+Handler@{Json\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Json\+Event\+Handler(le\+\_\+json\+\_\+\+Event\+\_\+t event)}{JsonEventHandler(le_json_Event_t event)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Json\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Event\+\_\+t}}]{event}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_ace0c2b62f36129558ab8639fdba4c014}{}\label{update_unpack_8c_ace0c2b62f36129558ab8639fdba4c014}
Event handler function called by the J\+S\+ON parser when it encounters things during parsing. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Md5\+Event\+Handler@{Md5\+Event\+Handler}}
\index{Md5\+Event\+Handler@{Md5\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Md5\+Event\+Handler(le\+\_\+json\+\_\+\+Event\+\_\+t event)}{Md5EventHandler(le_json_Event_t event)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Md5\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Event\+\_\+t}}]{event}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a8e6c69e09eac27f22ddfb41bf6820b85}{}\label{update_unpack_8c_a8e6c69e09eac27f22ddfb41bf6820b85}
\char`\"{}md5\char`\"{} member parsing event function. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Name\+Event\+Handler@{Name\+Event\+Handler}}
\index{Name\+Event\+Handler@{Name\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Name\+Event\+Handler(le\+\_\+json\+\_\+\+Event\+\_\+t event)}{NameEventHandler(le_json_Event_t event)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Name\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Event\+\_\+t}}]{event}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a11add1a810b1c4b5bd7159352cdb3778}{}\label{update_unpack_8c_a11add1a810b1c4b5bd7159352cdb3778}
\char`\"{}name\char`\"{} member parsing event function. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Report\+Progress@{Report\+Progress}}
\index{Report\+Progress@{Report\+Progress}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Report\+Progress(void)}{ReportProgress(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Report\+Progress (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a53606e254b0b90afbf2d499463906303}{}\label{update_unpack_8c_a53606e254b0b90afbf2d499463906303}
Report progress. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Reset@{Reset}}
\index{Reset@{Reset}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Reset(void)}{Reset(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Reset (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a792cc9978ec207ea1e8dc62663480b35}{}\label{update_unpack_8c_a792cc9978ec207ea1e8dc62663480b35}
Reset the update unpacker. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Size\+Event\+Handler@{Size\+Event\+Handler}}
\index{Size\+Event\+Handler@{Size\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Size\+Event\+Handler(le\+\_\+json\+\_\+\+Event\+\_\+t event)}{SizeEventHandler(le_json_Event_t event)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Size\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Event\+\_\+t}}]{event}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_ab56d7a6f6f7179e1743eb06a4893438c}{}\label{update_unpack_8c_ab56d7a6f6f7179e1743eb06a4893438c}
\char`\"{}size\char`\"{} member parsing event function. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Skip\+Forward\+Done@{Skip\+Forward\+Done}}
\index{Skip\+Forward\+Done@{Skip\+Forward\+Done}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Skip\+Forward\+Done(void)}{SkipForwardDone(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Skip\+Forward\+Done (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a46e77edc00ef3478a704fdab40087199}{}\label{update_unpack_8c_a46e77edc00ef3478a704fdab40087199}
Completion callback for skip forward operation that is done instead of an app unpack + install in the case that an app is already installed. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Start\+Firmware\+Update@{Start\+Firmware\+Update}}
\index{Start\+Firmware\+Update@{Start\+Firmware\+Update}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Start\+Firmware\+Update(void)}{StartFirmwareUpdate(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Start\+Firmware\+Update (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_ae8034359063106564cbed772ea8afa56}{}\label{update_unpack_8c_ae8034359063106564cbed772ea8afa56}
Do a firmware update. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Start\+Parsing@{Start\+Parsing}}
\index{Start\+Parsing@{Start\+Parsing}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Start\+Parsing(void)}{StartParsing(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Start\+Parsing (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a28cee08301915d7891ef20eed13c1381}{}\label{update_unpack_8c_a28cee08301915d7891ef20eed13c1381}
Start parsing a J\+S\+ON header. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Start\+Skip\+Forward@{Start\+Skip\+Forward}}
\index{Start\+Skip\+Forward@{Start\+Skip\+Forward}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Start\+Skip\+Forward(void)}{StartSkipForward(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Start\+Skip\+Forward (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_aef1a7a8ee915436d0b0d4342ff6bed9e}{}\label{update_unpack_8c_aef1a7a8ee915436d0b0d4342ff6bed9e}
Start reading and throwing away payload bytes from the input stream. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Start\+Untar@{Start\+Untar}}
\index{Start\+Untar@{Start\+Untar}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Start\+Untar(const char $\ast$dir\+Path)}{StartUntar(const char *dirPath)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Start\+Untar (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{dir\+Path}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a01e2c78f4b8ede4f26ad2d7306bf3065}{}\label{update_unpack_8c_a01e2c78f4b8ede4f26ad2d7306bf3065}
Start unpacking a tarball. 
\begin{DoxyParams}{Parameters}
{\em dir\+Path} & Path to the directory to unpack the tarball into. \\
\hline
\end{DoxyParams}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!String\+Member\+Event\+Handler@{String\+Member\+Event\+Handler}}
\index{String\+Member\+Event\+Handler@{String\+Member\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{String\+Member\+Event\+Handler(le\+\_\+json\+\_\+\+Event\+\_\+t event, char $\ast$dest, size\+\_\+t size, const char $\ast$member\+Name)}{StringMemberEventHandler(le_json_Event_t event, char *dest, size_t size, const char *memberName)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} String\+Member\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Event\+\_\+t}}]{event, }
\item[{char $\ast$}]{dest, }
\item[{size\+\_\+t}]{size, }
\item[{const char $\ast$}]{member\+Name}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a4e149a372dac8b1129e29bc6fee498f1}{}\label{update_unpack_8c_a4e149a372dac8b1129e29bc6fee498f1}
String member parsing event function. 
\begin{DoxyParams}{Parameters}
{\em dest} & Pointer to the buffer where the string should be stored. \\
\hline
{\em size} & Size of the buffer pointed to by dest (bytes). \\
\hline
{\em member\+Name} & Human-\/readable string naming the member for error messages. \\
\hline
\end{DoxyParams}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Untar@{Untar}}
\index{Untar@{Untar}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Untar(void $\ast$param)}{Untar(void *param)}}]{\setlength{\rightskip}{0pt plus 5cm}static int Untar (
\begin{DoxyParamCaption}
\item[{{\bf void} $\ast$}]{param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a400ff729370cbc9d034a1317beb52665}{}\label{update_unpack_8c_a400ff729370cbc9d034a1317beb52665}
Function that runs in the unpack pipeline\textquotesingle{}s \char`\"{}tar\char`\"{} process. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Untar\+Done@{Untar\+Done}}
\index{Untar\+Done@{Untar\+Done}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Untar\+Done(pipeline\+\_\+\+Ref\+\_\+t pipeline, int status)}{UntarDone(pipeline_Ref_t pipeline, int status)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Untar\+Done (
\begin{DoxyParamCaption}
\item[{{\bf pipeline\+\_\+\+Ref\+\_\+t}}]{pipeline, }
\item[{int}]{status}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a2f9b5d92c868a6e6274490f84a7211b0}{}\label{update_unpack_8c_a2f9b5d92c868a6e6274490f84a7211b0}
Completion callback for \char`\"{}tar xj\char`\"{} operation. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!update\+Unpack\+\_\+\+Get\+App\+Md5@{update\+Unpack\+\_\+\+Get\+App\+Md5}}
\index{update\+Unpack\+\_\+\+Get\+App\+Md5@{update\+Unpack\+\_\+\+Get\+App\+Md5}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{update\+Unpack\+\_\+\+Get\+App\+Md5(void)}{updateUnpack_GetAppMd5(void)}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ update\+Unpack\+\_\+\+Get\+App\+Md5 (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_unpack_8c_a53ff00ad6d73e786e32ef0cb61a82214}{}\label{update_unpack_8c_a53ff00ad6d73e786e32ef0cb61a82214}
Get the \hyperlink{class_m_d5}{M\+D5} sum of the app being updated (valid for app update only).

\begin{DoxyReturn}{Returns}
The \hyperlink{class_m_d5}{M\+D5} sum of the app, as a string (valid until next unpack is started). 
\end{DoxyReturn}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!update\+Unpack\+\_\+\+Get\+App\+Name@{update\+Unpack\+\_\+\+Get\+App\+Name}}
\index{update\+Unpack\+\_\+\+Get\+App\+Name@{update\+Unpack\+\_\+\+Get\+App\+Name}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{update\+Unpack\+\_\+\+Get\+App\+Name(void)}{updateUnpack_GetAppName(void)}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ update\+Unpack\+\_\+\+Get\+App\+Name (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_unpack_8c_a619fd5b01999112669a40b84a014d305}{}\label{update_unpack_8c_a619fd5b01999112669a40b84a014d305}
Get the name of the app being changed (valid for app update or remove).

\begin{DoxyReturn}{Returns}
The name of the app (valid until next unpack is started). 
\end{DoxyReturn}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!update\+Unpack\+\_\+\+Get\+Type@{update\+Unpack\+\_\+\+Get\+Type}}
\index{update\+Unpack\+\_\+\+Get\+Type@{update\+Unpack\+\_\+\+Get\+Type}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{update\+Unpack\+\_\+\+Get\+Type(void)}{updateUnpack_GetType(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf update\+Unpack\+\_\+\+Type\+\_\+t} update\+Unpack\+\_\+\+Get\+Type (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_unpack_8c_ae07976be62595e8c87e1e215fabf6816}{}\label{update_unpack_8c_ae07976be62595e8c87e1e215fabf6816}
Get the type of the update pack (available when 100\% done).

\begin{DoxyReturn}{Returns}
The type of update (firmware, app, or system). 
\end{DoxyReturn}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!update\+Unpack\+\_\+\+Start@{update\+Unpack\+\_\+\+Start}}
\index{update\+Unpack\+\_\+\+Start@{update\+Unpack\+\_\+\+Start}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{update\+Unpack\+\_\+\+Start(int fd, update\+Unpack\+\_\+\+Progress\+Handler\+\_\+t progress\+Func)}{updateUnpack_Start(int fd, updateUnpack_ProgressHandler_t progressFunc)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} update\+Unpack\+\_\+\+Start (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{{\bf update\+Unpack\+\_\+\+Progress\+Handler\+\_\+t}}]{progress\+Func}
\end{DoxyParamCaption}
)}\hypertarget{update_unpack_8c_ab62bf4c310db0b843bfa23b4cb6c14dd}{}\label{update_unpack_8c_ab62bf4c310db0b843bfa23b4cb6c14dd}
Starts processing an update pack.

Reads the update pack from a given file descriptor.

Calls a callback function to report progress. 
\begin{DoxyParams}{Parameters}
{\em fd} & File descriptor to read the update pack from. \\
\hline
{\em progress\+Func} & Progress reporting callback. \\
\hline
\end{DoxyParams}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!update\+Unpack\+\_\+\+Stop@{update\+Unpack\+\_\+\+Stop}}
\index{update\+Unpack\+\_\+\+Stop@{update\+Unpack\+\_\+\+Stop}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{update\+Unpack\+\_\+\+Stop(void)}{updateUnpack_Stop(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} update\+Unpack\+\_\+\+Stop (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_unpack_8c_a97de39b13eae20b2c6ac20a563675f46}{}\label{update_unpack_8c_a97de39b13eae20b2c6ac20a563675f46}
Stop unpacking an update pack. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Version\+Event\+Handler@{Version\+Event\+Handler}}
\index{Version\+Event\+Handler@{Version\+Event\+Handler}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Version\+Event\+Handler(le\+\_\+json\+\_\+\+Event\+\_\+t event)}{VersionEventHandler(le_json_Event_t event)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Version\+Event\+Handler (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+json\+\_\+\+Event\+\_\+t}}]{event}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a179883e12441d593347e670b6da1e38e}{}\label{update_unpack_8c_a179883e12441d593347e670b6da1e38e}
\char`\"{}version\char`\"{} member parsing event function. 

\subsection{Variable Documentation}
\index{update\+Unpack.\+c@{update\+Unpack.\+c}!App\+Name@{App\+Name}}
\index{App\+Name@{App\+Name}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{App\+Name}{AppName}}]{\setlength{\rightskip}{0pt plus 5cm}char App\+Name\mbox{[}{\bf L\+I\+M\+I\+T\+\_\+\+M\+A\+X\+\_\+\+A\+P\+P\+\_\+\+N\+A\+M\+E\+\_\+\+B\+Y\+T\+ES}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a0d9ada1781e9dc7819673a6eef60a45d}{}\label{update_unpack_8c_a0d9ada1781e9dc7819673a6eef60a45d}


The name of the app being updated/removed. 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Command@{Command}}
\index{Command@{Command}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Command}{Command}}]{\setlength{\rightskip}{0pt plus 5cm}char Command\mbox{[}32\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a868511981ee7cc06621c0279c59eef4f}{}\label{update_unpack_8c_a868511981ee7cc06621c0279c59eef4f}


The command name found in the J\+S\+ON update pack section header. 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Input\+Fd@{Input\+Fd}}
\index{Input\+Fd@{Input\+Fd}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Input\+Fd}{InputFd}}]{\setlength{\rightskip}{0pt plus 5cm}int Input\+Fd = -\/1\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_acb3225fa2c7b5d4838ff3bcf155a65e2}{}\label{update_unpack_8c_acb3225fa2c7b5d4838ff3bcf155a65e2}


File descriptor to read the update pack from. 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Input\+Fd\+Closed@{Input\+Fd\+Closed}}
\index{Input\+Fd\+Closed@{Input\+Fd\+Closed}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Input\+Fd\+Closed}{InputFdClosed}}]{\setlength{\rightskip}{0pt plus 5cm}bool Input\+Fd\+Closed = false\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_ac3a6b03259ebec9f756d3111d625d0c0}{}\label{update_unpack_8c_ac3a6b03259ebec9f756d3111d625d0c0}
Input\+Fd could have been closed by the legato messaging infrastructure; and in that case it shouldn\textquotesingle{}t be closed again. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Input\+Fd\+Monitor@{Input\+Fd\+Monitor}}
\index{Input\+Fd\+Monitor@{Input\+Fd\+Monitor}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Input\+Fd\+Monitor}{InputFdMonitor}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+fd\+Monitor\+\_\+\+Ref\+\_\+t} Input\+Fd\+Monitor = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_ae1cc3f3e12f9ea50d4d48c5b715a5f8a}{}\label{update_unpack_8c_ae1cc3f3e12f9ea50d4d48c5b715a5f8a}


Reference to the FD Monitor for the input stream (N\+U\+LL if not unpacking). 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Md5@{Md5}}
\index{Md5@{Md5}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Md5}{Md5}}]{\setlength{\rightskip}{0pt plus 5cm}char Md5\mbox{[}{\bf M\+D5\+\_\+\+S\+T\+R\+I\+N\+G\+\_\+\+B\+Y\+T\+ES}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_aa5a99a23f5ea1f4ac499a6efef993202}{}\label{update_unpack_8c_aa5a99a23f5ea1f4ac499a6efef993202}


The \hyperlink{class_m_d5}{M\+D5} hash obtained from a J\+S\+ON header. 

The system\textquotesingle{}s \hyperlink{class_m_d5}{M\+D5} hash. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Parsing\+Session@{Parsing\+Session}}
\index{Parsing\+Session@{Parsing\+Session}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Parsing\+Session}{ParsingSession}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+json\+\_\+\+Parsing\+Session\+Ref\+\_\+t} Parsing\+Session = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_aaef55f516e5c0b11b6d384920a488f21}{}\label{update_unpack_8c_aaef55f516e5c0b11b6d384920a488f21}
J\+S\+ON parsing session. Used to stop parsing early, if necessary.

Only valid in the P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON state. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Payload\+Bytes\+Copied@{Payload\+Bytes\+Copied}}
\index{Payload\+Bytes\+Copied@{Payload\+Bytes\+Copied}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Payload\+Bytes\+Copied}{PayloadBytesCopied}}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t Payload\+Bytes\+Copied\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a6246d1ec2be4de7692b85d7c0538e544}{}\label{update_unpack_8c_a6246d1ec2be4de7692b85d7c0538e544}


\subsection*{of bytes of payload that have been copied to the unpack pipeline.}

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Payload\+Size@{Payload\+Size}}
\index{Payload\+Size@{Payload\+Size}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Payload\+Size}{PayloadSize}}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t Payload\+Size\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_acc7a6fe10546ef3d34d1b428914b0cf1}{}\label{update_unpack_8c_acc7a6fe10546ef3d34d1b428914b0cf1}


\subsection*{of bytes of payload following the J\+S\+ON.}

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Percent\+Done@{Percent\+Done}}
\index{Percent\+Done@{Percent\+Done}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Percent\+Done}{PercentDone}}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int Percent\+Done\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a249b2310a15273d39627794fa818b230}{}\label{update_unpack_8c_a249b2310a15273d39627794fa818b230}


Percentage complete on current task. 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Pipeline@{Pipeline}}
\index{Pipeline@{Pipeline}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Pipeline}{Pipeline}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pipeline\+\_\+\+Ref\+\_\+t} Pipeline = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_aa1eeacd276c4e4e82e4e73b1ae036136}{}\label{update_unpack_8c_aa1eeacd276c4e4e82e4e73b1ae036136}


Reference to an unpack pipeline (N\+U\+LL if not unpacking). 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Pipeline\+Fd@{Pipeline\+Fd}}
\index{Pipeline\+Fd@{Pipeline\+Fd}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Pipeline\+Fd}{PipelineFd}}]{\setlength{\rightskip}{0pt plus 5cm}int Pipeline\+Fd = -\/1\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a788202ae36b0e21a447aeccd2b164778}{}\label{update_unpack_8c_a788202ae36b0e21a447aeccd2b164778}


File descriptor connected to the input of a pipeline (-\/1 if not unpacking) 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!Progress\+Func@{Progress\+Func}}
\index{Progress\+Func@{Progress\+Func}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Progress\+Func}{ProgressFunc}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf update\+Unpack\+\_\+\+Progress\+Handler\+\_\+t} Progress\+Func = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a05538ca08a8058d84af418cc132979ee}{}\label{update_unpack_8c_a05538ca08a8058d84af418cc132979ee}


Function to be called to report progress. 

\index{update\+Unpack.\+c@{update\+Unpack.\+c}!State@{State}}
\index{State@{State}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{State}{State}}]{\setlength{\rightskip}{0pt plus 5cm}enum \{ ... \} 
 State\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_abc81307c85544e3ad1076e3f7428dbf7}{}\label{update_unpack_8c_abc81307c85544e3ad1076e3f7428dbf7}
The state machine looks like this\+:

\begin{DoxyVerb}  +---------------<--------------+
  |                              |
  +------<------+                |
  |             |                |
  v             |                |
IDLE --> PARSING_JSON --> UNPACKING/SKIPPING_PAYLOAD
                ^                |
                |                |
                +-------<--------+
\end{DoxyVerb}


The transition from P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON to U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD happens when the J\+S\+ON header for a section of the update pack has been successfully parsed and all required fields have been extracted from it.

The transition from U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD to I\+D\+LE happens when the payload has been extracted to the file system.

If there is no payload for a section, then the state machine skips U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD and goes back to I\+D\+LE from P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON.

The transition back from U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD to P\+A\+R\+S\+I\+N\+G\+\_\+\+J\+S\+ON happens whenever more J\+S\+ON data is found after the end of the section that was being applied.

The state machine starts in the I\+D\+LE state and returns to the I\+D\+LE state whenever an update pack is successfully installed or an error occurs.

If a system update pack contains an app that is already installed on the target, then the payload bytes are read from the input stream and discarded. In this case, the S\+K\+I\+P\+P\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD state replaces the U\+N\+P\+A\+C\+K\+I\+N\+G\+\_\+\+P\+A\+Y\+L\+O\+AD state. \index{update\+Unpack.\+c@{update\+Unpack.\+c}!Type@{Type}}
\index{Type@{Type}!update\+Unpack.\+c@{update\+Unpack.\+c}}
\subsubsection[{\texorpdfstring{Type}{Type}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf update\+Unpack\+\_\+\+Type\+\_\+t} Type = {\bf T\+Y\+P\+E\+\_\+\+U\+N\+K\+N\+O\+WN}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_unpack_8c_a6a0eb280d526ff327d548c4ceb7219cb}{}\label{update_unpack_8c_a6a0eb280d526ff327d548c4ceb7219cb}


What type of update pack is it? 

