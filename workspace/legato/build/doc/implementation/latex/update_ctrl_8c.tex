\hypertarget{update_ctrl_8c}{}\section{framework/daemons/linux/update\+Daemon/update\+Ctrl.c File Reference}
\label{update_ctrl_8c}\index{framework/daemons/linux/update\+Daemon/update\+Ctrl.\+c@{framework/daemons/linux/update\+Daemon/update\+Ctrl.\+c}}
{\ttfamily \#include \char`\"{}legato.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}limit.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}interfaces.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}sys\+Status.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}system.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}update\+Ctrl.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct_client_lock_count_obj__t}{Client\+Lock\+Count\+Obj\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{update_ctrl_8c_acc33b4816e0349898651174a9d931b16}{U\+P\+D\+A\+T\+E\+C\+T\+R\+L\+\_\+\+H\+A\+S\+T\+A\+B\+L\+E\+\_\+\+W\+I\+D\+TH}~31
\begin{DoxyCompactList}\small\item\em Width of the hash table (s/b prime) \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_aede1713464b3aae88fb03212b8b02037}{update\+Ctrl\+\_\+\+Set\+Probation\+Expiry\+Call\+Back} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void}($\ast$probation\+Expiry\+Callback)(\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void}))
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_ac3a8723a809719621248a6205cf400b9}{Free\+Dead\+Client\+Lock\+Objs} (\hyperlink{le__messaging_8h_aebfc01e15b430a5b4f3038a5bd518904}{le\+\_\+msg\+\_\+\+Session\+Ref\+\_\+t} \hyperlink{log_tool_8c_a0ba04d68f0faec00ca0db1c014f248be}{session\+Ref}, \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} $\ast$context\+Ptr)
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a265c2440707691e6e44c2f094a2e4e40}{update\+Ctrl\+\_\+\+Initialize} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{struct_client_lock_count_obj__t}{Client\+Lock\+Count\+Obj\+\_\+t} $\ast$ \hyperlink{update_ctrl_8c_a48b8617d60b759e8cdf3dfef53e0d205}{Create\+Client\+Lock\+Count\+Obj} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a4c48ca77671099062b6a932e420c27af}{Increment\+Probation\+Locks} (pid\+\_\+t client\+Pid)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a004d5db51a1858b54efab5542ff0b17c}{Decrement\+Probation\+Locks} (pid\+\_\+t client\+Pid)
\item 
static bool \hyperlink{update_ctrl_8c_a89d816d1fa1545e94a2f401047c37d46}{Is\+Client\+Probation\+Locked} (pid\+\_\+t client\+Pid)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a6bf36729960d76d7fc453189f0716f06}{Increment\+Defers} (pid\+\_\+t client\+Pid)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a64aeca37362a138a31e307d0368d8048}{Decrement\+Defers} (pid\+\_\+t client\+Pid)
\item 
static bool \hyperlink{update_ctrl_8c_a070d4a3b264b10ea6c7b4d9509f8cb41}{Is\+Client\+Deferring} (pid\+\_\+t client\+Pid)
\item 
bool \hyperlink{update_ctrl_8c_a7d0d666acf469d56e7fefb046da8b2e9}{update\+Ctrl\+\_\+\+Has\+Defers} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static pid\+\_\+t \hyperlink{update_ctrl_8c_ab041bfacd3b38c7678ced585d3dee652}{Get\+Client\+Pid} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
bool \hyperlink{update_ctrl_8c_a580f6f9e5dfad065ac68bd887a0c412c}{update\+Ctrl\+\_\+\+Is\+Probation\+Locked} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_acdbc9dcc05455f0dd1020b875909c3ed}{le\+\_\+update\+Ctrl\+\_\+\+Defer} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_ab3955f0e34df43a5fbe3e9eae16040d4}{le\+\_\+update\+Ctrl\+\_\+\+Allow} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
bool \hyperlink{update_ctrl_8c_a88e55c6e0ee5c2cf52e6fcb75a9db87e}{le\+\_\+update\+Ctrl\+\_\+\+Lock\+Probation} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a4ba5ace59bfe352c518c3f1eae6d0448}{le\+\_\+update\+Ctrl\+\_\+\+Unlock\+Probation} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static bool \hyperlink{update_ctrl_8c_aa78adc7ec4e0dbcc2ee05d3fe5b83185}{Log\+Lock} (const \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} $\ast$key\+Ptr, const \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} $\ast$value\+Ptr, \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} $\ast$context\+Ptr)
\item 
\hyperlink{le__basics_8h_a1cca095ed6ebab24b57a636382a6c86c}{le\+\_\+result\+\_\+t} \hyperlink{update_ctrl_8c_a8eaa5f533d5d677397642c7b44ce7bb3}{le\+\_\+update\+Ctrl\+\_\+\+Mark\+Good} (bool force)
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a270db6f26ee8cdb53c78ef73da4593f8}{Begin\+Roll\+Back} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{update_ctrl_8c_a9f6a3bf7a830eb04823ea6188c12109c}{le\+\_\+update\+Ctrl\+\_\+\+Fail\+Probation} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{le__update_ctrl__interface_8h_a0e65bfd2d86ab1ad2ee2e5fafae461ee}{le\+\_\+update\+Ctrl\+\_\+\+System\+State\+\_\+t} \hyperlink{update_ctrl_8c_ab68e770c5caa42a6cd463a2827fe371e}{le\+\_\+update\+Ctrl\+\_\+\+Get\+System\+State} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{update_ctrl_8c_af0793e3619759c1142ca378687589d59}{Aggregate\+Probation\+Lock\+Count} = 0
\begin{DoxyCompactList}\small\item\em current count of locks held by all clients \end{DoxyCompactList}\item 
static int \hyperlink{update_ctrl_8c_a788d345a92c63187f7eccd21945d66f6}{Aggregate\+Defer\+Count} = 0
\begin{DoxyCompactList}\small\item\em count of all client update defers \end{DoxyCompactList}\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void}($\ast$ \hyperlink{update_ctrl_8c_a6f6f95efddba30fdc06a43632bdd1882}{Probation\+Expiry\+Callback} )(\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void}) = N\+U\+LL
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void}($\ast$ \hyperlink{update_ctrl_8c_ac0d55f4746ff77baeb44c91328c918b4}{Deferred\+Fail\+Callback} )(\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void}) = N\+U\+LL
\item 
static \hyperlink{le__mem_8h_a44a896f6a0a1a8c733e8038eb332989e}{le\+\_\+mem\+\_\+\+Pool\+Ref\+\_\+t} \hyperlink{update_ctrl_8c_a345f086c57039cac17fffb6b3b134f37}{Update\+Ctrl\+Pool}
\begin{DoxyCompactList}\small\item\em Mem pool to alloc lock count objects from. \end{DoxyCompactList}\item 
static \hyperlink{le__hashmap_8h_ae81c60860dbdb8c59beaf25985e5605a}{le\+\_\+hashmap\+\_\+\+Ref\+\_\+t} \hyperlink{update_ctrl_8c_a1852f0534559b53bfb5ec46630af1cb2}{Client\+Lock\+Counts\+Container}
\begin{DoxyCompactList}\small\item\em Container used to store lock count objects. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
For useage and information on update\+Ctrl see .api

Copyright (C) Sierra Wireless Inc. 

\subsection{Macro Definition Documentation}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!U\+P\+D\+A\+T\+E\+C\+T\+R\+L\+\_\+\+H\+A\+S\+T\+A\+B\+L\+E\+\_\+\+W\+I\+D\+TH@{U\+P\+D\+A\+T\+E\+C\+T\+R\+L\+\_\+\+H\+A\+S\+T\+A\+B\+L\+E\+\_\+\+W\+I\+D\+TH}}
\index{U\+P\+D\+A\+T\+E\+C\+T\+R\+L\+\_\+\+H\+A\+S\+T\+A\+B\+L\+E\+\_\+\+W\+I\+D\+TH@{U\+P\+D\+A\+T\+E\+C\+T\+R\+L\+\_\+\+H\+A\+S\+T\+A\+B\+L\+E\+\_\+\+W\+I\+D\+TH}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{U\+P\+D\+A\+T\+E\+C\+T\+R\+L\+\_\+\+H\+A\+S\+T\+A\+B\+L\+E\+\_\+\+W\+I\+D\+TH}{UPDATECTRL_HASTABLE_WIDTH}}]{\setlength{\rightskip}{0pt plus 5cm}\#define U\+P\+D\+A\+T\+E\+C\+T\+R\+L\+\_\+\+H\+A\+S\+T\+A\+B\+L\+E\+\_\+\+W\+I\+D\+TH~31}\hypertarget{update_ctrl_8c_acc33b4816e0349898651174a9d931b16}{}\label{update_ctrl_8c_acc33b4816e0349898651174a9d931b16}


Width of the hash table (s/b prime) 



\subsection{Function Documentation}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Begin\+Roll\+Back@{Begin\+Roll\+Back}}
\index{Begin\+Roll\+Back@{Begin\+Roll\+Back}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Begin\+Roll\+Back(void)}{BeginRollBack(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Begin\+Roll\+Back (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a270db6f26ee8cdb53c78ef73da4593f8}{}\label{update_ctrl_8c_a270db6f26ee8cdb53c78ef73da4593f8}
We have marked the current system bad. To begin the roll back all we do is restart the framework. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Create\+Client\+Lock\+Count\+Obj@{Create\+Client\+Lock\+Count\+Obj}}
\index{Create\+Client\+Lock\+Count\+Obj@{Create\+Client\+Lock\+Count\+Obj}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Create\+Client\+Lock\+Count\+Obj(void)}{CreateClientLockCountObj(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf Client\+Lock\+Count\+Obj\+\_\+t}$\ast$ Create\+Client\+Lock\+Count\+Obj (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a48b8617d60b759e8cdf3dfef53e0d205}{}\label{update_ctrl_8c_a48b8617d60b759e8cdf3dfef53e0d205}
Construct a clean client lock count object \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Decrement\+Defers@{Decrement\+Defers}}
\index{Decrement\+Defers@{Decrement\+Defers}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Decrement\+Defers(pid\+\_\+t client\+Pid)}{DecrementDefers(pid_t clientPid)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Decrement\+Defers (
\begin{DoxyParamCaption}
\item[{pid\+\_\+t}]{client\+Pid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a64aeca37362a138a31e307d0368d8048}{}\label{update_ctrl_8c_a64aeca37362a138a31e307d0368d8048}
If the pid has a probation defer count, decrement it. If the lock object for the process now has no counts for either probation or defers, delete it and free its storage. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Decrement\+Probation\+Locks@{Decrement\+Probation\+Locks}}
\index{Decrement\+Probation\+Locks@{Decrement\+Probation\+Locks}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Decrement\+Probation\+Locks(pid\+\_\+t client\+Pid)}{DecrementProbationLocks(pid_t clientPid)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Decrement\+Probation\+Locks (
\begin{DoxyParamCaption}
\item[{pid\+\_\+t}]{client\+Pid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a004d5db51a1858b54efab5542ff0b17c}{}\label{update_ctrl_8c_a004d5db51a1858b54efab5542ff0b17c}
If the pid has a probation lock count, decrement it. If the lock object for the process now has no counts for either probation or defers, delete it and free its storage. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Free\+Dead\+Client\+Lock\+Objs@{Free\+Dead\+Client\+Lock\+Objs}}
\index{Free\+Dead\+Client\+Lock\+Objs@{Free\+Dead\+Client\+Lock\+Objs}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Free\+Dead\+Client\+Lock\+Objs(le\+\_\+msg\+\_\+\+Session\+Ref\+\_\+t session\+Ref, void $\ast$context\+Ptr)}{FreeDeadClientLockObjs(le_msg_SessionRef_t sessionRef, void *contextPtr)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Free\+Dead\+Client\+Lock\+Objs (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+msg\+\_\+\+Session\+Ref\+\_\+t}}]{session\+Ref, }
\item[{{\bf void} $\ast$}]{context\+Ptr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_ac3a8723a809719621248a6205cf400b9}{}\label{update_ctrl_8c_ac3a8723a809719621248a6205cf400b9}
When a client dies deallocate any storage we allocated to store its counts.

\begin{DoxyNote}{Note}
If a client dies while holding probation-\/locks, it is better to let the framework reboot (to avoid marking system good despite of failure) at its earliest convenience. However, if a client dies while holding defer-\/locks, it is probably OK to release the defer-\/locks (held by dead client) without reboot. 
\end{DoxyNote}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Get\+Client\+Pid@{Get\+Client\+Pid}}
\index{Get\+Client\+Pid@{Get\+Client\+Pid}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Get\+Client\+Pid(void)}{GetClientPid(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static pid\+\_\+t Get\+Client\+Pid (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_ab041bfacd3b38c7678ced585d3dee652}{}\label{update_ctrl_8c_ab041bfacd3b38c7678ced585d3dee652}
Get the P\+ID of the calling client \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Increment\+Defers@{Increment\+Defers}}
\index{Increment\+Defers@{Increment\+Defers}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Increment\+Defers(pid\+\_\+t client\+Pid)}{IncrementDefers(pid_t clientPid)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Increment\+Defers (
\begin{DoxyParamCaption}
\item[{pid\+\_\+t}]{client\+Pid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a6bf36729960d76d7fc453189f0716f06}{}\label{update_ctrl_8c_a6bf36729960d76d7fc453189f0716f06}
If the pid has a lock object, increment the defer count, else create a lock object for the process and set the defer coutn to 1. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Increment\+Probation\+Locks@{Increment\+Probation\+Locks}}
\index{Increment\+Probation\+Locks@{Increment\+Probation\+Locks}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Increment\+Probation\+Locks(pid\+\_\+t client\+Pid)}{IncrementProbationLocks(pid_t clientPid)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Increment\+Probation\+Locks (
\begin{DoxyParamCaption}
\item[{pid\+\_\+t}]{client\+Pid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a4c48ca77671099062b6a932e420c27af}{}\label{update_ctrl_8c_a4c48ca77671099062b6a932e420c27af}
If the pid has a lock object, increment the probation locks, else create a lock object for the process and set the probation lock to 1. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Is\+Client\+Deferring@{Is\+Client\+Deferring}}
\index{Is\+Client\+Deferring@{Is\+Client\+Deferring}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Is\+Client\+Deferring(pid\+\_\+t client\+Pid)}{IsClientDeferring(pid_t clientPid)}}]{\setlength{\rightskip}{0pt plus 5cm}static bool Is\+Client\+Deferring (
\begin{DoxyParamCaption}
\item[{pid\+\_\+t}]{client\+Pid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a070d4a3b264b10ea6c7b4d9509f8cb41}{}\label{update_ctrl_8c_a070d4a3b264b10ea6c7b4d9509f8cb41}
Does the client have a defer count?

\begin{DoxyReturn}{Returns}
true if the client is deferring updates 
\end{DoxyReturn}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Is\+Client\+Probation\+Locked@{Is\+Client\+Probation\+Locked}}
\index{Is\+Client\+Probation\+Locked@{Is\+Client\+Probation\+Locked}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Is\+Client\+Probation\+Locked(pid\+\_\+t client\+Pid)}{IsClientProbationLocked(pid_t clientPid)}}]{\setlength{\rightskip}{0pt plus 5cm}static bool Is\+Client\+Probation\+Locked (
\begin{DoxyParamCaption}
\item[{pid\+\_\+t}]{client\+Pid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a89d816d1fa1545e94a2f401047c37d46}{}\label{update_ctrl_8c_a89d816d1fa1545e94a2f401047c37d46}
Does the client hold a probation lock?

\begin{DoxyReturn}{Returns}
true if the client holds a probation lock 
\end{DoxyReturn}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!le\+\_\+update\+Ctrl\+\_\+\+Allow@{le\+\_\+update\+Ctrl\+\_\+\+Allow}}
\index{le\+\_\+update\+Ctrl\+\_\+\+Allow@{le\+\_\+update\+Ctrl\+\_\+\+Allow}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+update\+Ctrl\+\_\+\+Allow(void)}{le_updateCtrl_Allow(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} le\+\_\+update\+Ctrl\+\_\+\+Allow (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_ab3955f0e34df43a5fbe3e9eae16040d4}{}\label{update_ctrl_8c_ab3955f0e34df43a5fbe3e9eae16040d4}
Allow updates to go ahead. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!le\+\_\+update\+Ctrl\+\_\+\+Defer@{le\+\_\+update\+Ctrl\+\_\+\+Defer}}
\index{le\+\_\+update\+Ctrl\+\_\+\+Defer@{le\+\_\+update\+Ctrl\+\_\+\+Defer}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+update\+Ctrl\+\_\+\+Defer(void)}{le_updateCtrl_Defer(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} le\+\_\+update\+Ctrl\+\_\+\+Defer (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_acdbc9dcc05455f0dd1020b875909c3ed}{}\label{update_ctrl_8c_acdbc9dcc05455f0dd1020b875909c3ed}
Prevent all updates (and roll-\/backs) until further notice. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!le\+\_\+update\+Ctrl\+\_\+\+Fail\+Probation@{le\+\_\+update\+Ctrl\+\_\+\+Fail\+Probation}}
\index{le\+\_\+update\+Ctrl\+\_\+\+Fail\+Probation@{le\+\_\+update\+Ctrl\+\_\+\+Fail\+Probation}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+update\+Ctrl\+\_\+\+Fail\+Probation(void)}{le_updateCtrl_FailProbation(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} le\+\_\+update\+Ctrl\+\_\+\+Fail\+Probation (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_a9f6a3bf7a830eb04823ea6188c12109c}{}\label{update_ctrl_8c_a9f6a3bf7a830eb04823ea6188c12109c}
Marks the system \char`\"{}bad\char`\"{} and triggers a roll-\/back to a \char`\"{}good\char`\"{} system.

\begin{DoxyNote}{Note}
Ignored if the probation period has already ended. Also, the roll-\/back may be delayed if someone is deferring updates using \hyperlink{update_ctrl_8c_acdbc9dcc05455f0dd1020b875909c3ed}{le\+\_\+update\+Ctrl\+\_\+\+Defer()}. 
\end{DoxyNote}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!le\+\_\+update\+Ctrl\+\_\+\+Get\+System\+State@{le\+\_\+update\+Ctrl\+\_\+\+Get\+System\+State}}
\index{le\+\_\+update\+Ctrl\+\_\+\+Get\+System\+State@{le\+\_\+update\+Ctrl\+\_\+\+Get\+System\+State}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+update\+Ctrl\+\_\+\+Get\+System\+State(void)}{le_updateCtrl_GetSystemState(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+update\+Ctrl\+\_\+\+System\+State\+\_\+t} le\+\_\+update\+Ctrl\+\_\+\+Get\+System\+State (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_ab68e770c5caa42a6cd463a2827fe371e}{}\label{update_ctrl_8c_ab68e770c5caa42a6cd463a2827fe371e}
Get the current system state.

\begin{DoxyNote}{Note}
Can only be called if updates have been deferred or if a probation lock is held. Otherwise the system state could change between the time this function is called and when the return value is checked. 
\end{DoxyNote}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!le\+\_\+update\+Ctrl\+\_\+\+Lock\+Probation@{le\+\_\+update\+Ctrl\+\_\+\+Lock\+Probation}}
\index{le\+\_\+update\+Ctrl\+\_\+\+Lock\+Probation@{le\+\_\+update\+Ctrl\+\_\+\+Lock\+Probation}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+update\+Ctrl\+\_\+\+Lock\+Probation(void)}{le_updateCtrl_LockProbation(void)}}]{\setlength{\rightskip}{0pt plus 5cm}bool le\+\_\+update\+Ctrl\+\_\+\+Lock\+Probation (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_a88e55c6e0ee5c2cf52e6fcb75a9db87e}{}\label{update_ctrl_8c_a88e55c6e0ee5c2cf52e6fcb75a9db87e}
Prevent the probation period from ending.

\begin{DoxyNote}{Note}
Ignored if the probation period has already ended. 
\end{DoxyNote}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!le\+\_\+update\+Ctrl\+\_\+\+Mark\+Good@{le\+\_\+update\+Ctrl\+\_\+\+Mark\+Good}}
\index{le\+\_\+update\+Ctrl\+\_\+\+Mark\+Good@{le\+\_\+update\+Ctrl\+\_\+\+Mark\+Good}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+update\+Ctrl\+\_\+\+Mark\+Good(bool force)}{le_updateCtrl_MarkGood(bool force)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+result\+\_\+t} le\+\_\+update\+Ctrl\+\_\+\+Mark\+Good (
\begin{DoxyParamCaption}
\item[{bool}]{force}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_a8eaa5f533d5d677397642c7b44ce7bb3}{}\label{update_ctrl_8c_a8eaa5f533d5d677397642c7b44ce7bb3}
Marks the system \char`\"{}good\char`\"{}, ending the probation period.

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item L\+E\+\_\+\+OK The system was marked Good
\item L\+E\+\_\+\+B\+U\+SY Someone holds a probation lock
\item L\+E\+\_\+\+D\+U\+P\+L\+I\+C\+A\+TE Probation has expired -\/ the system has already been marked 
\end{DoxyItemize}
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em force} & True to set system Good even if someone holds a probation lock \\
\hline
\end{DoxyParams}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!le\+\_\+update\+Ctrl\+\_\+\+Unlock\+Probation@{le\+\_\+update\+Ctrl\+\_\+\+Unlock\+Probation}}
\index{le\+\_\+update\+Ctrl\+\_\+\+Unlock\+Probation@{le\+\_\+update\+Ctrl\+\_\+\+Unlock\+Probation}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+update\+Ctrl\+\_\+\+Unlock\+Probation(void)}{le_updateCtrl_UnlockProbation(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} le\+\_\+update\+Ctrl\+\_\+\+Unlock\+Probation (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_a4ba5ace59bfe352c518c3f1eae6d0448}{}\label{update_ctrl_8c_a4ba5ace59bfe352c518c3f1eae6d0448}
Cancels a call to Lock\+Probation(), allow the probation period to end.

\begin{DoxyNote}{Note}
Ignored if the probation period has already ended. 
\end{DoxyNote}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Log\+Lock@{Log\+Lock}}
\index{Log\+Lock@{Log\+Lock}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Log\+Lock(const void $\ast$key\+Ptr, const void $\ast$value\+Ptr, void $\ast$context\+Ptr)}{LogLock(const void *keyPtr, const void *valuePtr, void *contextPtr)}}]{\setlength{\rightskip}{0pt plus 5cm}static bool Log\+Lock (
\begin{DoxyParamCaption}
\item[{const {\bf void} $\ast$}]{key\+Ptr, }
\item[{const {\bf void} $\ast$}]{value\+Ptr, }
\item[{{\bf void} $\ast$}]{context\+Ptr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_aa78adc7ec4e0dbcc2ee05d3fe5b83185}{}\label{update_ctrl_8c_aa78adc7ec4e0dbcc2ee05d3fe5b83185}
Log any processes holding probation locks \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!update\+Ctrl\+\_\+\+Has\+Defers@{update\+Ctrl\+\_\+\+Has\+Defers}}
\index{update\+Ctrl\+\_\+\+Has\+Defers@{update\+Ctrl\+\_\+\+Has\+Defers}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{update\+Ctrl\+\_\+\+Has\+Defers(void)}{updateCtrl_HasDefers(void)}}]{\setlength{\rightskip}{0pt plus 5cm}bool update\+Ctrl\+\_\+\+Has\+Defers (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_a7d0d666acf469d56e7fefb046da8b2e9}{}\label{update_ctrl_8c_a7d0d666acf469d56e7fefb046da8b2e9}
Check for defer counts for any processes that we have records for. \begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item true At least one process holds at least one defer.
\item false No defers are found. 
\end{DoxyItemize}
\end{DoxyReturn}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!update\+Ctrl\+\_\+\+Initialize@{update\+Ctrl\+\_\+\+Initialize}}
\index{update\+Ctrl\+\_\+\+Initialize@{update\+Ctrl\+\_\+\+Initialize}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{update\+Ctrl\+\_\+\+Initialize(void)}{updateCtrl_Initialize(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} update\+Ctrl\+\_\+\+Initialize (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_a265c2440707691e6e44c2f094a2e4e40}{}\label{update_ctrl_8c_a265c2440707691e6e44c2f094a2e4e40}
Initialize the mem pool so we can allocate our counter objects and set up the hash we will store them in. This will be done in a lazy way. We will only do the work of initializing if someone actually want to use this. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!update\+Ctrl\+\_\+\+Is\+Probation\+Locked@{update\+Ctrl\+\_\+\+Is\+Probation\+Locked}}
\index{update\+Ctrl\+\_\+\+Is\+Probation\+Locked@{update\+Ctrl\+\_\+\+Is\+Probation\+Locked}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{update\+Ctrl\+\_\+\+Is\+Probation\+Locked(void)}{updateCtrl_IsProbationLocked(void)}}]{\setlength{\rightskip}{0pt plus 5cm}bool update\+Ctrl\+\_\+\+Is\+Probation\+Locked (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_a580f6f9e5dfad065ac68bd887a0c412c}{}\label{update_ctrl_8c_a580f6f9e5dfad065ac68bd887a0c412c}
Called from the probation timout handler to determine whether it is OK to mark the system \char`\"{}good\char`\"{}.

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item true If probation is locked
\item false Probation is not locked 
\end{DoxyItemize}
\end{DoxyReturn}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!update\+Ctrl\+\_\+\+Set\+Probation\+Expiry\+Call\+Back@{update\+Ctrl\+\_\+\+Set\+Probation\+Expiry\+Call\+Back}}
\index{update\+Ctrl\+\_\+\+Set\+Probation\+Expiry\+Call\+Back@{update\+Ctrl\+\_\+\+Set\+Probation\+Expiry\+Call\+Back}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{update\+Ctrl\+\_\+\+Set\+Probation\+Expiry\+Call\+Back(void($\ast$probation\+Expiry\+Callback)(void))}{updateCtrl_SetProbationExpiryCallBack(void(*probationExpiryCallback)(void))}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} update\+Ctrl\+\_\+\+Set\+Probation\+Expiry\+Call\+Back (
\begin{DoxyParamCaption}
\item[{{\bf void}($\ast$)({\bf void})}]{probation\+Expiry\+Callback}
\end{DoxyParamCaption}
)}\hypertarget{update_ctrl_8c_aede1713464b3aae88fb03212b8b02037}{}\label{update_ctrl_8c_aede1713464b3aae88fb03212b8b02037}
Set a callback to call for when all probation locks are removed. 

\subsection{Variable Documentation}
\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Aggregate\+Defer\+Count@{Aggregate\+Defer\+Count}}
\index{Aggregate\+Defer\+Count@{Aggregate\+Defer\+Count}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Aggregate\+Defer\+Count}{AggregateDeferCount}}]{\setlength{\rightskip}{0pt plus 5cm}int Aggregate\+Defer\+Count = 0\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a788d345a92c63187f7eccd21945d66f6}{}\label{update_ctrl_8c_a788d345a92c63187f7eccd21945d66f6}


count of all client update defers 

\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Aggregate\+Probation\+Lock\+Count@{Aggregate\+Probation\+Lock\+Count}}
\index{Aggregate\+Probation\+Lock\+Count@{Aggregate\+Probation\+Lock\+Count}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Aggregate\+Probation\+Lock\+Count}{AggregateProbationLockCount}}]{\setlength{\rightskip}{0pt plus 5cm}int Aggregate\+Probation\+Lock\+Count = 0\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_af0793e3619759c1142ca378687589d59}{}\label{update_ctrl_8c_af0793e3619759c1142ca378687589d59}


current count of locks held by all clients 

\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Client\+Lock\+Counts\+Container@{Client\+Lock\+Counts\+Container}}
\index{Client\+Lock\+Counts\+Container@{Client\+Lock\+Counts\+Container}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Client\+Lock\+Counts\+Container}{ClientLockCountsContainer}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+hashmap\+\_\+\+Ref\+\_\+t} Client\+Lock\+Counts\+Container\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a1852f0534559b53bfb5ec46630af1cb2}{}\label{update_ctrl_8c_a1852f0534559b53bfb5ec46630af1cb2}


Container used to store lock count objects. 

\index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Deferred\+Fail\+Callback@{Deferred\+Fail\+Callback}}
\index{Deferred\+Fail\+Callback@{Deferred\+Fail\+Callback}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Deferred\+Fail\+Callback}{DeferredFailCallback}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void}($\ast$ Deferred\+Fail\+Callback) ({\bf void}) = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_ac0d55f4746ff77baeb44c91328c918b4}{}\label{update_ctrl_8c_ac0d55f4746ff77baeb44c91328c918b4}
If the update\+Daemon tries to fail/rollback the system while a defer is in effect, it will set this callback. When the defer is lifted we will call back to let the fail proceed. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Probation\+Expiry\+Callback@{Probation\+Expiry\+Callback}}
\index{Probation\+Expiry\+Callback@{Probation\+Expiry\+Callback}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Probation\+Expiry\+Callback}{ProbationExpiryCallback}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void}($\ast$ Probation\+Expiry\+Callback) ({\bf void}) = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a6f6f95efddba30fdc06a43632bdd1882}{}\label{update_ctrl_8c_a6f6f95efddba30fdc06a43632bdd1882}
Update Dameon will set this callback if it tries to expire probation while it is locked. We callback if/when all prbation locks are revoked. \index{update\+Ctrl.\+c@{update\+Ctrl.\+c}!Update\+Ctrl\+Pool@{Update\+Ctrl\+Pool}}
\index{Update\+Ctrl\+Pool@{Update\+Ctrl\+Pool}!update\+Ctrl.\+c@{update\+Ctrl.\+c}}
\subsubsection[{\texorpdfstring{Update\+Ctrl\+Pool}{UpdateCtrlPool}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+mem\+\_\+\+Pool\+Ref\+\_\+t} Update\+Ctrl\+Pool\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{update_ctrl_8c_a345f086c57039cac17fffb6b3b134f37}{}\label{update_ctrl_8c_a345f086c57039cac17fffb6b3b134f37}


Mem pool to alloc lock count objects from. 

