\hypertarget{ima_8c}{}\section{framework/liblegato/linux/ima.c File Reference}
\label{ima_8c}\index{framework/liblegato/linux/ima.\+c@{framework/liblegato/linux/ima.\+c}}
{\ttfamily \#include \char`\"{}legato.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}limit.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}file.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}file\+Descriptor.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}sys\+Paths.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ima.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ima_8c_afce13f42bc7539a1c30bb34114af943b}{M\+A\+X\+\_\+\+C\+M\+D\+\_\+\+B\+Y\+T\+ES}~4096
\item 
\#define \hyperlink{ima_8c_a9974a1f9fe11e76ac7c38a8e4ac99cdb}{E\+V\+M\+C\+T\+L\+\_\+\+P\+A\+TH}~\char`\"{}/usr/bin/evmctl\char`\"{}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{le__basics_8h_a1cca095ed6ebab24b57a636382a6c86c}{le\+\_\+result\+\_\+t} \hyperlink{ima_8c_a5f0ca9f75e078bc915aef4007c5f4244}{Verify\+File} (const char $\ast$file\+Path, const char $\ast$cert\+Path)
\item 
static \hyperlink{le__basics_8h_a1cca095ed6ebab24b57a636382a6c86c}{le\+\_\+result\+\_\+t} \hyperlink{ima_8c_a3aca60b4f1309359db818b353e97e6a3}{Verify\+Dir} (const char $\ast$dir\+Path, const char $\ast$cert\+Path)
\item 
static \hyperlink{le__basics_8h_a1cca095ed6ebab24b57a636382a6c86c}{le\+\_\+result\+\_\+t} \hyperlink{ima_8c_ac7fe8705d8e6e17dfaa79ab55d5cf4bc}{Import\+Public\+Cert} (const char $\ast$cert\+Path)
\item 
\hyperlink{le__basics_8h_a1cca095ed6ebab24b57a636382a6c86c}{le\+\_\+result\+\_\+t} \hyperlink{ima_8c_a11bf66903144e076ecda77a3f48e79ea}{ima\+\_\+\+Verify\+File} (const char $\ast$file\+Path, const char $\ast$cert\+Path)
\item 
\hyperlink{le__basics_8h_a1cca095ed6ebab24b57a636382a6c86c}{le\+\_\+result\+\_\+t} \hyperlink{ima_8c_a10ab900e7ace70e28fba1274dee35538}{ima\+\_\+\+Verify\+Dir} (const char $\ast$dir\+Path, const char $\ast$cert\+Path)
\item 
bool \hyperlink{ima_8c_af504c4032f516986b48015c75135edd2}{ima\+\_\+\+Is\+Enabled} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{le__basics_8h_a1cca095ed6ebab24b57a636382a6c86c}{le\+\_\+result\+\_\+t} \hyperlink{ima_8c_a8b535fc6c48361313ac807326affb534}{ima\+\_\+\+Import\+Public\+Cert} (const char $\ast$cert\+Path)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file implements functions that can be used to import I\+MA keys (into the kernel keyring) and verify I\+MA signatures.

Copyright (C) Sierra Wireless Inc. 

\subsection{Macro Definition Documentation}
\index{ima.\+c@{ima.\+c}!E\+V\+M\+C\+T\+L\+\_\+\+P\+A\+TH@{E\+V\+M\+C\+T\+L\+\_\+\+P\+A\+TH}}
\index{E\+V\+M\+C\+T\+L\+\_\+\+P\+A\+TH@{E\+V\+M\+C\+T\+L\+\_\+\+P\+A\+TH}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{E\+V\+M\+C\+T\+L\+\_\+\+P\+A\+TH}{EVMCTL_PATH}}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\+V\+M\+C\+T\+L\+\_\+\+P\+A\+TH~\char`\"{}/usr/bin/evmctl\char`\"{}}\hypertarget{ima_8c_a9974a1f9fe11e76ac7c38a8e4ac99cdb}{}\label{ima_8c_a9974a1f9fe11e76ac7c38a8e4ac99cdb}
Path to evmctl tool. It can be used for producing and verifying I\+MA signatures. It can be also used to import keys into the kernel keyring. \index{ima.\+c@{ima.\+c}!M\+A\+X\+\_\+\+C\+M\+D\+\_\+\+B\+Y\+T\+ES@{M\+A\+X\+\_\+\+C\+M\+D\+\_\+\+B\+Y\+T\+ES}}
\index{M\+A\+X\+\_\+\+C\+M\+D\+\_\+\+B\+Y\+T\+ES@{M\+A\+X\+\_\+\+C\+M\+D\+\_\+\+B\+Y\+T\+ES}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{M\+A\+X\+\_\+\+C\+M\+D\+\_\+\+B\+Y\+T\+ES}{MAX_CMD_BYTES}}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+C\+M\+D\+\_\+\+B\+Y\+T\+ES~4096}\hypertarget{ima_8c_afce13f42bc7539a1c30bb34114af943b}{}\label{ima_8c_afce13f42bc7539a1c30bb34114af943b}
Max size of I\+MA command 

\subsection{Function Documentation}
\index{ima.\+c@{ima.\+c}!ima\+\_\+\+Import\+Public\+Cert@{ima\+\_\+\+Import\+Public\+Cert}}
\index{ima\+\_\+\+Import\+Public\+Cert@{ima\+\_\+\+Import\+Public\+Cert}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{ima\+\_\+\+Import\+Public\+Cert(const char $\ast$cert\+Path)}{ima_ImportPublicCert(const char *certPath)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+result\+\_\+t} ima\+\_\+\+Import\+Public\+Cert (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{cert\+Path}
\end{DoxyParamCaption}
)}\hypertarget{ima_8c_a8b535fc6c48361313ac807326affb534}{}\label{ima_8c_a8b535fc6c48361313ac807326affb534}
Import I\+MA public certificate to linux keyring. Public certificate must be signed by system private key to import it properly. Only privileged process with right permission and smack label will be able to do that.

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item L\+E\+\_\+\+OK if imports properly
\item L\+E\+\_\+\+F\+A\+U\+LT if fails to import 
\end{DoxyItemize}
\end{DoxyReturn}
\index{ima.\+c@{ima.\+c}!ima\+\_\+\+Is\+Enabled@{ima\+\_\+\+Is\+Enabled}}
\index{ima\+\_\+\+Is\+Enabled@{ima\+\_\+\+Is\+Enabled}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{ima\+\_\+\+Is\+Enabled(void)}{ima_IsEnabled(void)}}]{\setlength{\rightskip}{0pt plus 5cm}bool ima\+\_\+\+Is\+Enabled (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{ima_8c_af504c4032f516986b48015c75135edd2}{}\label{ima_8c_af504c4032f516986b48015c75135edd2}
Check whether current linux kernel is I\+M\+A-\/enabled or not.

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item true if I\+MA is enabled.
\item false otherwise. 
\end{DoxyItemize}
\end{DoxyReturn}
\index{ima.\+c@{ima.\+c}!ima\+\_\+\+Verify\+Dir@{ima\+\_\+\+Verify\+Dir}}
\index{ima\+\_\+\+Verify\+Dir@{ima\+\_\+\+Verify\+Dir}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{ima\+\_\+\+Verify\+Dir(const char $\ast$dir\+Path, const char $\ast$cert\+Path)}{ima_VerifyDir(const char *dirPath, const char *certPath)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+result\+\_\+t} ima\+\_\+\+Verify\+Dir (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{dir\+Path, }
\item[{const char $\ast$}]{cert\+Path}
\end{DoxyParamCaption}
)}\hypertarget{ima_8c_a10ab900e7ace70e28fba1274dee35538}{}\label{ima_8c_a10ab900e7ace70e28fba1274dee35538}
Recursively traverse the directory and verify each file I\+MA signature against provided public certificate path

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item L\+E\+\_\+\+OK on success
\item L\+E\+\_\+\+F\+A\+U\+LT otherwise 
\end{DoxyItemize}
\end{DoxyReturn}
\index{ima.\+c@{ima.\+c}!ima\+\_\+\+Verify\+File@{ima\+\_\+\+Verify\+File}}
\index{ima\+\_\+\+Verify\+File@{ima\+\_\+\+Verify\+File}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{ima\+\_\+\+Verify\+File(const char $\ast$file\+Path, const char $\ast$cert\+Path)}{ima_VerifyFile(const char *filePath, const char *certPath)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+result\+\_\+t} ima\+\_\+\+Verify\+File (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{file\+Path, }
\item[{const char $\ast$}]{cert\+Path}
\end{DoxyParamCaption}
)}\hypertarget{ima_8c_a11bf66903144e076ecda77a3f48e79ea}{}\label{ima_8c_a11bf66903144e076ecda77a3f48e79ea}
Verify a file I\+MA signature against provided public certificate path

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item L\+E\+\_\+\+OK on success
\item L\+E\+\_\+\+F\+A\+U\+LT otherwise 
\end{DoxyItemize}
\end{DoxyReturn}
\index{ima.\+c@{ima.\+c}!Import\+Public\+Cert@{Import\+Public\+Cert}}
\index{Import\+Public\+Cert@{Import\+Public\+Cert}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{Import\+Public\+Cert(const char $\ast$cert\+Path)}{ImportPublicCert(const char *certPath)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf le\+\_\+result\+\_\+t} Import\+Public\+Cert (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{cert\+Path}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{ima_8c_ac7fe8705d8e6e17dfaa79ab55d5cf4bc}{}\label{ima_8c_ac7fe8705d8e6e17dfaa79ab55d5cf4bc}
Import I\+MA public certificate to linux keyring. Public certificate must be signed by system private key to import it properly.

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item L\+E\+\_\+\+OK if imports properly
\item L\+E\+\_\+\+F\+A\+U\+LT if fails to import 
\end{DoxyItemize}
\end{DoxyReturn}
\index{ima.\+c@{ima.\+c}!Verify\+Dir@{Verify\+Dir}}
\index{Verify\+Dir@{Verify\+Dir}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{Verify\+Dir(const char $\ast$dir\+Path, const char $\ast$cert\+Path)}{VerifyDir(const char *dirPath, const char *certPath)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf le\+\_\+result\+\_\+t} Verify\+Dir (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{dir\+Path, }
\item[{const char $\ast$}]{cert\+Path}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{ima_8c_a3aca60b4f1309359db818b353e97e6a3}{}\label{ima_8c_a3aca60b4f1309359db818b353e97e6a3}
Recursively traverse the directory and verify each file I\+MA signature against provided public certificate path

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item L\+E\+\_\+\+OK on success
\item L\+E\+\_\+\+F\+A\+U\+LT otherwise 
\end{DoxyItemize}
\end{DoxyReturn}
\index{ima.\+c@{ima.\+c}!Verify\+File@{Verify\+File}}
\index{Verify\+File@{Verify\+File}!ima.\+c@{ima.\+c}}
\subsubsection[{\texorpdfstring{Verify\+File(const char $\ast$file\+Path, const char $\ast$cert\+Path)}{VerifyFile(const char *filePath, const char *certPath)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf le\+\_\+result\+\_\+t} Verify\+File (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{file\+Path, }
\item[{const char $\ast$}]{cert\+Path}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{ima_8c_a5f0ca9f75e078bc915aef4007c5f4244}{}\label{ima_8c_a5f0ca9f75e078bc915aef4007c5f4244}
Verify a file I\+MA signature against provided public certificate path

\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item L\+E\+\_\+\+OK on success
\item L\+E\+\_\+\+F\+A\+U\+LT otherwise 
\end{DoxyItemize}
\end{DoxyReturn}
