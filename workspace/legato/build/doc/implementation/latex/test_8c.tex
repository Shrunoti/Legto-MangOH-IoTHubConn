\hypertarget{test_8c}{}\section{framework/liblegato/linux/test.c File Reference}
\label{test_8c}\index{framework/liblegato/linux/test.\+c@{framework/liblegato/linux/test.\+c}}
{\ttfamily \#include \char`\"{}legato.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct_child__t}{Child\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{test_8c_af8a87e22f3997924d2cf53a39fa7e7b8}{M\+A\+X\+\_\+\+C\+H\+I\+L\+D\+\_\+\+A\+R\+GS}~255
\begin{DoxyCompactList}\small\item\em Maximum number of arguments that can be passed to a child process. \end{DoxyCompactList}\item 
\#define \hyperlink{test_8c_a58213fc8c98b74cc4b9f941af517f6c7}{D\+E\+F\+A\+U\+L\+T\+\_\+\+N\+U\+M\+\_\+\+C\+H\+I\+L\+D\+R\+EN}~23
\begin{DoxyCompactList}\small\item\em If child unit test processes are used, this is the default number of children. \end{DoxyCompactList}\item 
\#define \hyperlink{test_8c_a0376b2ead2de10bb7ab6a4d21ec304e9}{L\+O\+CK}~\hyperlink{thread_8c_a63692d3983734584a66f2ca4db563ad6}{Lock}();
\begin{DoxyCompactList}\small\item\em Lock the mutex. \end{DoxyCompactList}\item 
\#define \hyperlink{test_8c_ac82effb31e82e32254efc8b57251d59e}{U\+N\+L\+O\+CK}~\hyperlink{mutex_8c_aae68b71222e20c55ff3bf2d7b52e3009}{le\+\_\+mutex\+\_\+\+Unlock}(\hyperlink{thread_8c_abc03085ccf7c38e092cdf06bf6b98ea6}{Mutex});
\begin{DoxyCompactList}\small\item\em Unlock the mutex. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{test_8c_a63692d3983734584a66f2ca4db563ad6}{Lock} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
static \hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{test_8c_aa0cc75e639f468cc21cf177a521905a5}{Init\+Child\+Tracking} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{test_8c_adae44bbfa6299b76dc232116908a8045}{\+\_\+le\+\_\+test\+\_\+\+Init} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{test_8c_ad793449c43650807ff598c2806074c11}{\+\_\+le\+\_\+test\+\_\+\+Fail} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
int \hyperlink{test_8c_af25acd8593c2fe66f5b5c30804cb862c}{\+\_\+le\+\_\+test\+\_\+\+Get\+Num\+Failures} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{le__test_8h_ab2de7b7c51414646bad2bc4ec2dda444}{le\+\_\+test\+\_\+\+Child\+Ref\+\_\+t} \hyperlink{test_8c_a567cce7d9f3d3a66f1bca3575f4ef846}{\+\_\+le\+\_\+test\+\_\+\+Fork} (const char $\ast$exe\+Path,...)
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{test_8c_a11f2785e8f09904c788cc847d1efde3a}{\+\_\+le\+\_\+test\+\_\+\+Join} (\hyperlink{le__test_8h_ab2de7b7c51414646bad2bc4ec2dda444}{le\+\_\+test\+\_\+\+Child\+Ref\+\_\+t} child)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{test_8c_af352398c4d2519fd630d449af577cea2}{Num\+Failures} = 0
\item 
static bool \hyperlink{test_8c_a9db2c1bd813d75d4cbbd387fd3d22b56}{Pass\+Through} = false
\item 
static const char \hyperlink{test_8c_acbbcacb7845b0cd0598ecc7e6b851f0b}{Pass\+Through\+Arg} \mbox{[}$\,$\mbox{]} = \char`\"{}-\/p\char`\"{}
\item 
static const char \hyperlink{test_8c_a2aa20c086050c7ff86157bbcac07b3f9}{Pass\+Through\+Arg\+Long\+Form} \mbox{[}$\,$\mbox{]} = \char`\"{}-\/-\/pass-\/through\char`\"{}
\item 
static \hyperlink{le__mutex_8h_ab2af11e2077e6bed9962eb7dfd54eb03}{le\+\_\+mutex\+\_\+\+Ref\+\_\+t} \hyperlink{test_8c_ae0c3ff15dbb06613e17fb22da85c6cf9}{Mutex}
\item 
static \hyperlink{le__safe_ref_8h_aaf8fb3412fb840cb50366856affaf69b}{le\+\_\+ref\+\_\+\+Map\+Ref\+\_\+t} \hyperlink{test_8c_a5195bef7813b4ab6759a72c04fbef318}{Child\+Ref\+Map} = N\+U\+LL
\item 
static \hyperlink{le__mem_8h_a44a896f6a0a1a8c733e8038eb332989e}{le\+\_\+mem\+\_\+\+Pool\+Ref\+\_\+t} \hyperlink{test_8c_a1df0cdbd5b378ffb2905648b17fe80a9}{Child\+Pool} = N\+U\+LL
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Implements the Legato Test Framework.

Copyright (C) Sierra Wireless Inc. 

\subsection{Macro Definition Documentation}
\index{test.\+c@{test.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+N\+U\+M\+\_\+\+C\+H\+I\+L\+D\+R\+EN@{D\+E\+F\+A\+U\+L\+T\+\_\+\+N\+U\+M\+\_\+\+C\+H\+I\+L\+D\+R\+EN}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+N\+U\+M\+\_\+\+C\+H\+I\+L\+D\+R\+EN@{D\+E\+F\+A\+U\+L\+T\+\_\+\+N\+U\+M\+\_\+\+C\+H\+I\+L\+D\+R\+EN}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{D\+E\+F\+A\+U\+L\+T\+\_\+\+N\+U\+M\+\_\+\+C\+H\+I\+L\+D\+R\+EN}{DEFAULT_NUM_CHILDREN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+N\+U\+M\+\_\+\+C\+H\+I\+L\+D\+R\+EN~23}\hypertarget{test_8c_a58213fc8c98b74cc4b9f941af517f6c7}{}\label{test_8c_a58213fc8c98b74cc4b9f941af517f6c7}


If child unit test processes are used, this is the default number of children. 

\index{test.\+c@{test.\+c}!L\+O\+CK@{L\+O\+CK}}
\index{L\+O\+CK@{L\+O\+CK}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{L\+O\+CK}{LOCK}}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\+O\+CK~{\bf Lock}();}\hypertarget{test_8c_a0376b2ead2de10bb7ab6a4d21ec304e9}{}\label{test_8c_a0376b2ead2de10bb7ab6a4d21ec304e9}


Lock the mutex. 

\index{test.\+c@{test.\+c}!M\+A\+X\+\_\+\+C\+H\+I\+L\+D\+\_\+\+A\+R\+GS@{M\+A\+X\+\_\+\+C\+H\+I\+L\+D\+\_\+\+A\+R\+GS}}
\index{M\+A\+X\+\_\+\+C\+H\+I\+L\+D\+\_\+\+A\+R\+GS@{M\+A\+X\+\_\+\+C\+H\+I\+L\+D\+\_\+\+A\+R\+GS}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{M\+A\+X\+\_\+\+C\+H\+I\+L\+D\+\_\+\+A\+R\+GS}{MAX_CHILD_ARGS}}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+C\+H\+I\+L\+D\+\_\+\+A\+R\+GS~255}\hypertarget{test_8c_af8a87e22f3997924d2cf53a39fa7e7b8}{}\label{test_8c_af8a87e22f3997924d2cf53a39fa7e7b8}


Maximum number of arguments that can be passed to a child process. 

\index{test.\+c@{test.\+c}!U\+N\+L\+O\+CK@{U\+N\+L\+O\+CK}}
\index{U\+N\+L\+O\+CK@{U\+N\+L\+O\+CK}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{U\+N\+L\+O\+CK}{UNLOCK}}]{\setlength{\rightskip}{0pt plus 5cm}\#define U\+N\+L\+O\+CK~{\bf le\+\_\+mutex\+\_\+\+Unlock}({\bf Mutex});}\hypertarget{test_8c_ac82effb31e82e32254efc8b57251d59e}{}\label{test_8c_ac82effb31e82e32254efc8b57251d59e}


Unlock the mutex. 



\subsection{Function Documentation}
\index{test.\+c@{test.\+c}!\+\_\+le\+\_\+test\+\_\+\+Fail@{\+\_\+le\+\_\+test\+\_\+\+Fail}}
\index{\+\_\+le\+\_\+test\+\_\+\+Fail@{\+\_\+le\+\_\+test\+\_\+\+Fail}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{\+\_\+le\+\_\+test\+\_\+\+Fail(void)}{_le_test_Fail(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \+\_\+le\+\_\+test\+\_\+\+Fail (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{test_8c_ad793449c43650807ff598c2806074c11}{}\label{test_8c_ad793449c43650807ff598c2806074c11}
Called when a test fails. Logs an error message and either exits right away or increments the number of failures. \index{test.\+c@{test.\+c}!\+\_\+le\+\_\+test\+\_\+\+Fork@{\+\_\+le\+\_\+test\+\_\+\+Fork}}
\index{\+\_\+le\+\_\+test\+\_\+\+Fork@{\+\_\+le\+\_\+test\+\_\+\+Fork}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{\+\_\+le\+\_\+test\+\_\+\+Fork(const char $\ast$exe\+Path,...)}{_le_test_Fork(const char *exePath,...)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+test\+\_\+\+Child\+Ref\+\_\+t} \+\_\+le\+\_\+test\+\_\+\+Fork (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{exe\+Path, }
\item[{}]{...}
\end{DoxyParamCaption}
)}\hypertarget{test_8c_a567cce7d9f3d3a66f1bca3575f4ef846}{}\label{test_8c_a567cce7d9f3d3a66f1bca3575f4ef846}
Fork a child process to run a unit test program.

\begin{DoxyReturn}{Returns}
A reference to the child process.
\end{DoxyReturn}
\begin{DoxyNote}{Note}
Terminates the calling process on failure to fork. 
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em exe\+Path} & String containing the path to the program to be executed. \\
\hline
\end{DoxyParams}
\index{test.\+c@{test.\+c}!\+\_\+le\+\_\+test\+\_\+\+Get\+Num\+Failures@{\+\_\+le\+\_\+test\+\_\+\+Get\+Num\+Failures}}
\index{\+\_\+le\+\_\+test\+\_\+\+Get\+Num\+Failures@{\+\_\+le\+\_\+test\+\_\+\+Get\+Num\+Failures}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{\+\_\+le\+\_\+test\+\_\+\+Get\+Num\+Failures(void)}{_le_test_GetNumFailures(void)}}]{\setlength{\rightskip}{0pt plus 5cm}int \+\_\+le\+\_\+test\+\_\+\+Get\+Num\+Failures (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{test_8c_af25acd8593c2fe66f5b5c30804cb862c}{}\label{test_8c_af25acd8593c2fe66f5b5c30804cb862c}
Returns the number of test failures. \index{test.\+c@{test.\+c}!\+\_\+le\+\_\+test\+\_\+\+Init@{\+\_\+le\+\_\+test\+\_\+\+Init}}
\index{\+\_\+le\+\_\+test\+\_\+\+Init@{\+\_\+le\+\_\+test\+\_\+\+Init}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{\+\_\+le\+\_\+test\+\_\+\+Init(void)}{_le_test_Init(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \+\_\+le\+\_\+test\+\_\+\+Init (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{test_8c_adae44bbfa6299b76dc232116908a8045}{}\label{test_8c_adae44bbfa6299b76dc232116908a8045}
Initializes the Legato test framework. This should be called once at the beginning of test process. \index{test.\+c@{test.\+c}!\+\_\+le\+\_\+test\+\_\+\+Join@{\+\_\+le\+\_\+test\+\_\+\+Join}}
\index{\+\_\+le\+\_\+test\+\_\+\+Join@{\+\_\+le\+\_\+test\+\_\+\+Join}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{\+\_\+le\+\_\+test\+\_\+\+Join(le\+\_\+test\+\_\+\+Child\+Ref\+\_\+t child)}{_le_test_Join(le_test_ChildRef_t child)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \+\_\+le\+\_\+test\+\_\+\+Join (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+test\+\_\+\+Child\+Ref\+\_\+t}}]{child}
\end{DoxyParamCaption}
)}\hypertarget{test_8c_a11f2785e8f09904c788cc847d1efde3a}{}\label{test_8c_a11f2785e8f09904c788cc847d1efde3a}
Wait for a given child process to terminate and add its results to the running test summary. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em child} & Child process reference returned by \hyperlink{le__test_8h_ac0c538ca3dfcd072464385b2f7e2776f}{L\+E\+\_\+\+T\+E\+S\+T\+\_\+\+F\+O\+R\+K()}. \\
\hline
\end{DoxyParams}
\index{test.\+c@{test.\+c}!Init\+Child\+Tracking@{Init\+Child\+Tracking}}
\index{Init\+Child\+Tracking@{Init\+Child\+Tracking}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Init\+Child\+Tracking(void)}{InitChildTracking(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Init\+Child\+Tracking (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_aa0cc75e639f468cc21cf177a521905a5}{}\label{test_8c_aa0cc75e639f468cc21cf177a521905a5}
Initialize the child process tracking data structures, if that hasn\textquotesingle{}t been done already.

Most processes don\textquotesingle{}t use this stuff, so we defer this until needed so we don\textquotesingle{}t eat C\+PU and memory for this stuff unless we need to. \index{test.\+c@{test.\+c}!Lock@{Lock}}
\index{Lock@{Lock}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Lock(void)}{Lock(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} Lock (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_a63692d3983734584a66f2ca4db563ad6}{}\label{test_8c_a63692d3983734584a66f2ca4db563ad6}
Lock the mutex, or fail with a helpful message if they forgot to run L\+E\+\_\+\+T\+E\+S\+T\+\_\+\+I\+N\+IT. 

\subsection{Variable Documentation}
\index{test.\+c@{test.\+c}!Child\+Pool@{Child\+Pool}}
\index{Child\+Pool@{Child\+Pool}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Child\+Pool}{ChildPool}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+mem\+\_\+\+Pool\+Ref\+\_\+t} Child\+Pool = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_a1df0cdbd5b378ffb2905648b17fe80a9}{}\label{test_8c_a1df0cdbd5b378ffb2905648b17fe80a9}
Pool from which Child objects are allocated. \index{test.\+c@{test.\+c}!Child\+Ref\+Map@{Child\+Ref\+Map}}
\index{Child\+Ref\+Map@{Child\+Ref\+Map}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Child\+Ref\+Map}{ChildRefMap}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+ref\+\_\+\+Map\+Ref\+\_\+t} Child\+Ref\+Map = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_a5195bef7813b4ab6759a72c04fbef318}{}\label{test_8c_a5195bef7813b4ab6759a72c04fbef318}
Safe reference map used for references to Child objects. \index{test.\+c@{test.\+c}!Mutex@{Mutex}}
\index{Mutex@{Mutex}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Mutex}{Mutex}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+mutex\+\_\+\+Ref\+\_\+t} Mutex\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_ae0c3ff15dbb06613e17fb22da85c6cf9}{}\label{test_8c_ae0c3ff15dbb06613e17fb22da85c6cf9}
Mutex for protect multithreaded access to our data. \index{test.\+c@{test.\+c}!Num\+Failures@{Num\+Failures}}
\index{Num\+Failures@{Num\+Failures}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Num\+Failures}{NumFailures}}]{\setlength{\rightskip}{0pt plus 5cm}int Num\+Failures = 0\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_af352398c4d2519fd630d449af577cea2}{}\label{test_8c_af352398c4d2519fd630d449af577cea2}
The number of test failures. This may be accessed by multiple threads but since an int is atomic we do not need to protect it with a mutex. \index{test.\+c@{test.\+c}!Pass\+Through@{Pass\+Through}}
\index{Pass\+Through@{Pass\+Through}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Pass\+Through}{PassThrough}}]{\setlength{\rightskip}{0pt plus 5cm}bool Pass\+Through = false\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_a9db2c1bd813d75d4cbbd387fd3d22b56}{}\label{test_8c_a9db2c1bd813d75d4cbbd387fd3d22b56}
Controls whether the process exits when there is a failure or if the number of failures is incremented and the testing continues (pass through). \index{test.\+c@{test.\+c}!Pass\+Through\+Arg@{Pass\+Through\+Arg}}
\index{Pass\+Through\+Arg@{Pass\+Through\+Arg}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Pass\+Through\+Arg}{PassThroughArg}}]{\setlength{\rightskip}{0pt plus 5cm}const char Pass\+Through\+Arg\mbox{[}$\,$\mbox{]} = \char`\"{}-\/p\char`\"{}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_acbbcacb7845b0cd0598ecc7e6b851f0b}{}\label{test_8c_acbbcacb7845b0cd0598ecc7e6b851f0b}
The pass through argument strings. \index{test.\+c@{test.\+c}!Pass\+Through\+Arg\+Long\+Form@{Pass\+Through\+Arg\+Long\+Form}}
\index{Pass\+Through\+Arg\+Long\+Form@{Pass\+Through\+Arg\+Long\+Form}!test.\+c@{test.\+c}}
\subsubsection[{\texorpdfstring{Pass\+Through\+Arg\+Long\+Form}{PassThroughArgLongForm}}]{\setlength{\rightskip}{0pt plus 5cm}const char Pass\+Through\+Arg\+Long\+Form\mbox{[}$\,$\mbox{]} = \char`\"{}-\/-\/pass-\/through\char`\"{}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{test_8c_a2aa20c086050c7ff86157bbcac07b3f9}{}\label{test_8c_a2aa20c086050c7ff86157bbcac07b3f9}
