\hypertarget{messaging_protocol_8c}{}\section{framework/liblegato/linux/messaging\+Protocol.c File Reference}
\label{messaging_protocol_8c}\index{framework/liblegato/linux/messaging\+Protocol.\+c@{framework/liblegato/linux/messaging\+Protocol.\+c}}
{\ttfamily \#include \char`\"{}legato.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}unix\+Socket.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}service\+Directory/service\+Directory\+Protocol.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}messaging\+Message.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}messaging\+Protocol.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{messaging_protocol_8c_a0376b2ead2de10bb7ab6a4d21ec304e9}{L\+O\+CK}~\hyperlink{sbtrace_8c_a7c6c2e5e914cf8eca19d150e90f3b106}{L\+E\+\_\+\+A\+S\+S\+E\+RT}(pthread\+\_\+mutex\+\_\+lock(\&\hyperlink{thread_8c_abc03085ccf7c38e092cdf06bf6b98ea6}{Mutex}) == 0);
\item 
\#define \hyperlink{messaging_protocol_8c_ac82effb31e82e32254efc8b57251d59e}{U\+N\+L\+O\+CK}~\hyperlink{sbtrace_8c_a7c6c2e5e914cf8eca19d150e90f3b106}{L\+E\+\_\+\+A\+S\+S\+E\+RT}(pthread\+\_\+mutex\+\_\+unlock(\&\hyperlink{thread_8c_abc03085ccf7c38e092cdf06bf6b98ea6}{Mutex}) == 0);
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{structmsg_protocol___protocol__t}{msg\+Protocol\+\_\+\+Protocol\+\_\+t} $\ast$ \hyperlink{messaging_protocol_8c_a26f92d12bbc59085d3463cfcb882c155}{Find\+Protocol} (const char $\ast$protocol\+Id)
\item 
static \hyperlink{structmsg_protocol___protocol__t}{msg\+Protocol\+\_\+\+Protocol\+\_\+t} $\ast$ \hyperlink{messaging_protocol_8c_a9a3e83181c862f96e39970f4e68edf9c}{Create\+Protocol} (const char $\ast$protocol\+Id, size\+\_\+t largest\+Msg\+Size)
\item 
\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void} \hyperlink{messaging_protocol_8c_a136d85843f446d9a787590679b8e0ad8}{msg\+Proto\+\_\+\+Init} (\hyperlink{_t_e_m_p_l_a_t_e__cdef_8h_ac9c84fa68bbad002983e35ce3663c686}{void})
\item 
\hyperlink{le__messaging_8h_a1e5c37fdd50a4d6d24cad82cb166f770}{le\+\_\+msg\+\_\+\+Message\+Ref\+\_\+t} \hyperlink{messaging_protocol_8c_ad340ec420639f203dc37d94e68b79914}{msg\+Proto\+\_\+\+Alloc\+Message} (\hyperlink{le__messaging_8h_ac05e9b3268f8fb5776adab6fe11410e5}{le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t} \hyperlink{log_daemon_8c_ab68a489ae7e59226149411d7282358cd}{protocol\+Ref})
\item 
\hyperlink{le__messaging_8h_ac05e9b3268f8fb5776adab6fe11410e5}{le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t} \hyperlink{messaging_protocol_8c_adcd1ff1a6906433aaa6d7038125c4473}{le\+\_\+msg\+\_\+\+Get\+Protocol\+Ref} (const char $\ast$protocol\+Id, size\+\_\+t largest\+Msg\+Size)
\item 
const char $\ast$ \hyperlink{messaging_protocol_8c_a10a7c8b66a6baadb290c8d0e3c72f066}{le\+\_\+msg\+\_\+\+Get\+Protocol\+Id\+Str} (\hyperlink{le__messaging_8h_ac05e9b3268f8fb5776adab6fe11410e5}{le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t} \hyperlink{log_daemon_8c_ab68a489ae7e59226149411d7282358cd}{protocol\+Ref})
\item 
size\+\_\+t \hyperlink{messaging_protocol_8c_a42196218a35f314966901c4cd22fbb07}{le\+\_\+msg\+\_\+\+Get\+Protocol\+Max\+Msg\+Size} (\hyperlink{le__messaging_8h_ac05e9b3268f8fb5776adab6fe11410e5}{le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t} \hyperlink{log_daemon_8c_ab68a489ae7e59226149411d7282358cd}{protocol\+Ref})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static pthread\+\_\+mutex\+\_\+t \hyperlink{messaging_protocol_8c_abc03085ccf7c38e092cdf06bf6b98ea6}{Mutex} = P\+T\+H\+R\+E\+A\+D\+\_\+\+M\+U\+T\+E\+X\+\_\+\+I\+N\+I\+T\+I\+A\+L\+I\+Z\+ER
\item 
static \hyperlink{structle__sls___list__t}{le\+\_\+sls\+\_\+\+List\+\_\+t} \hyperlink{messaging_protocol_8c_a3f5b29d4ae2f8fabc21097141b1ff288}{Protocol\+List} = \hyperlink{le__singly_linked_list_8h_a2e1013c24e2c826dbba37a761c5d9f44}{L\+E\+\_\+\+S\+L\+S\+\_\+\+L\+I\+S\+T\+\_\+\+I\+N\+IT}
\item 
static \hyperlink{le__mem_8h_a44a896f6a0a1a8c733e8038eb332989e}{le\+\_\+mem\+\_\+\+Pool\+Ref\+\_\+t} \hyperlink{messaging_protocol_8c_abc04e8b9eb41b9d0961f0dcedadeabf6}{Protocol\+Pool\+Ref}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Implements the \char`\"{}\+Protocol\char`\"{} objects in the Legato \hyperlink{c_messaging}{Low-\/level Messaging A\+PI}.

See \hyperlink{messaging_8c}{messaging.\+c} for the overall subsystem design.

\begin{DoxyWarning}{Warning}
The code in this file {\bfseries must} be thread safe and re-\/entrant.
\end{DoxyWarning}
Copyright (C) Sierra Wireless Inc. 

\subsection{Macro Definition Documentation}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!L\+O\+CK@{L\+O\+CK}}
\index{L\+O\+CK@{L\+O\+CK}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{L\+O\+CK}{LOCK}}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\+O\+CK~{\bf L\+E\+\_\+\+A\+S\+S\+E\+RT}(pthread\+\_\+mutex\+\_\+lock(\&{\bf Mutex}) == 0);}\hypertarget{messaging_protocol_8c_a0376b2ead2de10bb7ab6a4d21ec304e9}{}\label{messaging_protocol_8c_a0376b2ead2de10bb7ab6a4d21ec304e9}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!U\+N\+L\+O\+CK@{U\+N\+L\+O\+CK}}
\index{U\+N\+L\+O\+CK@{U\+N\+L\+O\+CK}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{U\+N\+L\+O\+CK}{UNLOCK}}]{\setlength{\rightskip}{0pt plus 5cm}\#define U\+N\+L\+O\+CK~{\bf L\+E\+\_\+\+A\+S\+S\+E\+RT}(pthread\+\_\+mutex\+\_\+unlock(\&{\bf Mutex}) == 0);}\hypertarget{messaging_protocol_8c_ac82effb31e82e32254efc8b57251d59e}{}\label{messaging_protocol_8c_ac82effb31e82e32254efc8b57251d59e}


\subsection{Function Documentation}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!Create\+Protocol@{Create\+Protocol}}
\index{Create\+Protocol@{Create\+Protocol}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{Create\+Protocol(const char $\ast$protocol\+Id, size\+\_\+t largest\+Msg\+Size)}{CreateProtocol(const char *protocolId, size_t largestMsgSize)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf msg\+Protocol\+\_\+\+Protocol\+\_\+t}$\ast$ Create\+Protocol (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{protocol\+Id, }
\item[{size\+\_\+t}]{largest\+Msg\+Size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{messaging_protocol_8c_a9a3e83181c862f96e39970f4e68edf9c}{}\label{messaging_protocol_8c_a9a3e83181c862f96e39970f4e68edf9c}
Creates a new Protocol object.

\begin{DoxyReturn}{Returns}
A pointer to the object. Never returns on failure. 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em protocol\+Id} & String uniquely identifying the the protocol and version. \\
\hline
\mbox{\tt in}  & {\em largest\+Msg\+Size} & Size (in bytes) of the largest message in the protocol. \\
\hline
\end{DoxyParams}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!Find\+Protocol@{Find\+Protocol}}
\index{Find\+Protocol@{Find\+Protocol}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{Find\+Protocol(const char $\ast$protocol\+Id)}{FindProtocol(const char *protocolId)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf msg\+Protocol\+\_\+\+Protocol\+\_\+t}$\ast$ Find\+Protocol (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{protocol\+Id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{messaging_protocol_8c_a26f92d12bbc59085d3463cfcb882c155}{}\label{messaging_protocol_8c_a26f92d12bbc59085d3463cfcb882c155}
Looks for a Protocol object in the Protocol List.

\begin{DoxyReturn}{Returns}
A pointer to the Protocol object or N\+U\+LL if not found. 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em protocol\+Id} & String uniquely identifying the the protocol and version. \\
\hline
\end{DoxyParams}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!le\+\_\+msg\+\_\+\+Get\+Protocol\+Id\+Str@{le\+\_\+msg\+\_\+\+Get\+Protocol\+Id\+Str}}
\index{le\+\_\+msg\+\_\+\+Get\+Protocol\+Id\+Str@{le\+\_\+msg\+\_\+\+Get\+Protocol\+Id\+Str}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+msg\+\_\+\+Get\+Protocol\+Id\+Str(le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t protocol\+Ref)}{le_msg_GetProtocolIdStr(le_msg_ProtocolRef_t protocolRef)}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ le\+\_\+msg\+\_\+\+Get\+Protocol\+Id\+Str (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t}}]{protocol\+Ref}
\end{DoxyParamCaption}
)}\hypertarget{messaging_protocol_8c_a10a7c8b66a6baadb290c8d0e3c72f066}{}\label{messaging_protocol_8c_a10a7c8b66a6baadb290c8d0e3c72f066}
Gets the unique identifier string of the protocol.

\begin{DoxyReturn}{Returns}
A pointer to the protocol identifier (null-\/terminated, U\+T\+F-\/8 string). 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em protocol\+Ref} & Reference to the protocol. \\
\hline
\end{DoxyParams}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!le\+\_\+msg\+\_\+\+Get\+Protocol\+Max\+Msg\+Size@{le\+\_\+msg\+\_\+\+Get\+Protocol\+Max\+Msg\+Size}}
\index{le\+\_\+msg\+\_\+\+Get\+Protocol\+Max\+Msg\+Size@{le\+\_\+msg\+\_\+\+Get\+Protocol\+Max\+Msg\+Size}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+msg\+\_\+\+Get\+Protocol\+Max\+Msg\+Size(le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t protocol\+Ref)}{le_msg_GetProtocolMaxMsgSize(le_msg_ProtocolRef_t protocolRef)}}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t le\+\_\+msg\+\_\+\+Get\+Protocol\+Max\+Msg\+Size (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t}}]{protocol\+Ref}
\end{DoxyParamCaption}
)}\hypertarget{messaging_protocol_8c_a42196218a35f314966901c4cd22fbb07}{}\label{messaging_protocol_8c_a42196218a35f314966901c4cd22fbb07}
Gets the protocol\textquotesingle{}s maximum message size.

\begin{DoxyReturn}{Returns}
The size, in bytes. 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em protocol\+Ref} & Reference to the protocol. \\
\hline
\end{DoxyParams}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!le\+\_\+msg\+\_\+\+Get\+Protocol\+Ref@{le\+\_\+msg\+\_\+\+Get\+Protocol\+Ref}}
\index{le\+\_\+msg\+\_\+\+Get\+Protocol\+Ref@{le\+\_\+msg\+\_\+\+Get\+Protocol\+Ref}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{le\+\_\+msg\+\_\+\+Get\+Protocol\+Ref(const char $\ast$protocol\+Id, size\+\_\+t largest\+Msg\+Size)}{le_msg_GetProtocolRef(const char *protocolId, size_t largestMsgSize)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t} le\+\_\+msg\+\_\+\+Get\+Protocol\+Ref (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{protocol\+Id, }
\item[{size\+\_\+t}]{largest\+Msg\+Size}
\end{DoxyParamCaption}
)}\hypertarget{messaging_protocol_8c_adcd1ff1a6906433aaa6d7038125c4473}{}\label{messaging_protocol_8c_adcd1ff1a6906433aaa6d7038125c4473}
Gets a reference that can be used to refer to a particular version of a particular protocol.

\begin{DoxyReturn}{Returns}
The protocol reference. 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em protocol\+Id} & String uniquely identifying the the protocol and version. \\
\hline
\mbox{\tt in}  & {\em largest\+Msg\+Size} & Size (in bytes) of the largest message in the protocol. \\
\hline
\end{DoxyParams}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!msg\+Proto\+\_\+\+Alloc\+Message@{msg\+Proto\+\_\+\+Alloc\+Message}}
\index{msg\+Proto\+\_\+\+Alloc\+Message@{msg\+Proto\+\_\+\+Alloc\+Message}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{msg\+Proto\+\_\+\+Alloc\+Message(le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t protocol\+Ref)}{msgProto_AllocMessage(le_msg_ProtocolRef_t protocolRef)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+msg\+\_\+\+Message\+Ref\+\_\+t} msg\+Proto\+\_\+\+Alloc\+Message (
\begin{DoxyParamCaption}
\item[{{\bf le\+\_\+msg\+\_\+\+Protocol\+Ref\+\_\+t}}]{protocol\+Ref}
\end{DoxyParamCaption}
)}\hypertarget{messaging_protocol_8c_ad340ec420639f203dc37d94e68b79914}{}\label{messaging_protocol_8c_ad340ec420639f203dc37d94e68b79914}
Allocate a Message object from a given Protocol\textquotesingle{}s Message Pool.

\begin{DoxyReturn}{Returns}
A pointer to the (uninitialized) Message object memory. 
\end{DoxyReturn}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!msg\+Proto\+\_\+\+Init@{msg\+Proto\+\_\+\+Init}}
\index{msg\+Proto\+\_\+\+Init@{msg\+Proto\+\_\+\+Init}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{msg\+Proto\+\_\+\+Init(void)}{msgProto_Init(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} msg\+Proto\+\_\+\+Init (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{messaging_protocol_8c_a136d85843f446d9a787590679b8e0ad8}{}\label{messaging_protocol_8c_a136d85843f446d9a787590679b8e0ad8}
Initializes this module. This must be called only once at start-\/up, before any other functions in this module are called. \begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000047}{Todo}]Make this configurable. \end{DoxyRefDesc}


\subsection{Variable Documentation}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!Mutex@{Mutex}}
\index{Mutex@{Mutex}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{Mutex}{Mutex}}]{\setlength{\rightskip}{0pt plus 5cm}pthread\+\_\+mutex\+\_\+t Mutex = P\+T\+H\+R\+E\+A\+D\+\_\+\+M\+U\+T\+E\+X\+\_\+\+I\+N\+I\+T\+I\+A\+L\+I\+Z\+ER\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{messaging_protocol_8c_abc03085ccf7c38e092cdf06bf6b98ea6}{}\label{messaging_protocol_8c_abc03085ccf7c38e092cdf06bf6b98ea6}
Mutex used to protect data structures in this module from multi-\/threaded race conditions.

\begin{DoxyNote}{Note}
This is a pthreads F\+A\+ST mutex, chosen to minimize overhead. It is non-\/recursive. 
\end{DoxyNote}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!Protocol\+List@{Protocol\+List}}
\index{Protocol\+List@{Protocol\+List}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{Protocol\+List}{ProtocolList}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+sls\+\_\+\+List\+\_\+t} Protocol\+List = {\bf L\+E\+\_\+\+S\+L\+S\+\_\+\+L\+I\+S\+T\+\_\+\+I\+N\+IT}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{messaging_protocol_8c_a3f5b29d4ae2f8fabc21097141b1ff288}{}\label{messaging_protocol_8c_a3f5b29d4ae2f8fabc21097141b1ff288}
List of Protocol objects.

\begin{DoxyNote}{Note}
Nothing is ever deleted from this list, so the list only needs to be protected from thread races when traversing to the next item while searching the list and when adding an item to the list. 
\end{DoxyNote}
\index{messaging\+Protocol.\+c@{messaging\+Protocol.\+c}!Protocol\+Pool\+Ref@{Protocol\+Pool\+Ref}}
\index{Protocol\+Pool\+Ref@{Protocol\+Pool\+Ref}!messaging\+Protocol.\+c@{messaging\+Protocol.\+c}}
\subsubsection[{\texorpdfstring{Protocol\+Pool\+Ref}{ProtocolPoolRef}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf le\+\_\+mem\+\_\+\+Pool\+Ref\+\_\+t} Protocol\+Pool\+Ref\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{messaging_protocol_8c_abc04e8b9eb41b9d0961f0dcedadeabf6}{}\label{messaging_protocol_8c_abc04e8b9eb41b9d0961f0dcedadeabf6}
Pool from which Protocol objects are allocated. 