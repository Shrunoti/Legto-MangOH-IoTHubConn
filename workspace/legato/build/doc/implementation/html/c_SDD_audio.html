<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: Audio SDD</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/javascript">
//<![CDATA[
    // Detect if doc is served by eclipse
    if( ( (window.location.hostname == "127.0.0.1") || (window.location.hostname == "localhost") ) &&
        ( (window.location.port != "") && (window.location.port != 80) && (window.location.port != 443) ) )
    {
        // Inhibit init function from navtree
        initNavTree = function(toroot,relpath) {}
        $(document).ready(function(){
            navTree = document.getElementById("side-nav");
            if(navTree)
            {
                navTree.parentElement.removeChild(navTree);
            }
            $("#doc-content").css('margin-left',10);
        });
    }
//]]>
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html" title="Legato">
      <img alt="Logo" src="legatoLogo.png"/>
    </a>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_SDD_audio.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Audio SDD </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Multimedia"></a>
Multimedia</h1>
<h2><a class="anchor" id="Overview"></a>
Overview</h2>
<p>The Audio API handles audio interfaces including play and record supported formats. Four functionalities are proposed through the APIs:</p><ul>
<li>file playback using <a class="el" href="le__audio__interface_8h.html#aea2c5d0b394cfab87503639c534300c9">le_audio_PlayFile()</a> API</li>
<li>file recording using <a class="el" href="le__audio__interface_8h.html#a393a26f6cff7fe05c1813fcafeef50f3">le_audio_RecordFile()</a> API</li>
<li>PCM samples playback using <a class="el" href="le__audio__interface_8h.html#afd37d59ab8207338da197554f49d7ff0">le_audio_PlaySamples()</a> API</li>
<li>PCM samples recording using <a class="el" href="le__audio__interface_8h.html#a9c55a59849afcbb2ccef88cd4265782e">le_audio_GetSamples()</a> API</li>
</ul>
<p>To provide these functionalities, audio daemon relies on a HAL (Harware Abstraction Layer) calling Alsa-intf to communicate with the sound driver ALSA. The audio platform adaptor uses the Alsa-intf's open, read and write APIs.<br />
 For reading operation, Alsa-intf is configured in MMAP mode: Alsa-intf allocates a mmap buffer and provides it to the audio platform adaptor to get PCM frames to be played by ALSA.<br />
 For write operation, Alsa-intf is configured in NMMAP mode: audio platform adaptor provides its own buffer to the Alsa-intf.</p>
<p>In play samples and get samples use cases, a pipe is created by the application to send/get audio samples to/from the audio daemon'threads in charge of the playback and the capture. To be generic, the same mechanism is re-used internally in the audio daemon for files playback and recording: a thread is in charge of sending and recording audio samples to the playback/capture threads through a pipe.</p>
<p>Playbacks APIs are using the same PlaybackThread thread: its goal is to read audio samples from a pipe, and send them to Alsa-intf to be played on sound device. Recording APIs are using the same CaptureThread thread: its goal is to get audio samples from Alsa-intf, and write them into a pipe. These two threads are implemented in the audio platform adaptor. They are running until a stop operation is performed (by the application using the dedicated API <a class="el" href="le__audio__interface_8h.html#a4aebc6e8cdc4389c375e93418823af71">le_audio_Stop()</a>, or by the audio component when the end of the audio file is reached).</p>
<p>On the other end of the pipe, file playback and recording are using the media thread. Its goal is to:</p><ul>
<li>read samples and write into the pipe (playback file case). Read samples can be:<ul>
<li>read samples directly from a file (WAV files)</li>
<li>get samples from the AMR decoder (AMR-NB/AMR-WB files)</li>
<li>read samples from DTMF generator</li>
</ul>
</li>
<li>read from the pipe and write into a file (capture case). Write samples can be:<ul>
<li>write samples directly into a file (WAV file)</li>
<li>record samples in AMR format (AMR-NB/AMR-WB files)</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="le_audio_PlayFile"></a>
le_audio_PlayFile</h2>
<p>In play file use case, audio daemon starts the media and playback threads and creates a pipe to transfer PCM samples between both threads. Media thread is in charge of reading/decoding PCM frames and sending them on the pipe. Playback thread reads the PCM frames on the pipe and sends them to the sound driver through Alsa-intf.</p>
<div align="center">
<img src="le_audio_PlayFile.png" />
</div>
<h2><a class="anchor" id="le_audio_PlaySamples"></a>
le_audio_PlaySamples</h2>
<p>In play samples use case, the application creates a pipe and sends PCM samples on it. In audio daemon side, playback thread is started to get the PCM samples from the pipe and then send them to the sound driver through Alsa-intf.</p>
<div align="center">
<img src="le_audio_PlaySamples.png" />
</div>
<h2><a class="anchor" id="le_audio_GetSamples"></a>
le_audio_GetSamples</h2>
<p>In get samples use case, the application creates a pipe and gets PCM samples on it. In audio daemon side, capture thread is started to get the PCM samples from Alsa-intf and then send them on the pipe to the application.</p>
<div align="center">
<img src="le_audio_GetSamples.png" />
</div>
<h2><a class="anchor" id="le_audio_RecordFile"></a>
le_audio_RecordFile</h2>
<p>In record file use case, audio daemon starts the media and capture threads, and creates a pipe to transfer PCM samples between both threads. PCM samples are got by the capture thread from the sound driver through Alsa-intf, and are sent to the media thread thanks to the pipe for recording in the requested format.</p>
<div align="center">
<img src="le_audio_RecordFile.png" />
</div>
<p>Copyright (C) Sierra Wireless Inc. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.11
        </div>
    </div>
</body>
</html>
