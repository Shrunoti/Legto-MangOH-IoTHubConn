<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: delta patch overview.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/javascript">
//<![CDATA[
    // Detect if doc is served by eclipse
    if( ( (window.location.hostname == "127.0.0.1") || (window.location.hostname == "localhost") ) &&
        ( (window.location.port != "") && (window.location.port != 80) && (window.location.port != 443) ) )
    {
        // Inhibit init function from navtree
        initNavTree = function(toroot,relpath) {}
        $(document).ready(function(){
            navTree = document.getElementById("side-nav");
            if(navTree)
            {
                navTree.parentElement.removeChild(navTree);
            }
            $("#doc-content").css('margin-left',10);
        });
    }
//]]>
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html" title="Legato">
      <img alt="Logo" src="legatoLogo.png"/>
    </a>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Delta_Patch.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">delta patch overview. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A delta patch consists of differences between two images: the original and the destination.</p>
<p>Applying this delta patch to the original will produce the destination.</p>
<p>A delta patch uses bsdiff and bspatch tools: <a href="http://www.daemonology.net/bsdiff/">http://www.daemonology.net/bsdiff/</a></p>
<h1><a class="anchor" id="mkPatch_Presentation"></a>
mkPatch Presensation</h1>
<p>The tool <a class="el" href="Delta_Patch.html#mkPatch_tool">mkPatch</a> is used to create a delta patch between two images. It needs an original image and a destination image to construct the delta patch between them. The images may be RAW binary or UBI volumes.</p>
<p>The destination image is splitted into small segments, and from each segment a patch slice is build preceeded by a delta patch header (<a class="el" href="struct_delta_patch_header__t.html">DeltaPatchHeader_t</a>), describing the patch number, the offset of this patch and its length.</p>
<p>All patch slices are concatenated and the "whole patch" is preceeded by a delta patch meta header (<a class="el" href="struct_delta_patch_meta_header__t.html">DeltaPatchMetaHeader_t</a>) containing the partition to patch, the UBI volume ID (if it concerns an UBI volume), the size of the segment, the the original image size and CRC32, the destination image size and CRC32, and a patch magic.</p>
<p>Finally the whole patch is encapsulated by a CWE header.</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="Delta_Patch.html#mkPatch_tool">mkPatch</a> requires bsdiff and libbz2 to be installed.</dd></dl>
<h2><a class="anchor" id="mkPatch_tool"></a>
mkPatch</h2>
<p>This tool has the following syntax:</p>
<pre class="fragment">usage: mkPatch -T TARGET [-o patchname] [-S 4K|2K] [-E 256K|128K] [-N] [-v]
        {-p PART {[-U VOLID] file-orig file-dest}}

   -T, --target &lt;TARGET&gt;
        Specify the TARGET (mandatory - specified only one time).
   -o, &lt;patchname&gt;
        Specify the output name of the patch. Else use patch-&lt;TARGET&gt;.cwe as default.
   -S, --pagesize &lt;4K|2K&gt;
        Specify another page size (optional - specified only one time).
   -E, --pebsize &lt;256K|128K&gt;
        Specify another PEB size (optional - specified only one time).
   -N, --no-spkg-header
        Do not generate the CWE SPKG header.
   -v, --verbose
        Be verbose.
   -p, --partition &lt;PART&gt;
        Specify the partition where apply the patch.
   -U, --ubi &lt;VOLID&gt;
        Specify the UBI volume ID where apply the patch.
</pre><p>The &ndash;target TARGET is one of ar759x or ar758x respectivelly. Others targets are not supported.</p>
<p>The output CWE file is specified with -o. If not filled, the default name is patch-TARGET.cwe where TARGET is the TARGET selected by &ndash;target.</p>
<p>The &ndash;pagesize specify the flash device page size expected on target. It only supports 2K for 2048 page size and 4K for 4096 page size. If the &ndash;pagesize is not filled, a default value is taken according to ID specified.</p>
<p>The &ndash;pebsize specify the flash device physical erase block expected on target. It only supports 128K for 131072 PEB size and 256K for 262144 PEB size. If the &ndash;pebsize is not filled, a default value is taken according to ID specified.</p>
<p>The -N option requests the tool to not add a CWE SPKG header. This is usefull to include a delta patch CWE inside another CWE.</p>
<p>The -v requests the tool to be verbose and displays more informations.</p>
<p>The &ndash;partition PART specify which partition is concerned by this delta patch. It may one of the following:</p><ul>
<li>modem : The modem UBI image</li>
<li>tz : The Trust-Zone image</li>
<li>rpm : The QCT RPM image</li>
<li>aboot : The LK bootloader image</li>
<li>boot : The Linux kernel image</li>
<li>system : The Linux rootfs image</li>
<li>lefwkro : The legato image</li>
</ul>
<p>The &ndash;ubi N gives the availability to build a patch by specifying an UBI volume id for a static squashfs image. The squashfs image belongs to the UBI volume id N. N is a number from 0 up to 127. If the original and destination images are both UBI, this option does not need to be set.</p>
<p>Finally the both original and destination need to be specified.</p>
<p>The &ndash;partition PART ORIG DEST may be specified several times, if the delta patch concerns several partitions.</p>
<h2><a class="anchor" id="mkPatch_Examples"></a>
Examples</h2>
<p>To build a delta patch between two legato squashfs images belonging to the UBI volume 0, do:</p>
<pre class="fragment">mkPatch --target ar758x -o legato-patch.cwe --partition lefwkro --ubi 0 orig/legato.squashfs dest/legato.squashfs</pre><p>To build a delta patch between two Linux kernels and two rootfs in the same CWE update package, do: </p><pre class="fragment">mkPatch --target ar759x -o yocto-patch.cwe \
          --partition boot orig/boot-yocto-mdm9x40.img dest/boot-yocto-mdm9x40.img \
          --partition system orig/mdm9x40-image-minimal-swi-mdm9x40.ubi dest/mdm9x40-image-minimal-swi-mdm9x40.ubi</pre><h1><a class="anchor" id="ApplyDeltaPatch"></a>
Apply a delta patch</h1>
<p>The delta patch CWE update package is applied with the tool <a class="el" href="toolsTarget_fwUpdate.html">fwupdate</a> download or with <a class="el" href="le__fwupdate__interface_8h.html#ab68f3a7c5d4284306468e888bf6a8796">le_fwupdate_Download</a> API.</p>
<hr/>
<p>Copyright (C) Sierra Wireless Inc. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.11
        </div>
    </div>
</body>
</html>
