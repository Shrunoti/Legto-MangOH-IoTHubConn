<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: Update Control API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/javascript">
//<![CDATA[
    // Detect if doc is served by eclipse
    if( ( (window.location.hostname == "127.0.0.1") || (window.location.hostname == "localhost") ) &&
        ( (window.location.port != "") && (window.location.port != 80) && (window.location.port != 443) ) )
    {
        // Inhibit init function from navtree
        initNavTree = function(toroot,relpath) {}
        $(document).ready(function(){
            navTree = document.getElementById("side-nav");
            if(navTree)
            {
                navTree.parentElement.removeChild(navTree);
            }
            $("#doc-content").css('margin-left',10);
        });
    }
//]]>
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html" title="Legato">
      <img alt="Logo" src="legatoLogo.png"/>
    </a>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_updateCtrl.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Update Control API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="le__update_ctrl__interface_8h.html">API Reference</a></p>
<hr/>
<p>This API is used by privileged apps to control the software update process. It can be used to:</p><ul>
<li>prevent updates from happening or</li>
<li>control the marking of a system update as "good" or "bad".</li>
</ul>
<p>Note that this is not part of the Update API (le_update) because the Update API can be used by less trusted apps to feed signed/encrypted updates to the Update Daemon, and we may not trust those same apps to have the ability to prevent someone else from updating or rolling-back the system.</p>
<h1><a class="anchor" id="le_updateCtrl_prevention"></a>
Preventing Updates During Critical Operations</h1>
<p>To protect against updates during critical periods of operation (such as when performing an emergency call in response to a vehicle collision), the following functions are provided:</p>
<ul>
<li><a class="el" href="le__update_ctrl__interface_8h.html#acdbc9dcc05455f0dd1020b875909c3ed">le_updateCtrl_Defer()</a> - prevent all updates until further notice.</li>
<li><a class="el" href="le__update_ctrl__interface_8h.html#ab3955f0e34df43a5fbe3e9eae16040d4">le_updateCtrl_Allow()</a> - allow updates to go ahead.</li>
</ul>
<p>Updates will not be allowed to go ahead until no clients are deferring updates. So, if client A and client B both call <a class="el" href="le__update_ctrl__interface_8h.html#acdbc9dcc05455f0dd1020b875909c3ed">le_updateCtrl_Defer()</a>, updates will be deferred until both client A and client B have called <a class="el" href="le__update_ctrl__interface_8h.html#ab3955f0e34df43a5fbe3e9eae16040d4">le_updateCtrl_Allow()</a>.</p>
<p><a class="el" href="le__update_ctrl__interface_8h.html#acdbc9dcc05455f0dd1020b875909c3ed">le_updateCtrl_Defer()</a> will also prevent rollbacks unless a fault triggers the Supervisor to restart the framework or reboot the target. See below for more information on rollbacks.</p>
<h1><a class="anchor" id="le_updateCtrl_probation"></a>
Controlling the Probation Period</h1>
<p>Whenever a new system is started, a probation period begins. If the system stays running for the entire probation period, the system is marked "good". But, during the probation period, if an app faults enough times in a short enough period for the Supervisor to give up on trying to start it, the system update is marked "bad" and the system is rolled-back to the last known "good" system.</p>
<p>In some cases, a customer may want to extend the probation period of their new system for a non-deterministic amount of time, until it has had a chance to perform some action in the real world (such as successfully "phoning home" at least once).</p>
<p>To support this, the functions <a class="el" href="le__update_ctrl__interface_8h.html#a88e55c6e0ee5c2cf52e6fcb75a9db87e">le_updateCtrl_LockProbation()</a> and <a class="el" href="le__update_ctrl__interface_8h.html#a4ba5ace59bfe352c518c3f1eae6d0448">le_updateCtrl_UnlockProbation()</a> are provided, where each call to "Lock" must be matched with a call to "Unlock".</p>
<p>For those who want to mark "good" at some point of their own determination, regardless of how long the system has been up, <a class="el" href="le__update_ctrl__interface_8h.html#a8eaa5f533d5d677397642c7b44ce7bb3">le_updateCtrl_MarkGood()</a> is provided.</p>
<p>And for those who want to mark the system "bad" and trigger a rollback at some point of their own choosing, <a class="el" href="le__update_ctrl__interface_8h.html#a9f6a3bf7a830eb04823ea6188c12109c">le_updateCtrl_FailProbation()</a> is provided.</p>
<p>Calls to any of the functions that affect the probation period are ignored if the probation period is already over (if the system is already marked "good"). Once it is "good", it stays "good".</p>
<p>If someone tries to update the system while it is still in its probation period, the update will be refused. To override this, call <a class="el" href="le__update_ctrl__interface_8h.html#a9f6a3bf7a830eb04823ea6188c12109c">le_updateCtrl_FailProbation()</a> or <a class="el" href="le__update_ctrl__interface_8h.html#a8eaa5f533d5d677397642c7b44ce7bb3">le_updateCtrl_MarkGood()</a> to end the probation period before trying to apply the new system update.</p>
<dl class="section note"><dt>Note</dt><dd>If a reboot occurs during the probation period, the probation period will start over. But, if the system reboots more than a few times without reaching the end of its probation period first, then the system will be rolled-back to the last known "good" system.</dd></dl>
<hr/>
<p>Copyright (C) Sierra Wireless Inc. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.11
        </div>
    </div>
</body>
</html>
