<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: framework/daemons/linux/configTree/internalConfig.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/javascript">
//<![CDATA[
    // Detect if doc is served by eclipse
    if( ( (window.location.hostname == "127.0.0.1") || (window.location.hostname == "localhost") ) &&
        ( (window.location.port != "") && (window.location.port != 80) && (window.location.port != 443) ) )
    {
        // Inhibit init function from navtree
        initNavTree = function(toroot,relpath) {}
        $(document).ready(function(){
            navTree = document.getElementById("side-nav");
            if(navTree)
            {
                navTree.parentElement.removeChild(navTree);
            }
            $("#doc-content").css('margin-left',10);
        });
    }
//]]>
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html" title="Legato">
      <img alt="Logo" src="legatoLogo.png"/>
    </a>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('internal_config_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">internalConfig.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="legato_8h_source.html">legato.h</a>&quot;</code><br />
<code>#include &quot;interfaces.h&quot;</code><br />
<code>#include &quot;<a class="el" href="tree_db_8h_source.html">treeDb.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tree_user_8h_source.html">treeUser.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="node_iterator_8h_source.html">nodeIterator.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="internal_config_8h_source.html">internalConfig.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a88372b5d5913451cd09023be99a2bc5b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="internal_config_8c.html#a88372b5d5913451cd09023be99a2bc5b">GLOBAL_CONFIG_PATH</a>&#160;&#160;&#160;&quot;/configTree&quot;</td></tr>
<tr class="memdesc:a88372b5d5913451cd09023be99a2bc5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Path to the configTree's global configuration.  <a href="#a88372b5d5913451cd09023be99a2bc5b">More...</a><br /></td></tr>
<tr class="separator:a88372b5d5913451cd09023be99a2bc5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a82c345f0ffe52a3f480706aad356672c"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="internal_config_8c.html#a82c345f0ffe52a3f480706aad356672c">OnGlobalConfigChanged</a> (<a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> *contextPtr)</td></tr>
<tr class="separator:a82c345f0ffe52a3f480706aad356672c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a762ea099109b8638a15994e9dd7dad5b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="internal_config_8c.html#a762ea099109b8638a15994e9dd7dad5b">CheckPermissionStr</a> (<a class="el" href="node_iterator_8h.html#a4e97d8e792de584da776be7c732785ba">ni_IteratorRef_t</a> iteratorRef, <a class="el" href="tree_user_8h.html#a2dff366cb61aff633d83fc1598574fb7">tu_TreePermission_t</a> permission)</td></tr>
<tr class="separator:a762ea099109b8638a15994e9dd7dad5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f7bae3a0756b68aea8cd0ebd0053e7a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="internal_config_8c.html#a4f7bae3a0756b68aea8cd0ebd0053e7a">ic_Init</a> (<a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>)</td></tr>
<tr class="separator:a4f7bae3a0756b68aea8cd0ebd0053e7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a738b0102fcfddb5da7086a71bb9ccb1b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="internal_config_8c.html#a738b0102fcfddb5da7086a71bb9ccb1b">ic_CheckTreePermission</a> (<a class="el" href="tree_user_8h.html#a2dff366cb61aff633d83fc1598574fb7">tu_TreePermission_t</a> permission, const char *userName, const char *treeName)</td></tr>
<tr class="separator:a738b0102fcfddb5da7086a71bb9ccb1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4f3f7bbb61756473103475b61c40dad"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="internal_config_8c.html#ad4f3f7bbb61756473103475b61c40dad">ic_GetTransactionTimeout</a> (<a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>)</td></tr>
<tr class="separator:ad4f3f7bbb61756473103475b61c40dad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a6914b70139fb7514e4fed51b3757c7f5"><td class="memItemLeft" align="right" valign="top">static time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="internal_config_8c.html#a6914b70139fb7514e4fed51b3757c7f5">TransactionTimeout</a> = 0</td></tr>
<tr class="memdesc:a6914b70139fb7514e4fed51b3757c7f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cached value for the transaction timeout.  <a href="#a6914b70139fb7514e4fed51b3757c7f5">More...</a><br /></td></tr>
<tr class="separator:a6914b70139fb7514e4fed51b3757c7f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module handles the details for managing the configTree's own configuration. The configTree looks in the "system" tree for all of it's configuration.</p>
<h1><a class="anchor" id="cfg_acl"></a>
The configTree ACLs</h1>
<pre class="fragment">While the root user can access any and all trees, all other users of the system are more locked
down.  Every non-root user of the configTree is allowed read access to their own default tree.
(That is a tree with the same name as the user.)  However these users are not allowed to write
to this tree, or access any other trees in the system.

To try to access other trees results in access termination.

To grant an app user access to other trees in the system the configTree uses two sets of
white lists.  One to grant read only access, a second to grant read and write access.  To
actually grant this access, simply enter the tree name in the appropriate list.

The structure of the ACL config data is as follows:
</pre><pre class="fragment">/
  apps/
    myApp/
      configLimits/
        acl/
          someReadableTree&lt;string&gt; == read
          someWriteableTree&lt;string&gt; == write
</pre> <pre class="fragment">Where, myApp is the name of the application user in question.  So, given the above configuration
the application 'myApp' has read access to the trees, 'myApp,' and 'someReadableTree.'  The
application also has write access to the tree 'someWriteableTree.'  However all other trees in
the system are off limits.

If you wanted instead to grant 'myApp' read access to all of the trees in the system then you
would instead put the special value 'allAccess' into the configLimits collection with the value
of "read", it would look as follows:
</pre><pre class="fragment">/
  apps/
    myApp/
      configLimits/
        allAccess&lt;string&gt; == read
        acl/
          someWriteableTree&lt;string&gt; == write
</pre> <pre class="fragment">If instead you wanted the application to have read and write access to all trees in the system,
you would set the value allAccess to "write" instead.

If the user is not an application, then the configuration is exactly the same, except it's
stored under the users collection instead of under the apps collection.
</pre><pre class="fragment">/
  apps/
    myApp/
      configLimits/
        acl/
          someReadableTree&lt;string&gt; == read
          someWriteableTree&lt;string&gt; == write
  users/
    SomeUser/
      configLimits/
        allAccess&lt;string&gt; == write
</pre><h1><a class="anchor" id="cfg_timeout"></a>
The configTree Timeout</h1>
<pre class="fragment">The configTree's transaction timeout is configured under:
</pre><pre class="fragment">/
  configTree/
    transactionTimeout&lt;int&gt; == 30
</pre> <pre class="fragment">This value is used for both read and write transactions.  If this value is not set then a value
of 30 seconds is used as the default.

So, once a transaction is created using either le_cfg_CreateReadTxn, or le_cfg_CreateWriteTxn it
has the configured amount of time to complete.  If the transaction is not completed within the
timeout then the client that owns the transaction is disconnected so that other pending
transactions may continue.
</pre><hr/>
<p>Copyright (C) Sierra Wireless Inc. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a88372b5d5913451cd09023be99a2bc5b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GLOBAL_CONFIG_PATH&#160;&#160;&#160;&quot;/configTree&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Path to the configTree's global configuration. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a762ea099109b8638a15994e9dd7dad5b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool CheckPermissionStr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="node_iterator_8h.html#a4e97d8e792de584da776be7c732785ba">ni_IteratorRef_t</a>&#160;</td>
          <td class="paramname"><em>iteratorRef</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tree_user_8h.html#a2dff366cb61aff633d83fc1598574fb7">tu_TreePermission_t</a>&#160;</td>
          <td class="paramname"><em>permission</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Check the node that the iterator is positioned at and check to see if the requested permission is satisfied by the string value found there.</p>
<dl class="section return"><dt>Returns</dt><dd>A true if the requested permission is satified by the string value found in the config. False is returned if the config is not present or corrupt somehow. False is also returned if the requred permission is not set in the config. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">iteratorRef</td><td>The iterator to read from. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">permission</td><td>The permission we're looking for. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a738b0102fcfddb5da7086a71bb9ccb1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ic_CheckTreePermission </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tree_user_8h.html#a2dff366cb61aff633d83fc1598574fb7">tu_TreePermission_t</a>&#160;</td>
          <td class="paramname"><em>permission</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>userName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>treeName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function called to check if the given user has the requested permission on the given tree.</p>
<dl class="section return"><dt>Returns</dt><dd>True if the user has the requested permission on the tree, false if not. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">permission</td><td>Try to get a tree with this permission. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">userName</td><td>The user we're looking up in the config. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">treeName</td><td>The name of the tree we're looking for. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad4f3f7bbb61756473103475b61c40dad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t ic_GetTransactionTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read the current transaction timeout from the configtree's internal data.</p>
<dl class="section return"><dt>Returns</dt><dd>A timeout count in seconds. </dd></dl>

</div>
</div>
<a class="anchor" id="a4f7bae3a0756b68aea8cd0ebd0053e7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> ic_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize and load the configTree's internal configuration. </p>

</div>
</div>
<a class="anchor" id="a82c345f0ffe52a3f480706aad356672c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> OnGlobalConfigChanged </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_e_m_p_l_a_t_e__cdef_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> *&#160;</td>
          <td class="paramname"><em>contextPtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Everytime the configTree's global configuration changes, this function is called to load the updated data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">contextPtr</td><td>User data pointer, however this is unused here. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a6914b70139fb7514e4fed51b3757c7f5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">time_t TransactionTimeout = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cached value for the transaction timeout. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.11
        </div>
    </div>
</body>
</html>
