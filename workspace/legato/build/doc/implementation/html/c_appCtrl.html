<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: App Control API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/javascript">
//<![CDATA[
    // Detect if doc is served by eclipse
    if( ( (window.location.hostname == "127.0.0.1") || (window.location.hostname == "localhost") ) &&
        ( (window.location.port != "") && (window.location.port != 80) && (window.location.port != 443) ) )
    {
        // Inhibit init function from navtree
        initNavTree = function(toroot,relpath) {}
        $(document).ready(function(){
            navTree = document.getElementById("side-nav");
            if(navTree)
            {
                navTree.parentElement.removeChild(navTree);
            }
            $("#doc-content").css('margin-left',10);
        });
    }
//]]>
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html" title="Legato">
      <img alt="Logo" src="legatoLogo.png"/>
    </a>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_appCtrl.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">App Control API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="le__app_ctrl__interface_8h.html">API Reference</a></p>
<p>API for controlling (starting, stopping, and debugging) apps.</p>
<dl class="section warning"><dt>Warning</dt><dd>This API should only be made available to privileged users because it allows denial of service and arbitrary program execution in other apps. It also gives the user the ability to grant themselves access to any file, socket or device on the target system.</dd></dl>
<h1><a class="anchor" id="le_appCtrlApi_binding"></a>
Binding</h1>
<p>You can use a definition <code></code>.adef file to bind your client-side app and component to the server-side App Control service.</p>
<p>This code sample shows how to bind an app to this service: </p><div class="fragment"><div class="line">bindings</div><div class="line">{</div><div class="line">    myExe.myComp.le_appCtrl -&gt; &lt;root&gt;.le_appCtrl</div><div class="line">}</div></div><!-- fragment --><p>See <a class="el" href="defFilesAdef.html">Application Definition .adef</a> for details.</p>
<h1><a class="anchor" id="le_appCtrlApi_start"></a>
Start App</h1>
<p>Use <a class="el" href="le__app_ctrl__interface_8h.html#af6ead537c4e4833ca4d728b219ceccd5">le_appCtrl_Start()</a> (const char * appName) to start an app.</p>
<p>The code sample shows how to use the App Control service to start an app:</p>
<div class="fragment"><div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> result = <a class="code" href="apps_8c.html#ac7d4e0cc089aff5962bf6dad4ef71503">le_appCtrl_Start</a>(<span class="stringliteral">&quot;myApp&quot;</span>);</div></div><!-- fragment --><p>where <code>myApp</code> is the name of the app.</p>
<h1><a class="anchor" id="le_appCtrlApi_stop"></a>
Stop App</h1>
<p>Use <a class="el" href="le__app_ctrl__interface_8h.html#abe3c8c9e161119fea070a066775dcc2b">le_appCtrl_Stop()</a> to stop an app.</p>
<p>This code sample shows how to use the App Control service to stop an app.</p>
<div class="fragment"><div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> result = <a class="code" href="apps_8c.html#af544b1aaafc8ce1cbf751941604bcdba">le_appCtrl_Stop</a>(<span class="stringliteral">&quot;myApp&quot;</span>);</div></div><!-- fragment --><p>where <code>myApp</code> is the name of the app.</p>
<h1><a class="anchor" id="le_appCtrlApi_debug"></a>
Debugging Features</h1>
<p>Several functions are provided to support the construction of tools for debugging apps. These functions are used by the <code>appCtrl</code> and <a class="el" href="toolsTarget_sbtrace.html">sbtrace</a> tools. See the implementations of those tools (under <code>framework/tools/target/linux</code>) for real-world examples of how these functions can be used.</p>
<ul>
<li><a class="el" href="le__app_ctrl__interface_8h.html#a3e6e91d2f7d664a0643c2ac677c0ed17">le_appCtrl_GetRef()</a> can be used to get a reference to an app. This reference can then be used to apply overrides to the way that app will be started when <a class="el" href="le__app_ctrl__interface_8h.html#af6ead537c4e4833ca4d728b219ceccd5">le_appCtrl_Start()</a> is called.</li>
<li><a class="el" href="le__app_ctrl__interface_8h.html#a6fe6781ff1390e0314adea10768b28a7">le_appCtrl_SetRun()</a> can be used to set or clear the "run" flag for a given process in the app. Clearing the "run" flag will result in that process not being started when the app starts. This can be used to start an app without one or more processes that are to be started later using strace or gdbserver, for example.</li>
<li><a class="el" href="le__app_ctrl__interface_8h.html#a60684f6a4ee4900c33a22b6304801930">le_appCtrl_Import()</a> can be used to import (into an app's container) something from the file system outside of the app's container. This is used by the <a class="el" href="toolsHost_sbhelper.html">sbhelper</a> and <a class="el" href="toolsTarget_sbtrace.html">sbtrace</a> interactive sandbox configuration helper tools.</li>
<li><a class="el" href="le__app_ctrl__interface_8h.html#ac61ea4ff4711107976d6bfde76fe1d8f">le_appCtrl_SetDevicePerm()</a> is used to set the permissions of a device file. This is also used by the <a class="el" href="toolsHost_sbhelper.html">sbhelper</a> and <a class="el" href="toolsTarget_sbtrace.html">sbtrace</a> interactive sandbox configuration helper tools.</li>
<li><a class="el" href="le__app_ctrl__interface_8h.html#a61eef2118f65c5e1855c5b5b768a027a">le_appCtrl_AddTraceAttachHandler()</a> is used to register a call-back handler function to be called whenever the Supervisor has created a process in the app. After calling this call-back, the Supervisor will wait until <a class="el" href="le__app_ctrl__interface_8h.html#a92b461507ed1cafca1a19d4b9067c2c0">le_appCtrl_TraceUnblock()</a> is called for that process before allowing it to run. This gives a debugger the opportunity to attach to the process before running it.</li>
<li><a class="el" href="le__app_ctrl__interface_8h.html#a6636a95cce85b6dce397a875fd9099bc">le_appCtrl_ReleaseRef()</a> releases the reference returned by <a class="el" href="le__app_ctrl__interface_8h.html#a3e6e91d2f7d664a0643c2ac677c0ed17">le_appCtrl_GetRef()</a> and resets all the app control overrides that were set using that reference.</li>
</ul>
<h2><a class="anchor" id="le_appCtrlApi_debug_syncProcStart"></a>
Synchronizing Process Start</h2>
<p>Some tools need to "attach" to a process (e.g., using the Unix ptrace() API) when the process starts. If the process is started by the Supervisor when the app starts, then synchoronization can be achieved by calling <a class="el" href="le__app_ctrl__interface_8h.html#a61eef2118f65c5e1855c5b5b768a027a">le_appCtrl_AddTraceAttachHandler()</a> to register a "Trace Attach Handler" call-back for the app before starting it. When the Supervisor starts an app that has a Trace Attach Handler registered for it, the Supervisor will prepare the app container, as usual, and for each app process it starts, it will <code>fork()</code> a child process, put it into its runtime container, call the Trace Attach Handler function and block the child process before <code>exec()</code>ing the app's program. When the Trace Attach Handler function is called, it is passed the PID of the child process, which the debug tool can use to attach to the process before calling <a class="el" href="le__app_ctrl__interface_8h.html#a92b461507ed1cafca1a19d4b9067c2c0">le_appCtrl_TraceUnblock()</a> to ask the Supervisor to unblock the app's process.</p>
<div class="fragment"><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// Get a reference to the app.</span></div><div class="line">    <a class="code" href="le__app_ctrl__interface_8h.html#a91f18fa2ac21dcea04769cdf57cb7a3f">le_appCtrl_AppRef_t</a> appRef = <a class="code" href="apps_8c.html#a2811527163990063e5cc2b9f31105ca6">le_appCtrl_GetRef</a>(appNameStr);</div><div class="line">    <span class="keywordflow">if</span> (appRef == NULL)</div><div class="line">    {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;App &#39;%s&#39; could not be started. Check logs for more info.\n&quot;</span>, appNameStr);</div><div class="line">        <a class="code" href="app_stop_client_8c.html#a310220604a584e112ba8f7aa3dfe23f1">exit</a>(EXIT_FAILURE);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Set an attach handler.</span></div><div class="line">    <a class="code" href="apps_8c.html#a61eef2118f65c5e1855c5b5b768a027a">le_appCtrl_AddTraceAttachHandler</a>(appRef, <a class="code" href="sbtrace_8c.html#ad4917edd7394048bdc71b38ee7ed358b">AttachHandler</a>, NULL);</div><div class="line"></div><div class="line">    <span class="comment">// Start the app.</span></div><div class="line">    <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> result = <a class="code" href="apps_8c.html#ac7d4e0cc089aff5962bf6dad4ef71503">le_appCtrl_Start</a>(appNameStr);</div><div class="line">    <span class="keywordflow">if</span> (result != LE_OK)</div><div class="line">    {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;App &#39;%s&#39; could not be started. Check logs for more info.\n&quot;</span>, appNameStr);</div><div class="line">        <a class="code" href="app_stop_client_8c.html#a310220604a584e112ba8f7aa3dfe23f1">exit</a>(EXIT_FAILURE);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sbtrace_8c.html#ad4917edd7394048bdc71b38ee7ed358b">AttachHandler</a></div><div class="line">(</div><div class="line">    <a class="code" href="le__app_ctrl__interface_8h.html#a91f18fa2ac21dcea04769cdf57cb7a3f">le_appCtrl_AppRef_t</a> appRef,         <span class="comment">///&lt; [IN] App reference.</span></div><div class="line"><span class="comment"></span>    int32_t pid,                        <span class="comment">///&lt; [IN] PID of the process to attach to.</span></div><div class="line"><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* procNamePtr,            <span class="comment">///&lt; [IN] Name of the process.</span></div><div class="line"><span class="comment"></span>    <span class="keywordtype">void</span>* contextPtr                    <span class="comment">///&lt; [IN] Not used.</span></div><div class="line"><span class="comment"></span>)</div><div class="line">{</div><div class="line">    <span class="comment">// Attach to the process.</span></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// Ask the supervisor to unblock the process.</span></div><div class="line">    <a class="code" href="apps_8c.html#aa7fcc3e0e90afb3ca0e7ff82d8196a23">le_appCtrl_TraceUnblock</a>(appRef, pid);</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="le_appCtrlApi_debug_suppressProcStart"></a>
Supressing Start of a Process</h2>
<p>It's possible to ask the Supervisor to start an app without starting one or more of the app's processes. This is done by calling <a class="el" href="le__app_ctrl__interface_8h.html#a6fe6781ff1390e0314adea10768b28a7">le_appCtrl_SetRun()</a> to set the "Run" flag to false for the process before calling <a class="el" href="le__app_ctrl__interface_8h.html#af6ead537c4e4833ca4d728b219ceccd5">le_appCtrl_Start()</a> to start the app.</p>
<div class="fragment"><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// Get a reference to the app.</span></div><div class="line">    <a class="code" href="le__app_ctrl__interface_8h.html#a91f18fa2ac21dcea04769cdf57cb7a3f">le_appCtrl_AppRef_t</a> appRef = <a class="code" href="apps_8c.html#a2811527163990063e5cc2b9f31105ca6">le_appCtrl_GetRef</a>(appNameStr);</div><div class="line">    <span class="keywordflow">if</span> (appRef == NULL)</div><div class="line">    {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;App &#39;%s&#39; could not be started. Check logs for more info.\n&quot;</span>, appNameStr);</div><div class="line">        <a class="code" href="app_stop_client_8c.html#a310220604a584e112ba8f7aa3dfe23f1">exit</a>(EXIT_FAILURE);</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="apps_8c.html#a2819bfcb98e75afefdb46023b3f98b4d">le_appCtrl_SetRun</a>(appRef, procNameStr, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">    <a class="code" href="apps_8c.html#ac7d4e0cc089aff5962bf6dad4ef71503">le_appCtrl_Start</a>(appNameStr);</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="le_appCtrlApi_debug_importIntoContainer"></a>
Importing Files Into App Containers</h2>
<p><a class="el" href="le__app_ctrl__interface_8h.html#a60684f6a4ee4900c33a22b6304801930">le_appCtrl_Import()</a> can be used to import things from the real root file system into an app's run-time container. <a class="el" href="le__app_ctrl__interface_8h.html#ac61ea4ff4711107976d6bfde76fe1d8f">le_appCtrl_SetDevicePerm()</a> can be used to set the access permissions for a device file such that the app can access it.</p>
<div class="fragment"><div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> r = <a class="code" href="apps_8c.html#a2ce58932f8ae77626eca0d90f5be40db">le_appCtrl_Import</a>(appRef, path);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (r != LE_OK)</div><div class="line">{</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Could not import file &#39;%s&#39;. %s.\n&quot;</span>, path, <a class="code" href="le__log_8h.html#a99402d6a983f318e5b8bfcdf5dfe9024">LE_RESULT_TXT</a>(r));</div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="sbtrace_8c.html#ae52ed37e4d4278fd396cbc53d5a28b4a">IsDevice</a>(path))</div><div class="line">{</div><div class="line">    <span class="comment">// Give the app read access to the device file.</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="apps_8c.html#a296abb9f1261e860ffac8d2e1a3b9d58">le_appCtrl_SetDevicePerm</a>(appRef, path, <span class="stringliteral">&quot;r&quot;</span>) != LE_OK)</div><div class="line">    {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Could not set permissions to %s for &#39;%s&#39;.\n&quot;</span>, permStr, path);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><hr/>
<p>Copyright (C) Sierra Wireless Inc. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.11
        </div>
    </div>
</body>
</html>
