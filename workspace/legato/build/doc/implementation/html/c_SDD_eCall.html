<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: eCall SDD</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/javascript">
//<![CDATA[
    // Detect if doc is served by eclipse
    if( ( (window.location.hostname == "127.0.0.1") || (window.location.hostname == "localhost") ) &&
        ( (window.location.port != "") && (window.location.port != 80) && (window.location.port != 443) ) )
    {
        // Inhibit init function from navtree
        initNavTree = function(toroot,relpath) {}
        $(document).ready(function(){
            navTree = document.getElementById("side-nav");
            if(navTree)
            {
                navTree.parentElement.removeChild(navTree);
            }
            $("#doc-content").css('margin-left',10);
        });
    }
//]]>
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html" title="Legato">
      <img alt="Logo" src="legatoLogo.png"/>
    </a>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_SDD_eCall.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">eCall SDD </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="eCall"></a>
eCall</h1>
<h2><a class="anchor" id="Overview"></a>
Overview</h2>
<p>Ecall is a technology initiative intended to bring rapid assistance to auto accidents. When a serious vehicle accident occurs, sensors automatically trigger an eCall. When activated, the in-vehicle system (IVS) establishes a 112-voice connection. At the same time, a digital "minimum set of data" (MSD) message is sent over the voice call using in-band modem signals. The MSD includes accident information like time, location, driving direction and vehicle description.</p>
<h2><a class="anchor" id="le_ecall_operation"></a>
Operation modes</h2>
<p>The LE_ECALL component offers interfaces for the Client Application to handle the different eCall operation modes. In eCall Only mode, the IVS does not register to the network beforehand, thus not giving any burden to the network. It does however listen to cells to be prepared for make an eCall. To allow callback after an eCall, it is stated that the IVS should stay registered on the network for a time interval determined by the NAD deregistration time setting. There are number of timers running on the IVS side. T9 and T10 are timers tracking these registration times.</p>
<p>The modem can be configured to operate in three different operation modes:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a042d52c84b5b679ab32dd814c5b0be9e">le_ecall_ForceOnlyMode()</a>: this function configures the eCall operation mode to eCall only. At startup, the modem doesn't try to register on the Cellular network. This function forces the modem to behave as eCall only mode whatever U/SIM operation mode. The change doesn't persist over power cycles. This function can be called before making an eCall.</li>
<li><a class="el" href="le__ecall__interface_8h.html#ad468828b0024de378d91ea9c30fd6f3f">le_ecall_ForcePersistentOnlyMode()</a>: Same as <a class="el" href="le__ecall__interface_8h.html#a042d52c84b5b679ab32dd814c5b0be9e">le_ecall_ForceOnlyMode()</a>, but the change persists over power cycles.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a924114fa7fab10c3f351766a76134f34">le_ecall_ExitOnlyMode()</a>: this function exits from eCall Only mode. It configures the eCall operation mode to Normal mode, the modem uses the default operation mode at power up (or after U/SIM hotswap). The modem behaves following the U/SIM eCall operation mode; for example the U/SIM can be configured only for eCall, or a combination of eCall and commercial service provision.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a8e245065491b14f46405e415ea17b6b8">le_ecall_GetConfiguredOperationMode()</a>: this function allows the user to retrieve the configured Operation mode.</li>
</ul>
<p>The configured operation mode can be:</p><ul>
<li><code>LE_ECALL_NORMAL_MODE</code> : normal mode. The modem behaves following the U/SIM eCall operation mode; for example the U/SIM can be configured only for eCall, or a combination of eCall and commercial service provision.</li>
<li><code>LE_ECALL_ONLY_MODE</code> : eCall only mode. This mode is enabled following the U/SIM operation mode if U/SIM is eCall only sim or forced by application through the <a class="el" href="le__ecall__interface_8h.html#a042d52c84b5b679ab32dd814c5b0be9e">le_ecall_ForceOnlyMode()</a> function.</li>
<li><code>LE_ECALL_FORCED_PERSISTENT_ONLY_MODE</code> : persistent eCall only mode.</li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((res=<a class="code" href="le__ecall__interface_8h.html#a042d52c84b5b679ab32dd814c5b0be9e">le_ecall_ForceOnlyMode</a>()) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((res=<a class="code" href="le__ecall__interface_8h.html#a8e245065491b14f46405e415ea17b6b8">le_ecall_GetConfiguredOperationMode</a>(&amp;mode)) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(mode == <a class="code" href="le__ecall__interface_8h.html#af762f89b222e4cc18e9646c6e4b945b9a841847f485e780277e11d1e942d8800d">LE_ECALL_ONLY_MODE</a>);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((res=<a class="code" href="le__ecall__interface_8h.html#ad468828b0024de378d91ea9c30fd6f3f">le_ecall_ForcePersistentOnlyMode</a>()) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((res=<a class="code" href="le__ecall__interface_8h.html#a8e245065491b14f46405e415ea17b6b8">le_ecall_GetConfiguredOperationMode</a>(&amp;mode)) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(mode == <a class="code" href="le__ecall__interface_8h.html#af762f89b222e4cc18e9646c6e4b945b9a6d328d963d60c73e04af260f8dae7257">LE_ECALL_FORCED_PERSISTENT_ONLY_MODE</a>);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((res=<a class="code" href="le__ecall__interface_8h.html#a924114fa7fab10c3f351766a76134f34">le_ecall_ExitOnlyMode</a>()) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((res=<a class="code" href="le__ecall__interface_8h.html#a8e245065491b14f46405e415ea17b6b8">le_ecall_GetConfiguredOperationMode</a>(&amp;mode)) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(mode == <a class="code" href="le__ecall__interface_8h.html#af762f89b222e4cc18e9646c6e4b945b9a9d8e54c64e4796257880e146b15521f5">LE_ECALL_NORMAL_MODE</a>);</div></div><!-- fragment --> <h2><a class="anchor" id="le_ecall_session"></a>
eCall Session</h2>
<p>An eCall session is started by creating an eCall object with the <a class="el" href="le__ecall__interface_8h.html#aad7fa3b34d9d72a2f1d4baa681ba25cc">le_ecall_Create()</a> function. The eCall session can then be stopped with <a class="el" href="le__ecall__interface_8h.html#a85800c86f9709fb7baa7219cc762181c">le_ecall_End()</a>.</p>
<p>The eCall type and the kind of activation are specified using different functions to start the eCall session:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#ab106c3ca87fc8dd8239d2849df932122">le_ecall_StartManual()</a>: initiate a manual eCall session (triggered by a passenger)</li>
<li><a class="el" href="le__ecall__interface_8h.html#aa25256eeacefcf00c14763ef294c7667">le_ecall_StartAutomatic()</a>: initiate an automatic eCall session (automatically triggered by the IVS in case of accident)</li>
<li><a class="el" href="le__ecall__interface_8h.html#aa5d23a1bea370b1ae29fc52d7a89d947">le_ecall_StartTest()</a>: initiate a test eCall session (to test the communication between the IVS and the PSAP (Public Safety Answering Point, emergency operator))</li>
</ul>
<p>When the eCall object is no longer needed, call <a class="el" href="le__ecall__interface_8h.html#af1221deb68c46912748f65505b3e4919">le_ecall_Delete()</a> to free all allocated resources associated with the object.</p>
<p>The current state of an eCall session can be queried using <a class="el" href="le__ecall__interface_8h.html#a7881e794b9249222edde10f76d7663c9">le_ecall_GetState()</a>. Alternatively, an application can register a handler be notified when the session state changes. The handler can be managed using <a class="el" href="le__ecall__interface_8h.html#a453b64579f2884f1d26981bca38a201c">le_ecall_AddStateChangeHandler()</a> and <a class="el" href="le__ecall__interface_8h.html#aa2eb6eb76611d78e27b71426b2160cb1">le_ecall_RemoveStateChangeHandler()</a>.</p>
<p>An application can also call <a class="el" href="le__ecall__interface_8h.html#a771b2ef399a8fbf3b80c4eb11152c06a">le_ecall_GetTerminationReason()</a> to retrieve the reason of the call termination when call state is LE_ECALL_STATE_DISCONNECTED and <a class="el" href="le__ecall__interface_8h.html#a8ffb7fb207537ea4574823285ebb6ca1">le_ecall_GetPlatformSpecificTerminationCode()</a> to get platform specific termination code.</p>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((testECallRef=<a class="code" href="le__ecall__interface_8h.html#aad7fa3b34d9d72a2f1d4baa681ba25cc">le_ecall_Create</a>()) != NULL);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a7d8d8c1e1f49af2f6145836975d20aeb">le_ecall_ImportMsd</a>(testECallRef, ImportedMsd, <span class="keyword">sizeof</span>(ImportedMsd)) == LE_OK);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#ab106c3ca87fc8dd8239d2849df932122">le_ecall_StartManual</a>(testECallRef) == LE_OK);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#aa5d23a1bea370b1ae29fc52d7a89d947">le_ecall_StartTest</a>(testECallRef) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca92b0367090993d8b41d1560663d01e8d">LE_BUSY</a>);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#aa25256eeacefcf00c14763ef294c7667">le_ecall_StartAutomatic</a>(testECallRef) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca92b0367090993d8b41d1560663d01e8d">LE_BUSY</a>);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a85800c86f9709fb7baa7219cc762181c">le_ecall_End</a>(testECallRef) == LE_OK);</div><div class="line"></div><div class="line">    state=<a class="code" href="le__ecall__interface_8h.html#a7881e794b9249222edde10f76d7663c9">le_ecall_GetState</a>(testECallRef);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(((state&gt;=<a class="code" href="le__ecall__interface_8h.html#a233609e4724e549a1405f9177c0a07dda94ba7aacca9dfe74c4733515a7ba2c5e">LE_ECALL_STATE_STARTED</a>) &amp;&amp; (state&lt;=<a class="code" href="le__ecall__interface_8h.html#a233609e4724e549a1405f9177c0a07dda5275385371c51e441a9eb97626c271b4">LE_ECALL_STATE_FAILED</a>)));</div><div class="line"></div><div class="line">    <a class="code" href="le__ecall__interface_8h.html#af1221deb68c46912748f65505b3e4919">le_ecall_Delete</a>(testECallRef);</div></div><!-- fragment --> <h2><a class="anchor" id="le_ecall_msd"></a>
Minimum Set of Data (MSD)</h2>
<p>The dynamic values of the MSD can be set with:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a2b56b7b7fd7f936c144d30eba7815908">le_ecall_SetMsdPosition()</a> sets the position of the vehicle.</li>
<li><a class="el" href="le__ecall__interface_8h.html#af3cfea09eea1b1ba39648798070ad139">le_ecall_SetMsdPositionN1()</a> sets the first delta position of the vehicle.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a6b25b9b242ba114f31ae2f853070bf11">le_ecall_SetMsdPositionN2()</a> sets the second delta position of the vehicle.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a8c009bb03d61dcd0ffbd9e986b692a85">le_ecall_SetMsdPassengersCount()</a> sets the number of passengers.</li>
</ul>
<p>The MSD is automatically encoded with the values previously set with le_ecall_SetMsdXxx() APIs.</p>
<dl class="section warning"><dt>Warning</dt><dd>Those functions return a LE_DUPLICATE error when the MSD has been already imported with <a class="el" href="le__ecall__interface_8h.html#a7d8d8c1e1f49af2f6145836975d20aeb">le_ecall_ImportMsd()</a> function.</dd></dl>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a2b56b7b7fd7f936c144d30eba7815908">le_ecall_SetMsdPosition</a>(testECallRef, <span class="keyword">true</span>, +48898064, +2218092, 0) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#af3cfea09eea1b1ba39648798070ad139">le_ecall_SetMsdPositionN1</a>(testECallRef,511,511) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a6b25b9b242ba114f31ae2f853070bf11">le_ecall_SetMsdPositionN2</a>(testECallRef,-512,-512) == LE_OK);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a8c009bb03d61dcd0ffbd9e986b692a85">le_ecall_SetMsdPassengersCount</a>(testECallRef, 3) == LE_OK);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    //! [ExportMsd]</span></div><div class="line"><span class="comment"></span>    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#adc9610dae7a6ba87c064f8dd271a57b4">le_ecall_ExportMsd</a>(testECallRef, exportMsd, &amp;msdSize));</div><div class="line"></div><div class="line">    <span class="comment">// Check LE_DUPLICATE on le_ecall_SetMsdPosition and le_ecall_SetMsdPassengersCount</span></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a7d8d8c1e1f49af2f6145836975d20aeb">le_ecall_ImportMsd</a>(testECallRef, ImportedMsd, <span class="keyword">sizeof</span>(ImportedMsd)) == LE_OK);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#adc9610dae7a6ba87c064f8dd271a57b4">le_ecall_ExportMsd</a>(testECallRef, exportMsd, &amp;msdSize) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac26034778a666ee720b110c2fb1647ea">LE_DUPLICATE</a>);<span class="comment"></span></div><div class="line"><span class="comment">    //! [ExportMsd]</span></div><div class="line"><span class="comment"></span></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a2b56b7b7fd7f936c144d30eba7815908">le_ecall_SetMsdPosition</a>(testECallRef, <span class="keyword">true</span>, +48070380, -11310000, 45) ==</div><div class="line">                                                                                <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac26034778a666ee720b110c2fb1647ea">LE_DUPLICATE</a>);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#af3cfea09eea1b1ba39648798070ad139">le_ecall_SetMsdPositionN1</a>(testECallRef, 511, 511) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac26034778a666ee720b110c2fb1647ea">LE_DUPLICATE</a>);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a6b25b9b242ba114f31ae2f853070bf11">le_ecall_SetMsdPositionN2</a>(testECallRef, -512, -512) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac26034778a666ee720b110c2fb1647ea">LE_DUPLICATE</a>);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a8c009bb03d61dcd0ffbd9e986b692a85">le_ecall_SetMsdPassengersCount</a>(testECallRef, 3) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac26034778a666ee720b110c2fb1647ea">LE_DUPLICATE</a>);</div></div><!-- fragment --><p> The MSD transmission mode can be set or get with:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a00d3dbc99884375cf2487d6640767c40">le_ecall_SetMsdTxMode()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#a4319df67dc451fecb72e4e60ba7b6f6e">le_ecall_GetMsdTxMode()</a></li>
</ul>
<p>The transmission mode can be:</p><ul>
<li><code>LE_ECALL_TX_MODE_PUSH</code> : the MSD is pushed by the IVS</li>
<li><code>LE_ECALL_TX_MODE_PULL</code> : the MSD is sent when requested by the PSAP</li>
</ul>
<p>Legato sets the correct transmission mode during eCall start and redialing based on eCall standard. There is no need to call these APIs explicitly.</p>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a00d3dbc99884375cf2487d6640767c40">le_ecall_SetMsdTxMode</a>(<a class="code" href="le__ecall__interface_8h.html#adbaa600a7ab66371afddb909b1a113bdafe1cddc2df801a67c7f02020c0dd1127">LE_ECALL_TX_MODE_PUSH</a>) == LE_OK);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a4319df67dc451fecb72e4e60ba7b6f6e">le_ecall_GetMsdTxMode</a>(&amp;mode) == LE_OK);</div></div><!-- fragment --><p> It's possible to import a prepared MSD using the <a class="el" href="le__ecall__interface_8h.html#a7d8d8c1e1f49af2f6145836975d20aeb">le_ecall_ImportMsd()</a> function. The prepared MSD must answer the requirements described in the "EN 15722:2013" publication (this publication has been prepared by Technical Committee CEN/TC 278 “Intelligent Transport Systems").</p>
<dl class="section warning"><dt>Warning</dt><dd>The imported MSD doesn't take into account the values provided by the le_ecall_SetMsdXxx() functions. It overwrites any previous imported MSD or encoded MSD.</dd>
<dd>
The imported MSD overwrites the control flags (automaticActivation and testCall) set by le_ecall_StartXxx() functions (Manual, Automatic, Test). The User App is in charge of their correct settings.</dd></dl>
<p>The encoded MSD can be retrieved with <a class="el" href="le__ecall__interface_8h.html#adc9610dae7a6ba87c064f8dd271a57b4">le_ecall_ExportMsd()</a> function. It also exports the optional additional data of ERA-Glonass. <a class="el" href="le__ecall__interface_8h.html#adc9610dae7a6ba87c064f8dd271a57b4">le_ecall_ExportMsd()</a> API returns LE_DUPLICATE if MSD is already imported using <a class="el" href="le__ecall__interface_8h.html#a7d8d8c1e1f49af2f6145836975d20aeb">le_ecall_ImportMsd()</a> function.</p>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#adc9610dae7a6ba87c064f8dd271a57b4">le_ecall_ExportMsd</a>(testECallRef, exportMsd, &amp;msdSize));</div><div class="line"></div><div class="line">    <span class="comment">// Check LE_DUPLICATE on le_ecall_SetMsdPosition and le_ecall_SetMsdPassengersCount</span></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#a7d8d8c1e1f49af2f6145836975d20aeb">le_ecall_ImportMsd</a>(testECallRef, ImportedMsd, <span class="keyword">sizeof</span>(ImportedMsd)) == LE_OK);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__ecall__interface_8h.html#adc9610dae7a6ba87c064f8dd271a57b4">le_ecall_ExportMsd</a>(testECallRef, exportMsd, &amp;msdSize) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac26034778a666ee720b110c2fb1647ea">LE_DUPLICATE</a>);</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The User app must perform the MSD transmission by calling <a class="el" href="le__ecall__interface_8h.html#a344e4c29208e576e81dda113f786529e">le_ecall_SendMsd()</a> when the LE_ECALL_STATE_PSAP_START_IND_RECEIVED event is received. The MSD can be updated before calling <a class="el" href="le__ecall__interface_8h.html#a344e4c29208e576e81dda113f786529e">le_ecall_SendMsd()</a>, using the e_ecall_ImportMsd() function or the le_ecall_SetMsdXxx() functions.</dd></dl>
<p>Following diagram shows the eCall service state machine:</p>
<div align="center">
<img src="le_eCall_state_machine.png" />
</div>
<h2><a class="anchor" id="le_ecall_eraglonass"></a>
ERA-GLONASS compliancy</h2>
<p>To perform an emergency call following the ERA-GLONASS requirements, the 'systemStandard' entry of the configuration database must be set to 'ERA-GLONASS'.</p>
<p>Moreover, the User can set some specific configuration settings in accordance with the PSAP configuration:</p>
<ul>
<li><a class="el" href="le__ecall__interface_8h.html#a15127a7b0500796257795aaf64acd1e2">le_ecall_SetEraGlonassManualDialAttempts()</a>: set the MANUAL_DIAL_ATTEMPTS value. If a dial attempt under manual emergency call initiation failed, it should be repeated maximally ECALL_MANUAL_DIAL_ATTEMPTS-1 times within the maximal time limit of ECALL_DIAL_DURATION. The default value is 10. Redial attempts stop once the call has been cleared down correctly, or if counter / timer reached their limits. Available for both manual and test modes.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a836aaf195c0648d41f4a13f8c7ced736">le_ecall_SetEraGlonassAutoDialAttempts()</a>: set the AUTO_DIAL_ATTEMPTS value. If a dial attempt under automatic emergency call initiation failed, it should be repeated maximally ECALL_AUTO_DIAL_ATTEMPTS-1 times within the maximal time limit of ECALL_DIAL_DURATION. The default value is 10. Redial attempts stop once the call has been cleared down correctly, or if counter / timer reached their limits.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a6c934a9e5aad11eb6f009a6bf34fca19">le_ecall_SetEraGlonassDialDuration()</a>: set the ECALL_DIAL_DURATION time. It is the maximum time the IVS have to connect the emergency call to the PSAP, including all redial attempts. If the call is not connected within this time (or ManualDialAttempts/AutoDialAttempts dial attempts), it will stop.</li>
</ul>
<p>The following getter functions let you retrieve the configuration settings values:</p>
<ul>
<li><a class="el" href="le__ecall__interface_8h.html#a579169dbcb91369caa156d2c0e3462c1">le_ecall_GetEraGlonassManualDialAttempts()</a>: retrieves the MANUAL_DIAL_ATTEMPTS value.</li>
<li><a class="el" href="le__ecall__interface_8h.html#af8beed56bd3be9bee8a771e05c498ac8">le_ecall_GetEraGlonassAutoDialAttempts()</a>: retrieves the AUTO_DIAL_ATTEMPTS value.</li>
<li><a class="el" href="le__ecall__interface_8h.html#afeb92d26dd8a2c092e96b07f3dc0391d">le_ecall_GetEraGlonassDialDuration()</a>: retrieves the ECALL_DIAL_DURATION time.</li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a15127a7b0500796257795aaf64acd1e2">le_ecall_SetEraGlonassManualDialAttempts</a>(7));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a579169dbcb91369caa156d2c0e3462c1">le_ecall_GetEraGlonassManualDialAttempts</a>(&amp;attempts));</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(attempts == 7);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a836aaf195c0648d41f4a13f8c7ced736">le_ecall_SetEraGlonassAutoDialAttempts</a>(9));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#af8beed56bd3be9bee8a771e05c498ac8">le_ecall_GetEraGlonassAutoDialAttempts</a>(&amp;attempts));</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(attempts == 9);</div><div class="line"></div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a6c934a9e5aad11eb6f009a6bf34fca19">le_ecall_SetEraGlonassDialDuration</a>(240));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#afeb92d26dd8a2c092e96b07f3dc0391d">le_ecall_GetEraGlonassDialDuration</a>(&amp;duration));</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(duration == 240);</div></div><!-- fragment --> <h1><a class="anchor" id="le_ecall_eraGlonassData"></a>
ERA-GLONASS MSD additional data</h1>
<p>ERA-GLONASS additional data are optional and provided in the MSD message if any. They are located in MSD data block number 12 as optional additional data. ERA-GLONASS additional data is encoded using the OID version "1.4.1" for MSD version 1 and the OID version "1.4.2" for MSD version 2. This was assigned to ERA-GLONASS optional additional data by CEN.</p>
<p>ERA-GLONASS MSD additional data for MSD version 1 describes:</p><ul>
<li>The crash severity (Accident Severity Index - ASI15)</li>
<li>The diagnostic result</li>
<li>The crash information</li>
</ul>
<p>ERA-GLONASS MSD additional data for MSD version 2 describes:</p><ul>
<li>The crash severity (Accident Severity Index - ASI15)</li>
<li>The diagnostic result</li>
<li>The crash information</li>
<li>The coordinate system type</li>
</ul>
<p>ERA-GLONASS MSD additional data can be specified through the following functions:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a577f3dcd16e53c8a14295ec58c6d2b9a">le_ecall_SetMsdEraGlonassCrashSeverity()</a>.</li>
<li><a class="el" href="le__ecall__interface_8h.html#addb2874aacaffba2731354c4ac9428bf">le_ecall_ResetMsdEraGlonassCrashSeverity()</a>.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a51ad61edf379cfe07f03fbd71b56df9d">le_ecall_SetMsdEraGlonassDiagnosticResult()</a>.</li>
<li><a class="el" href="le__ecall__interface_8h.html#ad3e06b90843a480d68dc99ead29ae8d0">le_ecall_ResetMsdEraGlonassDiagnosticResult()</a>.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a08c613df57d34eb2a1309738bced5d76">le_ecall_SetMsdEraGlonassCrashInfo()</a>.</li>
<li><a class="el" href="le__ecall__interface_8h.html#ab883aa41416ada9746acfbb75a0039a8">le_ecall_ResetMsdEraGlonassCrashInfo()</a>.</li>
<li><a class="el" href="le__ecall__interface_8h.html#aba15bc78d2e03b5bf8c16ee366fb39b9">le_ecall_SetMsdEraGlonassCoordinateSystemType()</a>.</li>
<li><a class="el" href="le__ecall__interface_8h.html#a7ca8cd2cfbf76310d1e65d34dfc3b220">le_ecall_ResetMsdEraGlonassCoordinateSystemType()</a>.</li>
</ul>
<div class="fragment"><div class="line">    <span class="comment">/* Crash Severity configuration */</span></div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a577f3dcd16e53c8a14295ec58c6d2b9a">le_ecall_SetMsdEraGlonassCrashSeverity</a>(testECallRef, 0));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#addb2874aacaffba2731354c4ac9428bf">le_ecall_ResetMsdEraGlonassCrashSeverity</a>(testECallRef));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a577f3dcd16e53c8a14295ec58c6d2b9a">le_ecall_SetMsdEraGlonassCrashSeverity</a>(testECallRef, 99));</div><div class="line"></div><div class="line">    <span class="comment">/* DataDiagnosticResult configuration */</span></div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a51ad61edf379cfe07f03fbd71b56df9d">le_ecall_SetMsdEraGlonassDiagnosticResult</a>(testECallRef, 0x3FFFFFFFFFF));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a51ad61edf379cfe07f03fbd71b56df9d">le_ecall_SetMsdEraGlonassDiagnosticResult</a>(testECallRef, 0));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#ad3e06b90843a480d68dc99ead29ae8d0">le_ecall_ResetMsdEraGlonassDiagnosticResult</a>(testECallRef));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a51ad61edf379cfe07f03fbd71b56df9d">le_ecall_SetMsdEraGlonassDiagnosticResult</a>(testECallRef,</div><div class="line">                 <a class="code" href="le__ecall__interface_8h.html#a777e8d6608b5e40f73696904471519cfa3a666c50c2a85411eb7d723a9553144e">LE_ECALL_DIAG_RESULT_PRESENT_MIC_CONNECTION_FAILURE</a>));</div><div class="line"></div><div class="line">    <span class="comment">/* CrashInfo configuration */</span></div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a08c613df57d34eb2a1309738bced5d76">le_ecall_SetMsdEraGlonassCrashInfo</a>(testECallRef, 0xFFFF));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a08c613df57d34eb2a1309738bced5d76">le_ecall_SetMsdEraGlonassCrashInfo</a>(testECallRef, 0));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#ab883aa41416ada9746acfbb75a0039a8">le_ecall_ResetMsdEraGlonassCrashInfo</a>(testECallRef));</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a08c613df57d34eb2a1309738bced5d76">le_ecall_SetMsdEraGlonassCrashInfo</a>(testECallRef,</div><div class="line">                 <a class="code" href="le__ecall__interface_8h.html#ae95239490ffd1ee40a9dfcfe02cbd318a7139e97473edb9bca67b01d3d4f6d5c9">LE_ECALL_CRASH_INFO_PRESENT_CRASH_FRONT_OR_SIDE</a> |</div><div class="line">                 <a class="code" href="le__ecall__interface_8h.html#ae95239490ffd1ee40a9dfcfe02cbd318a0e26e57771f2628a39f1c88a5ef08f1b">LE_ECALL_CRASH_INFO_CRASH_FRONT_OR_SIDE</a>));</div><div class="line"></div><div class="line">    <span class="comment">/* Coordinate system type configuration */</span></div><div class="line">    uint32_t msdVersion = 0;</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a4875975bc3f3c8fb78b43ae40322eedd">le_ecall_GetMsdVersion</a>(&amp;msdVersion));</div><div class="line"></div><div class="line">    <span class="comment">/* If MSD version is 2, set following MSD parameters */</span></div><div class="line">    <span class="keywordflow">if</span> (2 == msdVersion)</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#aba15bc78d2e03b5bf8c16ee366fb39b9">le_ecall_SetMsdEraGlonassCoordinateSystemType</a>(testECallRef,</div><div class="line">                                                 <a class="code" href="le__ecall__interface_8h.html#a598bec665c1563eae7a153662e51f446a34ec7e90e068e0979628414832ce3865">LE_ECALL_MSD_COORDINATE_SYSTEM_TYPE_PZ90</a>));</div><div class="line">        <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a7ca8cd2cfbf76310d1e65d34dfc3b220">le_ecall_ResetMsdEraGlonassCoordinateSystemType</a>(testECallRef));</div><div class="line">        <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#aba15bc78d2e03b5bf8c16ee366fb39b9">le_ecall_SetMsdEraGlonassCoordinateSystemType</a>(testECallRef,</div><div class="line">                                                 <a class="code" href="le__ecall__interface_8h.html#a598bec665c1563eae7a153662e51f446af00789f30f127707615c1dba7f2f8416">LE_ECALL_MSD_COORDINATE_SYSTEM_TYPE_WGS84</a>));</div><div class="line">    }</div></div><!-- fragment --> <h2><a class="anchor" id="le_ecall_redial"></a>
Redial management</h2>
<p>When an eCall is disconnected, IVS might do a redial depending on several aspects such as number of dial attempts completed, dial duration elapsed, MSD transmission status and so on. The <b>LE_ECALL_STATE_END_OF_REDIAL_PERIOD</b> state event notifies the User of the redial period end. This part describes how the redial works for the PAN-EU and ERA-GLONASS eCall standards.</p>
<p>ERA-GLONASS redialing: ERA GLONASS has a restriction in the specification of either dial attempts of 10 tries (default value) or dial duration of 5 minutes (default value), whatever comes first. The timer, with default value of 5 minutes, will be referred to as ECALL_DIAL_DURATION. The value is set by SetEraGlonassDialDuration(). The counter, with default value of 10, which is called either ECALL_AUTO_DIAL_ATTEMPTS or ECALL_MANUAL_DIAL_ATTEMPTS will be referred to as “ECALL*DIAL_ATTEMPTS” from now on. These default values can be changed via SetEraGlonassManualDialAttempts() or SetEraGlonassAutoDialAttempts().</p>
<p>The timer and redial counter is implemented as follows: Every time a call is triggered, the ECALL_DIAL_DURATION (5 minutes by default) is started and call attempts are performed. If ECALL_DIAL_DURATION time expires, or all ECALL_*DIAL_ATTEMPS are performed (whatever happens first), no more attemps will be performed and ECALL_DIAL_DURATION timer will be stopped.</p>
<p>If the call connects the timer is stopped and the attempts counter is reset. If a connected call is cut it will start a new redial attempt. For this redial attempt a new DIAL_DURATION timer period of 5 min and the attempts counter is again set to ECALL*DIAL_ATTEMPTS, default 10, tries. In order not to exhaust the ECALL*DIAL_ATTEMPTS times in case of bad radio conditions, the retries are spaced out in time. The default is a 30 seconds interval between each start of each call attempt. It can be changed via <a class="el" href="le__ecall__interface_8h.html#af90a8602d4b1d0cacaa3971c508dd188">le_ecall_SetIntervalBetweenDialAttempts()</a>.</p>
<p>If a call attempt takes longer than the IntervalBetweenDialAttempts before failing, it will start directly after 1 second. When the redial is initiated because of a call drop then it pauses only 1 second to allow the network stack to get ready before starting a new dial attempt.</p>
<dl class="section note"><dt>Note</dt><dd>- If call drop is produced before ALACK reception then IVS radials in PUSH mode.<ul>
<li>If call drops with abnormal cause is produced after ALACK then IVS redials in PULL mode.</li>
</ul>
</dd></dl>
<p>Following diagram shows redial mechanism ERA-Glonass eCall if call fails:</p>
<div align="center">
<img src="EraGlonass_eCall_and_callFails.png" />
</div>
<p>PAN EU redialing: The PAN European redialing has different restrictions. Before the call is connected the first time, there is no formal restriction to the number of retries. It is up to the app to implement the retry limit as there is no formal restriction.</p>
<dl class="section note"><dt>Note</dt><dd>If first connection is unsuccessful IVS redials until find the network coverage.</dd></dl>
<p>If a call has been connected once before, and the MSD has not yet been sent, it has 120 seconds to reconnect the call. The 120 seconds are counted from the time the connected call was disconnected. This is because a PAN European eCall PSAP should call back after 3 minutes.</p>
<p>If the MSD has been successfully sent, there will be no redials from the IVS if the call is disconnected.</p>
<p>The retries are spaced out in time. The default is a 30 seconds interval between each start of each call attempt. It can be changed via <a class="el" href="le__ecall__interface_8h.html#af90a8602d4b1d0cacaa3971c508dd188">le_ecall_SetIntervalBetweenDialAttempts()</a>. If a call attempt takes longer than 30 seconds before failing, it will start directly after 1 second.</p>
<p>Following diagram shows redial mechanism for PAN-EU ecall if call fails:</p>
<div align="center">
<img src="PanEU_eCall_and_callFails.png" />
</div>
<p>Following diagram shows redial mechanism for PAN-EU ecall if call connects and fails:</p>
<div align="center">
<img src="PanEU_eCallConnects_thenFails.png" />
</div>
<h1><a class="anchor" id="le_ecall_configuration"></a>
eCall configuration</h1>
<p>Some parameters used by the eCall service can be configured through APIs. This includes the number to dial, the deregistration time, the redial interval, and some MSD information.</p>
<h2><a class="anchor" id="le_ecall_configuration_callNumber"></a>
eCall number</h2>
<p>By default, the number to dial is read from the FDN/SDN (Fixed Dialling Numbers/Service Dialling Numbers) of the U/SIM, depending upon the eCall operating mode.</p>
<p>However, the PSAP phone number can be queried and set with:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a959c53f03bb85f1071fcf7cb58e3067e">le_ecall_GetPsapNumber()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#abf9c09914c55cdbe72df1433f60f6e51">le_ecall_SetPsapNumber()</a></li>
</ul>
<p>For eCall Test call, if USIM is an eCall Only, the API <a class="el" href="le__ecall__interface_8h.html#a034c442fd7c6650ed956822a561c0104">le_ecall_UseUSimNumbers()</a> shall be used in order to dials first index stored into FDN/SDN directory. It is possible to use <a class="el" href="le__ecall__interface_8h.html#abf9c09914c55cdbe72df1433f60f6e51">le_ecall_SetPsapNumber()</a> if the PSAP number is the same as the number stored into first index of FDN directory. If USIM is not eCall Only but_le_ecall_ForceOnlyMode is forced to simulate eCallOnly behavior the API <a class="el" href="le__ecall__interface_8h.html#a034c442fd7c6650ed956822a561c0104">le_ecall_UseUSimNumbers()</a> may be used. In this case, the PSAP number should be stored into the first index of FDN directory and the facility lock on FDN should be activated. PSAP number shall be defined before to start eCall Test. It is not possible to set it when eCall session is on progress.</p>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#abf9c09914c55cdbe72df1433f60f6e51">le_ecall_SetPsapNumber</a>(<span class="stringliteral">&quot;0102030405&quot;</span>));</div><div class="line"></div><div class="line">    <span class="keywordtype">char</span> psapNumber[<a class="code" href="le__mdm_defs__interface_8h.html#ae6d4a4c7892f14d1e340f8df083d479f">LE_MDMDEFS_PHONE_NUM_MAX_BYTES</a>] = {0};</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a959c53f03bb85f1071fcf7cb58e3067e">le_ecall_GetPsapNumber</a>(psapNumber, <span class="keyword">sizeof</span>(psapNumber)));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;PSAP number: %s&quot;</span>, psapNumber);</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>That PSAP number is not applied to a manual or an automatically initiated eCall. For these modes, an emergency call is launched.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>These two functions don't modify or read the U/SIM content.</dd></dl>
<p><a class="el" href="le__ecall__interface_8h.html#a034c442fd7c6650ed956822a561c0104">le_ecall_UseUSimNumbers()</a> API can be called to request the modem to read the number to dial from the FDN/SDN of the U/SIM, depending upon the eCall operating mode.</p>
<h2><a class="anchor" id="le_ecall_configuration_nad"></a>
NAD deregistration time</h2>
<p>The NAD (Network Access Device, i.e. the Modem) deregistration time value can be set with the <a class="el" href="le__ecall__interface_8h.html#a66e454e84db7d337d76bc867b57891a1">le_ecall_SetNadDeregistrationTime()</a> API and retrieved with the <a class="el" href="le__ecall__interface_8h.html#a0f24b673049d51baf132ace25e2fa161">le_ecall_GetNadDeregistrationTime()</a> API.</p>
<ol type="1">
<li>PAN-EUROPEAN standard (<em>EN 16062</em>) defines the T9 and T10 timers. After an eCall clear-down, an <b>eCall only</b> IVS shall:<ul>
<li>Remain registered on the network for at least the duration of T9, which is set to one hour by default.</li>
<li>Deregister from the network after the expiration of T10, which duration is set to twelve hours by default.</li>
</ul>
</li>
<li>ERA-GLONASS standard (<em>ENG_GOST_R_54620</em>) defines the NAD_DEREGISTRATION_TIME with a minimal value of two hours and a maximum value of twelve hours. After an eCall clear-down, the IVS shall remain registered on the network and deregister from the network after the expiration of the NAD_DEREGISTRATION_TIME.</li>
</ol>
<p>The <a class="el" href="le__ecall__interface_8h.html#a66e454e84db7d337d76bc867b57891a1">le_ecall_SetNadDeregistrationTime()</a> API is used to set the duration of a <em>deregistration timer</em>: after an eCall clear-down, the IVS remains registered on the network for the duration of this timer and then automatically deregisters from the network upon its expiration.</p>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a66e454e84db7d337d76bc867b57891a1">le_ecall_SetNadDeregistrationTime</a>(180));</div><div class="line"></div><div class="line">    uint16_t deregistrationTime = 0;</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a0f24b673049d51baf132ace25e2fa161">le_ecall_GetNadDeregistrationTime</a>(&amp;deregistrationTime));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;Deregistration time: %d minutes&quot;</span>, deregistrationTime);</div></div><!-- fragment --> <h3><a class="anchor" id="le_ecall_configuration_nad_panEU"></a>
PAN-EUROPEAN standard</h3>
<p>As the T9 timer duration is fixed to one hour, the notified events depend on the <em>deregistration timer</em> duration:</p><ul>
<li>If its duration is set to one hour, the <a class="el" href="le__ecall__interface_8h.html#a233609e4724e549a1405f9177c0a07dda445e9365be6aac0b3403568d423ce6c5">LE_ECALL_STATE_TIMEOUT_T9</a> event will be reported. In this case deregistration is automatically performed when the T9 timeout indication is received.</li>
<li>If its duration is set to more than one hour and less than twelve hours then the <a class="el" href="le__ecall__interface_8h.html#a233609e4724e549a1405f9177c0a07ddadafcb8d0490beb3d2778fadcbaeb8c11">LE_ECALL_STATE_TIMEOUT_T10</a> event will be reported when the <em>deregistration timer</em> expires. The T9 timeout (<a class="el" href="le__ecall__interface_8h.html#a233609e4724e549a1405f9177c0a07dda445e9365be6aac0b3403568d423ce6c5">LE_ECALL_STATE_TIMEOUT_T9</a> event) will not be notified. In this case deregistration is automatically performed when the <em>deregistration timer</em> expires, provided that the application didn't already deregister from the network before.</li>
</ul>
<h3><a class="anchor" id="le_ecall_configuration_nad_eraGlonass"></a>
ERA-GLONASS standard</h3>
<ul>
<li>The <a class="el" href="le__ecall__interface_8h.html#a233609e4724e549a1405f9177c0a07dda445e9365be6aac0b3403568d423ce6c5">LE_ECALL_STATE_TIMEOUT_T9</a> event is not reported as it is not defined in the ERA-GLONASS standard.</li>
<li>The NAD_DEREGISTRATION_TIME default value is eight hours, as defined by <em>GOST_R 54620 Table A.1</em>. It can be changed with <a class="el" href="le__ecall__interface_8h.html#a66e454e84db7d337d76bc867b57891a1">le_ecall_SetNadDeregistrationTime()</a> and the value must be set between two and twelve hours.</li>
<li>The <a class="el" href="le__ecall__interface_8h.html#a233609e4724e549a1405f9177c0a07ddadafcb8d0490beb3d2778fadcbaeb8c11">LE_ECALL_STATE_TIMEOUT_T10</a> event will be reported when the NAD_DEREGISTRATION_TIME expires. In this case deregistration is automatically performed when the timer expires.</li>
</ul>
<h3><a class="anchor" id="le_ecall_configuration_nad_timerValue"></a>
Timer value</h3>
<p>Although the time is set in minutes the value is taken in hours, for example:</p><ul>
<li>from 1 to 60 minutes -&gt; 1 hour</li>
<li>from 61 to 120 minutes -&gt; 2 hours, etc.</li>
</ul>
<p>Example: if <code>deregTime</code> parameter unit is minutes, the effective time is: </p><div class="fragment"><div class="line">ECallConfiguration.nad_deregistration_time = (deregTime+59)/60; </div></div><!-- fragment --><p>After termination of an emergency call the in-vehicle system remains registered on the network for the period of time, defined by the parameter NAD_DEREGISTRATION_TIME.</p>
<dl class="section warning"><dt>Warning</dt><dd>Be sure to check the possible values of NAD_DEREGISTRATION_TIME for your specific platform.</dd></dl>
<h2><a class="anchor" id="le_ecall_configuration_redialInterval"></a>
Redial interval</h2>
<p>The minimum interval time value between dial attempts can be set or get with:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#af90a8602d4b1d0cacaa3971c508dd188">le_ecall_SetIntervalBetweenDialAttempts()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#a3a24ae5a007d0c43db2bc55caa43c19d">le_ecall_GetIntervalBetweenDialAttempts()</a></li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#af90a8602d4b1d0cacaa3971c508dd188">le_ecall_SetIntervalBetweenDialAttempts</a>(30));</div><div class="line"></div><div class="line">    uint16_t pause = 0;</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a3a24ae5a007d0c43db2bc55caa43c19d">le_ecall_GetIntervalBetweenDialAttempts</a>(&amp;pause));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;Interval between dial attempts: %d seconds&quot;</span>, pause);</div></div><!-- fragment --><p> The default value is set to 30 seconds.</p>
<p>The time is counted from the start of the first dial attempt.</p>
<p>If a call attempt takes longer than the IntervalBetweenDialAttempts before failing, it will start directly after 1 second. When the redial is initiated because of a call drop then it pauses only 1 second to allow the network stack to get ready before starting a new dial attempt.</p>
<p>If less time than the IntervalBetweenDialAttempts has expired during the dial attempt, it will wait for time the IntervalBetweenDialAttempts seconds to allow hangup before redialing.</p>
<p><a class="el" href="le__ecall__interface_8h.html#af90a8602d4b1d0cacaa3971c508dd188">le_ecall_SetIntervalBetweenDialAttempts()</a> is available for both manual and test modes.</p>
<h2><a class="anchor" id="le_ecall_configuration_misc"></a>
Miscellaneous</h2>
<p>The preferred system standard defaults to PAN-EUROPEAN It can be set an gotten with the following functions:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a1b492b42490b319fcc228e52f8694307">le_ecall_SetSystemStandard()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#abfb468cf1e977e9b2444d13617322331">le_ecall_GetSystemStandard()</a></li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a1b492b42490b319fcc228e52f8694307">le_ecall_SetSystemStandard</a>(<a class="code" href="le__ecall__interface_8h.html#a38a79a5123761b6808ea58b4f343579baddc50d7d4524fffc7388c5753ce5a299">LE_ECALL_ERA_GLONASS</a>));</div><div class="line"></div><div class="line">    <a class="code" href="le__ecall__interface_8h.html#a38a79a5123761b6808ea58b4f343579b">le_ecall_SystemStandard_t</a> systemStandard;</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#abfb468cf1e977e9b2444d13617322331">le_ecall_GetSystemStandard</a>(&amp;systemStandard));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;System standard: %d&quot;</span>, systemStandard);</div></div><!-- fragment --><p> The MSD version can be set and and gotten with the following functions:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a4d698cd7bde3b33e191453d31bc7c9d1">le_ecall_SetMsdVersion()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#a4875975bc3f3c8fb78b43ae40322eedd">le_ecall_GetMsdVersion()</a></li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a4d698cd7bde3b33e191453d31bc7c9d1">le_ecall_SetMsdVersion</a>(1))</div><div class="line"></div><div class="line">    uint32_t msdVersion = 0;</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a4875975bc3f3c8fb78b43ae40322eedd">le_ecall_GetMsdVersion</a>(&amp;msdVersion));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(&quot;MSD version: %d&quot;, msdVersion);</div></div><!-- fragment --><p> The vehicle type can be set and gotten with the following functions:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#a291bd0a938266981a8cb6eb836c45b37">le_ecall_SetVehicleType()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#ab7cdf7de011b9c8edaec790b360dded6">le_ecall_GetVehicleType()</a></li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#a291bd0a938266981a8cb6eb836c45b37">le_ecall_SetVehicleType</a>(<a class="code" href="le__ecall__interface_8h.html#a90c7868842c599a89be72a1ff8609f09acf7dde2942af72d9656c0b753aab4880">LE_ECALL_MSD_VEHICLE_BUS_M2</a>));</div><div class="line"></div><div class="line">    <a class="code" href="le__ecall__interface_8h.html#a90c7868842c599a89be72a1ff8609f09">le_ecall_MsdVehicleType_t</a> vehicleType;</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#ab7cdf7de011b9c8edaec790b360dded6">le_ecall_GetVehicleType</a>(&amp;vehicleType));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;Vehicle type: %d&quot;</span>, vehicleType);</div></div><!-- fragment --><p> The vehicle identifier can be set and gotten with the following functions:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#aca95cc7f1d44d3acef601ea97714f748">le_ecall_SetVIN()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#acc26551a121b769ca0b358a8b6c47694">le_ecall_GetVIN()</a></li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#aca95cc7f1d44d3acef601ea97714f748">le_ecall_SetVIN</a>(<span class="stringliteral">&quot;VF37BRFVE12345678&quot;</span>));</div><div class="line"></div><div class="line">    <span class="keywordtype">char</span> vin[<a class="code" href="le__ecall__interface_8h.html#a0fce568162ff0d320cdea60adf4c9d3a">LE_ECALL_VIN_MAX_BYTES</a>] = {0};</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#acc26551a121b769ca0b358a8b6c47694">le_ecall_GetVIN</a>(vin, <span class="keyword">sizeof</span>(vin)));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;VIN: %s&quot;</span>, vin);</div></div><!-- fragment --><p> The propulsion type can be set and gotten with the following functions:</p><ul>
<li><a class="el" href="le__ecall__interface_8h.html#abb9c569b53f8c35b878c7c9ca159e1df">le_ecall_SetPropulsionType()</a></li>
<li><a class="el" href="le__ecall__interface_8h.html#aea86cec8465c43f4cc71ac3c7879965a">le_ecall_GetPropulsionType()</a></li>
</ul>
<div class="fragment"><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#abb9c569b53f8c35b878c7c9ca159e1df">le_ecall_SetPropulsionType</a>(<a class="code" href="le__ecall__interface_8h.html#a10f3332edf213de92962a861b0fb6a1fa1f6166e6aec7ef156bc0a2d1b608ecf9">LE_ECALL_PROPULSION_TYPE_OTHER</a>));</div><div class="line"></div><div class="line">    <a class="code" href="le__ecall__interface_8h.html#a10f3332edf213de92962a861b0fb6a1f">le_ecall_PropulsionTypeBitMask_t</a> propulsionType;</div><div class="line">    <a class="code" href="le__log_8h.html#a7cd2daa3d4af1de4d29e0eed95187484">LE_ASSERT_OK</a>(<a class="code" href="le__ecall__interface_8h.html#aea86cec8465c43f4cc71ac3c7879965a">le_ecall_GetPropulsionType</a>(&amp;propulsionType));</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;Propulsion type: 0x%02x&quot;</span>, propulsionType);</div></div><!-- fragment --><p> Copyright (C) Sierra Wireless Inc. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.11
        </div>
    </div>
</body>
</html>
